{"ast":null,"code":"import _objectSpread from\"C:/Users/3jz/Desktop/HJZDM/frontend/hjzdm-frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState}from'react';import{useNavigate,Link}from'react-router-dom';import{userApi}from'../services/userApi';import'./LoginPage.css';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const LoginPage=()=>{const[formData,setFormData]=useState({phone:'',password:''});const[error,setError]=useState(null);const[loading,setLoading]=useState(false);const navigate=useNavigate();const handleChange=e=>{const{name,value}=e.target;setFormData(prev=>_objectSpread(_objectSpread({},prev),{},{[name]:value}));// 清除之前的错误信息\nif(error)setError(null);};const handleSubmit=async e=>{var _err$response$data;e.preventDefault();setLoading(true);setError(null);try{// 调用真实API - 使用新的login端点\nconst response=await userApi.login({username:formData.phone,// 使用username字段，但保持变量名不变以兼容现有代码\npassword:formData.password});console.log('Login response data:',response.data);// 调试日志\nif(response.data&&response.data.code===200){var _response$data$data;// 登录成功，跳转到主页\nconst token=response.data.token||((_response$data$data=response.data.data)===null||_response$data$data===void 0?void 0:_response$data$data.token);if(token){localStorage.setItem('token',token);}navigate('/');}else{var _response$data,_response$data2;// 尝试从响应中获取错误消息\nconst errorMessage=((_response$data=response.data)===null||_response$data===void 0?void 0:_response$data.message)||((_response$data2=response.data)===null||_response$data2===void 0?void 0:_response$data2.msg)||'ログインに失敗しました。再試行してください。';setError(errorMessage);}}catch(err){// 处理不同的错误情况\nif(err.response){// 服务器响应错误\nswitch(err.response.status){case 401:setError('ユーザー名またはパスワードが間違っています。');break;case 404:setError('ユーザーが存在しません。');break;case 500:setError('サーバーエラーが発生しました。後ほど再試行してください。');break;default:setError(((_err$response$data=err.response.data)===null||_err$response$data===void 0?void 0:_err$response$data.message)||'ログインに失敗しました。再試行してください。');}}else if(err.request){// 网络错误\nsetError('ネットワーク接続に失敗しました。接続を確認してください。');}else{// 其他错误\nsetError('ログイン中にエラーが発生しました。再試行してください。');}}finally{setLoading(false);}};return/*#__PURE__*/_jsx(\"div\",{className:\"login-page\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"login-container\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"\\u30ED\\u30B0\\u30A4\\u30F3\"}),error&&/*#__PURE__*/_jsx(\"div\",{className:\"error-message\",children:error}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,className:\"login-form\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"phone\",children:\"\\u30E6\\u30FC\\u30B6\\u30FC\\u540D\\u307E\\u305F\\u306F\\u30E1\\u30FC\\u30EB\\u30A2\\u30C9\\u30EC\\u30B9\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",id:\"phone\",name:\"phone\",value:formData.phone,onChange:handleChange,placeholder:\"\\u30E6\\u30FC\\u30B6\\u30FC\\u540D\\u307E\\u305F\\u306F\\u30E1\\u30FC\\u30EB\\u30A2\\u30C9\\u30EC\\u30B9\\u3092\\u5165\\u529B\",required:true,className:\"form-input\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"password\",children:\"\\u30D1\\u30B9\\u30EF\\u30FC\\u30C9\"}),/*#__PURE__*/_jsx(\"input\",{type:\"password\",id:\"password\",name:\"password\",value:formData.password,onChange:handleChange,placeholder:\"\\u30D1\\u30B9\\u30EF\\u30FC\\u30C9\\u3092\\u5165\\u529B\",required:true,className:\"form-input\"})]}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"login-button\",disabled:loading,children:loading?'ログイン中...':'ログイン'})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"login-footer\",children:[/*#__PURE__*/_jsxs(\"p\",{children:[\"\\u30A2\\u30AB\\u30A6\\u30F3\\u30C8\\u3092\\u304A\\u6301\\u3061\\u3067\\u306A\\u3044\\u3067\\u3059\\u304B\\uFF1F \",/*#__PURE__*/_jsx(Link,{to:\"/register\",className:\"link\",children:\"\\u65B0\\u898F\\u767B\\u9332\"})]}),/*#__PURE__*/_jsx(Link,{to:\"/\",className:\"link\",children:\"\\u30C8\\u30C3\\u30D7\\u30DA\\u30FC\\u30B8\\u3078\\u623B\\u308B\"})]})]})});};export default LoginPage;","map":{"version":3,"names":["React","useState","useNavigate","Link","userApi","jsx","_jsx","jsxs","_jsxs","LoginPage","formData","setFormData","phone","password","error","setError","loading","setLoading","navigate","handleChange","e","name","value","target","prev","_objectSpread","handleSubmit","_err$response$data","preventDefault","response","login","username","console","log","data","code","_response$data$data","token","localStorage","setItem","_response$data","_response$data2","errorMessage","message","msg","err","status","request","className","children","onSubmit","htmlFor","type","id","onChange","placeholder","required","disabled","to"],"sources":["C:/Users/3jz/Desktop/HJZDM/frontend/hjzdm-frontend/src/pages/LoginPage.tsx"],"sourcesContent":["import React, { useState } from 'react';\nimport { useNavigate, Link } from 'react-router-dom';\nimport { userApi } from '../services/userApi';\nimport './LoginPage.css';\n\ninterface LoginFormData {\n  phone: string; // 使用phone字段兼容后端API\n  password: string;\n}\n\nconst LoginPage: React.FC = () => {\n  const [formData, setFormData] = useState<LoginFormData>({\n    phone: '',\n    password: ''\n  });\n  const [error, setError] = useState<string | null>(null);\n  const [loading, setLoading] = useState(false);\n  const navigate = useNavigate();\n\n  const handleChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const { name, value } = e.target;\n    setFormData(prev => ({\n      ...prev,\n      [name]: value\n    }));\n    // 清除之前的错误信息\n    if (error) setError(null);\n  };\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setLoading(true);\n    setError(null);\n\n    try {\n      // 调用真实API - 使用新的login端点\n      const response = await userApi.login({\n        username: formData.phone, // 使用username字段，但保持变量名不变以兼容现有代码\n        password: formData.password\n      });\n\n      console.log('Login response data:', response.data); // 调试日志\n      \n      if (response.data && response.data.code === 200) {\n        // 登录成功，跳转到主页\n        const token = response.data.token || response.data.data?.token;\n        if (token) {\n          localStorage.setItem('token', token);\n        }\n        navigate('/');\n      } else {\n        // 尝试从响应中获取错误消息\n        const errorMessage = response.data?.message || response.data?.msg || 'ログインに失敗しました。再試行してください。';\n        setError(errorMessage);\n      }\n    } catch (err: any) {\n      // 处理不同的错误情况\n      if (err.response) {\n        // 服务器响应错误\n        switch (err.response.status) {\n          case 401:\n            setError('ユーザー名またはパスワードが間違っています。');\n            break;\n          case 404:\n            setError('ユーザーが存在しません。');\n            break;\n          case 500:\n            setError('サーバーエラーが発生しました。後ほど再試行してください。');\n            break;\n          default:\n            setError(err.response.data?.message || 'ログインに失敗しました。再試行してください。');\n        }\n      } else if (err.request) {\n        // 网络错误\n        setError('ネットワーク接続に失敗しました。接続を確認してください。');\n      } else {\n        // 其他错误\n        setError('ログイン中にエラーが発生しました。再試行してください。');\n      }\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"login-page\">\n      <div className=\"login-container\">\n        <h2>ログイン</h2>\n        {error && <div className=\"error-message\">{error}</div>}\n        \n        <form onSubmit={handleSubmit} className=\"login-form\">\n          <div className=\"form-group\">\n            <label htmlFor=\"phone\">ユーザー名またはメールアドレス</label>\n            <input\n              type=\"text\"\n              id=\"phone\"\n              name=\"phone\"\n              value={formData.phone}\n              onChange={handleChange}\n              placeholder=\"ユーザー名またはメールアドレスを入力\"\n              required\n              className=\"form-input\"\n            />\n          </div>\n          \n          <div className=\"form-group\">\n            <label htmlFor=\"password\">パスワード</label>\n            <input\n              type=\"password\"\n              id=\"password\"\n              name=\"password\"\n              value={formData.password}\n              onChange={handleChange}\n              placeholder=\"パスワードを入力\"\n              required\n              className=\"form-input\"\n            />\n          </div>\n          \n          <button \n            type=\"submit\" \n            className=\"login-button\"\n            disabled={loading}\n          >\n            {loading ? 'ログイン中...' : 'ログイン'}\n          </button>\n        </form>\n        \n        <div className=\"login-footer\">\n          <p>アカウントをお持ちでないですか？ <Link to=\"/register\" className=\"link\">新規登録</Link></p>\n          <Link to=\"/\" className=\"link\">トップページへ戻る</Link>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default LoginPage;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}