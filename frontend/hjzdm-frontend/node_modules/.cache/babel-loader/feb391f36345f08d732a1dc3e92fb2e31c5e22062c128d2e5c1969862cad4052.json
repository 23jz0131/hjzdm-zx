{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\3jz\\\\Desktop\\\\HJZDM\\\\frontend\\\\hjzdm-frontend\\\\src\\\\pages\\\\ComparePage.tsx\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect } from 'react';\nimport { useSearchParams } from 'react-router-dom';\nimport './ComparePage.css';\nimport { goodsApi, categoryApi, goodsOperateApi } from '../services/api';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst ComparePage = () => {\n  _s();\n  const [searchParams] = useSearchParams();\n\n  // 从 sessionStorage 恢复状态\n  const [query, setQuery] = useState(() => {\n    const saved = sessionStorage.getItem('comparePage_query');\n    return searchParams.get('query') || saved || '';\n  });\n  const [compareGroups, setCompareGroups] = useState(() => {\n    const saved = sessionStorage.getItem('comparePage_compareGroups');\n    return saved ? JSON.parse(saved) : [];\n  });\n  const [loading, setLoading] = useState(() => {\n    const saved = sessionStorage.getItem('comparePage_loading');\n    return saved ? JSON.parse(saved) : false;\n  });\n  const [error, setError] = useState(() => {\n    const saved = sessionStorage.getItem('comparePage_error');\n    return saved ? JSON.parse(saved) : null;\n  });\n  const [sortOption, setSortOption] = useState(() => {\n    const saved = sessionStorage.getItem('comparePage_sortOption');\n    return saved || 'price_asc';\n  });\n  const [selectedPlatforms, setSelectedPlatforms] = useState(() => {\n    const saved = sessionStorage.getItem('comparePage_selectedPlatforms');\n    return saved ? JSON.parse(saved) : [];\n  });\n  const [minPrice, setMinPrice] = useState(() => {\n    const saved = sessionStorage.getItem('comparePage_minPrice');\n    return saved || '';\n  });\n  const [maxPrice, setMaxPrice] = useState(() => {\n    const saved = sessionStorage.getItem('comparePage_maxPrice');\n    return saved || '';\n  });\n  const [currentPage, setCurrentPage] = useState(() => {\n    const saved = sessionStorage.getItem('comparePage_currentPage');\n    return saved ? parseInt(saved) : 1;\n  });\n  const [pageSize, setPageSize] = useState(() => {\n    const saved = sessionStorage.getItem('comparePage_pageSize');\n    return saved ? parseInt(saved) : 50;\n  });\n  const [selectedKeys, setSelectedKeys] = useState(() => {\n    const saved = sessionStorage.getItem('comparePage_selectedKeys');\n    return saved ? JSON.parse(saved) : [];\n  });\n  const [selectedBrands, setSelectedBrands] = useState(() => {\n    const saved = sessionStorage.getItem('comparePage_selectedBrands');\n    return saved ? JSON.parse(saved) : [];\n  });\n  const [selectedSeries, setSelectedSeries] = useState(() => {\n    const saved = sessionStorage.getItem('comparePage_selectedSeries');\n    return saved ? JSON.parse(saved) : [];\n  });\n  const [selectedModels, setSelectedModels] = useState(() => {\n    const saved = sessionStorage.getItem('comparePage_selectedModels');\n    return saved ? JSON.parse(saved) : [];\n  });\n  const [selectedStorage, setSelectedStorage] = useState(() => {\n    const saved = sessionStorage.getItem('comparePage_selectedStorage');\n    return saved ? JSON.parse(saved) : [];\n  });\n  const [selectedColors, setSelectedColors] = useState(() => {\n    const saved = sessionStorage.getItem('comparePage_selectedColors');\n    return saved ? JSON.parse(saved) : [];\n  });\n  const [selectedSizes, setSelectedSizes] = useState(() => {\n    const saved = sessionStorage.getItem('comparePage_selectedSizes');\n    return saved ? JSON.parse(saved) : [];\n  });\n  const [selectedCategories, setSelectedCategories] = useState(() => {\n    const saved = sessionStorage.getItem('comparePage_selectedCategories');\n    return saved ? JSON.parse(saved) : [];\n  });\n  const [trendOpen, setTrendOpen] = useState(() => {\n    const saved = sessionStorage.getItem('comparePage_trendOpen');\n    return saved ? JSON.parse(saved) : false;\n  });\n  const [trendLabels, setTrendLabels] = useState(() => {\n    const saved = sessionStorage.getItem('comparePage_trendLabels');\n    return saved ? JSON.parse(saved) : [];\n  });\n  const [trendSeries, setTrendSeries] = useState(() => {\n    const saved = sessionStorage.getItem('comparePage_trendSeries');\n    return saved ? JSON.parse(saved) : [];\n  });\n  const [trendTitle, setTrendTitle] = useState(() => {\n    const saved = sessionStorage.getItem('comparePage_trendTitle');\n    return saved || '';\n  });\n  const [collectedIds, setCollectedIds] = useState(() => {\n    const saved = sessionStorage.getItem('comparePage_collectedIds');\n    return saved ? new Set(JSON.parse(saved)) : new Set();\n  });\n\n  // Search Source\n  const [searchSource, setSearchSource] = useState(() => {\n    const saved = sessionStorage.getItem('comparePage_searchSource');\n    return saved || 'compare';\n  });\n  const [executedQuery, setExecutedQuery] = useState(() => {\n    const saved = sessionStorage.getItem('comparePage_executedQuery');\n    return saved || '';\n  });\n  const [totalItems, setTotalItems] = useState(() => {\n    const saved = sessionStorage.getItem('comparePage_totalItems');\n    return saved ? parseInt(saved) : 0;\n  });\n\n  // Dynamic Filters State\n  const [categories, setCategories] = useState([]);\n  const [dynamicFilters, setDynamicFilters] = useState([]);\n  const [selectedDynamicFilters, setSelectedDynamicFilters] = useState({});\n  const [currentCatId, setCurrentCatId] = useState(null);\n\n  // 保存状态到 sessionStorage\n  useEffect(() => {\n    sessionStorage.setItem('comparePage_query', query);\n  }, [query]);\n  useEffect(() => {\n    sessionStorage.setItem('comparePage_compareGroups', JSON.stringify(compareGroups));\n  }, [compareGroups]);\n  useEffect(() => {\n    sessionStorage.setItem('comparePage_loading', JSON.stringify(loading));\n  }, [loading]);\n  useEffect(() => {\n    sessionStorage.setItem('comparePage_error', JSON.stringify(error));\n  }, [error]);\n  useEffect(() => {\n    sessionStorage.setItem('comparePage_sortOption', sortOption);\n  }, [sortOption]);\n  useEffect(() => {\n    sessionStorage.setItem('comparePage_selectedPlatforms', JSON.stringify(selectedPlatforms));\n  }, [selectedPlatforms]);\n  useEffect(() => {\n    sessionStorage.setItem('comparePage_minPrice', minPrice);\n  }, [minPrice]);\n  useEffect(() => {\n    sessionStorage.setItem('comparePage_maxPrice', maxPrice);\n  }, [maxPrice]);\n  useEffect(() => {\n    sessionStorage.setItem('comparePage_currentPage', currentPage.toString());\n  }, [currentPage]);\n  useEffect(() => {\n    sessionStorage.setItem('comparePage_pageSize', pageSize.toString());\n  }, [pageSize]);\n  useEffect(() => {\n    sessionStorage.setItem('comparePage_selectedKeys', JSON.stringify(selectedKeys));\n  }, [selectedKeys]);\n  useEffect(() => {\n    sessionStorage.setItem('comparePage_selectedBrands', JSON.stringify(selectedBrands));\n  }, [selectedBrands]);\n  useEffect(() => {\n    sessionStorage.setItem('comparePage_selectedSeries', JSON.stringify(selectedSeries));\n  }, [selectedSeries]);\n  useEffect(() => {\n    sessionStorage.setItem('comparePage_selectedModels', JSON.stringify(selectedModels));\n  }, [selectedModels]);\n  useEffect(() => {\n    sessionStorage.setItem('comparePage_selectedStorage', JSON.stringify(selectedStorage));\n  }, [selectedStorage]);\n  useEffect(() => {\n    sessionStorage.setItem('comparePage_selectedColors', JSON.stringify(selectedColors));\n  }, [selectedColors]);\n  useEffect(() => {\n    sessionStorage.setItem('comparePage_selectedSizes', JSON.stringify(selectedSizes));\n  }, [selectedSizes]);\n  useEffect(() => {\n    sessionStorage.setItem('comparePage_selectedCategories', JSON.stringify(selectedCategories));\n  }, [selectedCategories]);\n  useEffect(() => {\n    sessionStorage.setItem('comparePage_trendOpen', JSON.stringify(trendOpen));\n  }, [trendOpen]);\n  useEffect(() => {\n    sessionStorage.setItem('comparePage_trendLabels', JSON.stringify(trendLabels));\n  }, [trendLabels]);\n  useEffect(() => {\n    sessionStorage.setItem('comparePage_trendSeries', JSON.stringify(trendSeries));\n  }, [trendSeries]);\n  useEffect(() => {\n    sessionStorage.setItem('comparePage_trendTitle', trendTitle);\n  }, [trendTitle]);\n  useEffect(() => {\n    sessionStorage.setItem('comparePage_collectedIds', JSON.stringify(Array.from(collectedIds)));\n  }, [collectedIds]);\n  useEffect(() => {\n    sessionStorage.setItem('comparePage_searchSource', searchSource);\n  }, [searchSource]);\n  useEffect(() => {\n    sessionStorage.setItem('comparePage_executedQuery', executedQuery);\n  }, [executedQuery]);\n  useEffect(() => {\n    sessionStorage.setItem('comparePage_totalItems', totalItems.toString());\n  }, [totalItems]);\n\n  // Fetch categories on mount\n  useEffect(() => {\n    categoryApi.getList().then(res => {\n      if (res.data.code === 200) {\n        setCategories(res.data.data);\n      }\n    }).catch(err => console.warn(\"Failed to fetch categories\", err));\n  }, []);\n\n  // 仅在页面加载时，如果有URL参数，则执行搜索\n  useEffect(() => {\n    if (query.trim()) {\n      searchProducts(query);\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  // Fetch dynamic attributes when category changes\n  useEffect(() => {\n    if (currentCatId) {\n      categoryApi.getAttributes(currentCatId).then(res => {\n        if (res.data.code === 200) {\n          setDynamicFilters(res.data.data);\n        }\n      }).catch(err => console.warn(\"Failed to fetch attributes\", err));\n    } else {\n      setDynamicFilters([]);\n    }\n  }, [currentCatId]);\n\n  // Auto-search when filters change (Local Mode only)\n  useEffect(() => {\n    if (searchSource === 'local') {\n      searchProducts(executedQuery || query);\n    }\n  }, [selectedDynamicFilters, currentCatId, currentPage, pageSize, searchSource, selectedPlatforms]);\n  useEffect(() => {\n    (async () => {\n      try {\n        const res = await goodsApi.getMyCollect(1, 500);\n        if (res.data && res.data.code === 200 && Array.isArray(res.data.data)) {\n          const ids = res.data.data.map(g => g.goodsId).filter(id => typeof id === 'number');\n          setCollectedIds(new Set(ids));\n        }\n      } catch (e) {}\n    })();\n  }, []);\n  const toggleCollect = async goodsId => {\n    try {\n      if (collectedIds.has(goodsId)) {\n        const res = await goodsOperateApi.cancelCollect(goodsId);\n        if (res.data && res.data.code === 200) {\n          setCollectedIds(prev => {\n            const next = new Set(prev);\n            next.delete(goodsId);\n            return next;\n          });\n        }\n      } else {\n        const res = await goodsOperateApi.collect(goodsId);\n        if (res.data && res.data.code === 200) {\n          setCollectedIds(prev => {\n            const next = new Set(prev);\n            next.add(goodsId);\n            return next;\n          });\n        } else {\n          alert('请先登录');\n        }\n      }\n    } catch (e) {\n      alert('操作失败');\n    }\n  };\n  const ensureGoodsIdAndCollect = async product => {\n    try {\n      const token = localStorage.getItem('token');\n      if (!token) {\n        alert('请先登录');\n        return;\n      }\n      if (product.goodsId) {\n        await toggleCollect(product.goodsId);\n        return;\n      }\n      const payload = {\n        goodsName: product.goodsName,\n        goodsPrice: product.goodsPrice,\n        goodsLink: product.goodsLink,\n        imgUrl: product.imgUrl || '',\n        mallType: product.mallType,\n        status: 1\n      };\n      const addRes = await goodsApi.addAndReturn(payload);\n      if (addRes.data && addRes.data.code === 200 && addRes.data.data && addRes.data.data.goodsId) {\n        const newId = addRes.data.data.goodsId;\n        await toggleCollect(newId);\n      } else {\n        alert('新增商品失败');\n      }\n    } catch (e) {\n      alert('操作失败');\n    }\n  };\n  const ensureGoodsIdAndHistory = async (product, event) => {\n    // 直接跳转，不再记录浏览历史\n    const targetUrl = product.goodsLink;\n    if (targetUrl) {\n      window.open(targetUrl, '_blank', 'noopener,noreferrer');\n    }\n  };\n  const searchProducts = async searchQuery => {\n    // Debug log removed\n    if (!searchQuery.trim() && searchSource === 'compare') return;\n    setExecutedQuery(searchQuery);\n    setLoading(true);\n    setError(null);\n    try {\n      if (searchSource === 'local') {\n        const minP = minPrice ? Number(minPrice) : undefined;\n        const maxP = maxPrice ? Number(maxPrice) : undefined;\n        // Debug log removed\n        const response = await goodsApi.getGoodsPage(searchQuery, selectedDynamicFilters, currentCatId || undefined, currentPage, pageSize, minP, maxP, selectedPlatforms);\n        // Debug log removed\n\n        if (response.data && response.data.code === 200) {\n          const records = response.data.data.records || [];\n          setTotalItems(response.data.data.total || 0);\n          const processedData = records.map(g => ({\n            goodsName: g.goodsName,\n            goodsList: [{\n              goodsId: g.goodsId,\n              goodsName: g.goodsName,\n              goodsPrice: g.goodsPrice,\n              goodsLink: g.goodsLink || '#',\n              imgUrl: g.imgUrl,\n              mallType: g.mallType || 0\n            }],\n            lowestPrice: g.goodsPrice,\n            lowestPlatform: getPlatformName(g.mallType || 0)\n          }));\n          if (processedData.length === 0) {\n            try {\n              const cmpRes = await goodsApi.compareGoods(searchQuery);\n              let responseData = [];\n              if (cmpRes.data && cmpRes.data.data) {\n                responseData = Array.isArray(cmpRes.data.data) ? cmpRes.data.data : [cmpRes.data.data];\n              }\n              let cmpProcessed = [];\n              if (responseData.length > 0) {\n                cmpProcessed = responseData.map(group => {\n                  const goodsList = Array.isArray(group.goodsList) ? group.goodsList : [];\n                  let lowestPrice = null;\n                  let lowestPlatform = '不明';\n                  if (goodsList.length > 0) {\n                    const lowestProduct = goodsList.reduce((lowest, current) => current.goodsPrice < lowest.goodsPrice ? current : lowest, goodsList[0]);\n                    lowestPrice = lowestProduct.goodsPrice;\n                    lowestPlatform = getPlatformName(lowestProduct.mallType);\n                  }\n                  return {\n                    goodsName: group.goodsName || '不明な商品',\n                    goodsList: goodsList.map(product => ({\n                      goodsId: product.goodsId,\n                      goodsName: product.goodsName,\n                      goodsPrice: product.goodsPrice,\n                      goodsLink: product.goodsLink,\n                      imgUrl: product.imgUrl || '',\n                      mallType: product.mallType\n                    })),\n                    lowestPrice: lowestPrice || 0,\n                    lowestPlatform\n                  };\n                });\n              }\n              setCompareGroups(cmpProcessed);\n              setLoading(false);\n              return;\n            } catch (e) {\n              console.warn('Fallback compare search failed', e);\n            }\n          }\n          setCompareGroups(processedData);\n        } else {\n          setCompareGroups([]);\n          setTotalItems(0);\n          try {\n            const cmpRes = await goodsApi.compareGoods(searchQuery);\n            let responseData = [];\n            if (cmpRes.data && cmpRes.data.data) {\n              responseData = Array.isArray(cmpRes.data.data) ? cmpRes.data.data : [cmpRes.data.data];\n            }\n            let processedData = [];\n            if (responseData.length > 0) {\n              processedData = responseData.map(group => {\n                const goodsList = Array.isArray(group.goodsList) ? group.goodsList : [];\n                let lowestPrice = null;\n                let lowestPlatform = '不明';\n                if (goodsList.length > 0) {\n                  const lowestProduct = goodsList.reduce((lowest, current) => current.goodsPrice < lowest.goodsPrice ? current : lowest, goodsList[0]);\n                  lowestPrice = lowestProduct.goodsPrice;\n                  lowestPlatform = getPlatformName(lowestProduct.mallType || 0);\n                }\n                return {\n                  goodsName: group.goodsName || '不明な商品',\n                  goodsList: goodsList.map(product => ({\n                    goodsId: product.goodsId,\n                    goodsName: product.goodsName,\n                    goodsPrice: product.goodsPrice,\n                    goodsLink: product.goodsLink,\n                    imgUrl: product.imgUrl,\n                    mallType: product.mallType\n                  })),\n                  lowestPrice: lowestPrice || 0,\n                  lowestPlatform\n                };\n              });\n            }\n            setCompareGroups(processedData);\n          } catch (e) {\n            console.warn('Fallback compare search failed', e);\n          }\n        }\n        setLoading(false);\n        return;\n      }\n\n      // デバッグ用ログ removed\n\n      // 使用api.ts中定义的API服务\n      const response = await goodsApi.compareGoods(searchQuery);\n\n      // デバッグ用ログ removed\n\n      let responseData = [];\n      if (response.data && response.data.data) {\n        responseData = Array.isArray(response.data.data) ? response.data.data : [response.data.data];\n      } else {\n        responseData = [];\n      }\n\n      // デバッグ用ログ removed\n\n      // レスポンスデータを処理\n      let processedData = [];\n      if (responseData.length > 0) {\n        // APIが返すグループデータを適切に処理\n        processedData = responseData.map(group => {\n          // グループ内の商品リストを処理\n          const goodsList = Array.isArray(group.goodsList) ? group.goodsList : [];\n\n          // 最低価格とプラットフォームを特定\n          let lowestPrice = null;\n          let lowestPlatform = '不明';\n\n          // 最低価格を計算\n          if (goodsList.length > 0) {\n            const lowestProduct = goodsList.reduce((lowest, current) => current.goodsPrice < lowest.goodsPrice ? current : lowest, goodsList[0]);\n            lowestPrice = lowestProduct.goodsPrice;\n            lowestPlatform = getPlatformName(lowestProduct.mallType);\n          }\n          return {\n            goodsName: group.goodsName || '不明な商品',\n            goodsList: goodsList.map(product => ({\n              goodsId: product.goodsId,\n              goodsName: product.goodsName,\n              goodsPrice: product.goodsPrice,\n              goodsLink: product.goodsLink,\n              imgUrl: product.imgUrl,\n              mallType: product.mallType\n            })),\n            lowestPrice: lowestPrice || 0,\n            lowestPlatform: lowestPlatform\n          };\n        });\n\n        // デバッグ用ログ removed\n      }\n\n      // Fallback: if compare returns empty, try local catalog search\n      if (processedData.length === 0) {\n        try {\n          const localRes = await goodsApi.getGoodsPage(searchQuery, undefined, undefined, currentPage, pageSize, undefined, undefined, selectedPlatforms);\n          if (localRes.data && localRes.data.code === 200) {\n            var _localRes$data$data, _localRes$data$data2;\n            const records = ((_localRes$data$data = localRes.data.data) === null || _localRes$data$data === void 0 ? void 0 : _localRes$data$data.records) || [];\n            setTotalItems(((_localRes$data$data2 = localRes.data.data) === null || _localRes$data$data2 === void 0 ? void 0 : _localRes$data$data2.total) || 0);\n            processedData = records.map(g => ({\n              goodsName: g.goodsName,\n              goodsList: [{\n                goodsId: g.goodsId,\n                goodsName: g.goodsName,\n                goodsPrice: g.goodsPrice,\n                goodsLink: g.goodsLink || '#',\n                imgUrl: g.imgUrl,\n                mallType: g.mallType || 0\n              }],\n              lowestPrice: g.goodsPrice,\n              lowestPlatform: getPlatformName(g.mallType || 0)\n            }));\n          }\n          // If still empty, try name-based search as last resort\n          if (processedData.length === 0) {\n            try {\n              const byNameRes = await goodsApi.searchGoodsByName(searchQuery);\n              const list = byNameRes.data && byNameRes.data.data ? Array.isArray(byNameRes.data.data) ? byNameRes.data.data : [byNameRes.data.data] : [];\n              processedData = list.map(g => ({\n                goodsName: g.goodsName,\n                goodsList: [{\n                  goodsId: g.goodsId,\n                  goodsName: g.goodsName,\n                  goodsPrice: g.goodsPrice,\n                  goodsLink: g.goodsLink || '#',\n                  imgUrl: g.imgUrl,\n                  mallType: g.mallType || 0\n                }],\n                lowestPrice: g.goodsPrice,\n                lowestPlatform: getPlatformName(g.mallType || 0)\n              }));\n            } catch (e) {\n              console.warn('Name-based fallback search failed', e);\n            }\n          }\n        } catch (e) {\n          console.warn('Local catalog fallback search failed', e);\n        }\n      }\n\n      // デバッグ用ログ removed\n\n      setCompareGroups(processedData);\n      setLoading(false);\n    } catch (err) {\n      try {\n        let processedData = [];\n        const searchRes = await goodsApi.searchGoods(searchQuery);\n        const list = searchRes.data && searchRes.data.data ? Array.isArray(searchRes.data.data) ? searchRes.data.data : [searchRes.data.data] : [];\n        processedData = list.map(g => ({\n          goodsName: g.goodsName,\n          goodsList: [{\n            goodsId: g.goodsId,\n            goodsName: g.goodsName,\n            goodsPrice: g.goodsPrice,\n            goodsLink: g.goodsLink || '#',\n            imgUrl: g.imgUrl,\n            mallType: g.mallType || 0\n          }],\n          lowestPrice: g.goodsPrice,\n          lowestPlatform: getPlatformName(g.mallType || 0)\n        }));\n        if (processedData.length === 0) {\n          const byNameRes = await goodsApi.searchGoodsByName(searchQuery);\n          const byNameList = byNameRes.data && byNameRes.data.data ? Array.isArray(byNameRes.data.data) ? byNameRes.data.data : [byNameRes.data.data] : [];\n          processedData = byNameList.map(g => ({\n            goodsName: g.goodsName,\n            goodsList: [{\n              goodsId: g.goodsId,\n              goodsName: g.goodsName,\n              goodsPrice: g.goodsPrice,\n              goodsLink: g.goodsLink || '#',\n              imgUrl: g.imgUrl,\n              mallType: g.mallType || 0\n            }],\n            lowestPrice: g.goodsPrice,\n            lowestPlatform: getPlatformName(g.mallType || 0)\n          }));\n        }\n        setCompareGroups(processedData);\n      } catch (fallbackErr) {\n        setError('検索に失敗しました。後ほど再試行してください');\n        console.warn(fallbackErr);\n      } finally {\n        setLoading(false);\n      }\n      console.warn(err);\n    }\n  };\n  const handleSearch = e => {\n    e.preventDefault();\n    if (query.trim()) {\n      searchProducts(query);\n    }\n  };\n  const getPlatformName = mallType => {\n    switch (mallType) {\n      case 10:\n        return '楽天';\n      case 20:\n        return 'Yahoo!';\n      case 40:\n        return 'Amazon';\n      default:\n        return '其他';\n    }\n  };\n  const getPlatformColor = mallType => {\n    switch (mallType) {\n      case 10:\n        return '#bf0000';\n      // Rakuten Red\n      case 20:\n        return '#ff0033';\n      // Yahoo Red\n      case 40:\n        return '#FF9900';\n      // Amazon Orange\n      default:\n        return '#666';\n    }\n  };\n  const getPlatformBadgeClass = mallType => {\n    switch (mallType) {\n      case 10:\n        return 'platform-badge rakuten';\n      case 20:\n        return 'platform-badge yahoo';\n      case 40:\n        return 'platform-badge amazon';\n      default:\n        return 'platform-badge unknown';\n    }\n  };\n  const allProducts = compareGroups.flatMap(group => group.goodsList);\n  const normalizedQuery = (executedQuery || query || '').toLowerCase();\n  const buildSearchTokens = q => {\n    const n = (q || '').toLowerCase().trim();\n    if (!n) return [];\n    const baseParts = n.split(/[\\s、，,。]+/).map(s => s.trim()).filter(Boolean);\n    const splitToken = t => {\n      const res = [];\n      let current = '';\n      let currentType = null;\n      for (const ch of t) {\n        const isLatin = /[a-z0-9]/i.test(ch);\n        const type = isLatin ? 'latin' : 'other';\n        if (currentType === null || currentType === type) {\n          current += ch;\n          currentType = type;\n        } else {\n          if (current.length > 0) {\n            res.push(current);\n          }\n          current = ch;\n          currentType = type;\n        }\n      }\n      if (current.length > 0) {\n        res.push(current);\n      }\n      return res;\n    };\n    const allParts = [];\n    baseParts.forEach(p => {\n      const parts = splitToken(p);\n      if (parts.length > 0) {\n        allParts.push(...parts);\n      } else {\n        allParts.push(p);\n      }\n    });\n    const deduped = Array.from(new Set(allParts));\n    return deduped.filter(p => p.length >= 2);\n  };\n  const searchTokens = buildSearchTokens(normalizedQuery);\n  const hasDeviceKeyword = /iphone|galaxy|xiaomi|huawei|pixel|xperia|ipad|macbook|thinkpad|notebook|laptop|surface|switch|playstation|ps5|xbox|tv|bravia|regza|monitor|display|camera|eos|alpha|冷蔵庫|冰箱|洗濯機|洗衣机|airpods|buds/i.test(normalizedQuery);\n  const hasAccessoryKeyword = /ケース|カバー|フィルム|充電器|ケーブル|保護|スタンド|ガラス|バンパー|壳|膜|支架|充電器|アダプタ|adapter|case|cover|charger|cable|ストラップ|ホルダー|dock|ドック|イヤホン|ヘッドホン/i.test(normalizedQuery);\n  const shouldFilterAccessories = hasDeviceKeyword && !hasAccessoryKeyword;\n  const isAccessoryProduct = name => {\n    const n = (name || '').toLowerCase();\n    return /ケース|カバー|フィルム|充電器|ケーブル|保護|スタンド|ガラス|バンパー|ストラップ|ホルダー|dock|ドック|adapter|アダプタ|イヤホン|ヘッドホン|screen protector|case|cover|charger|cable/.test(n);\n  };\n  const knownBrands = ['Apple', 'Samsung', 'Sony', 'Xiaomi', 'Huawei', 'Lenovo', 'Dell', 'HP', 'ASUS', 'Acer', 'Nintendo', 'Microsoft', 'Canon', 'Nikon'];\n  const parseFacets = name => {\n    const n = name || '';\n    const brand = knownBrands.find(b => new RegExp(b, 'i').test(n)) || '';\n    const seriesMatch = n.match(/(iPhone|MacBook|iPad|Galaxy|ThinkPad|Surface|PlayStation|Switch|WH\\-\\d{4}XM\\d|RX\\s?\\d{3,}|EOS\\s?\\w+)/i);\n    const series = seriesMatch ? seriesMatch[1] : '';\n    const modelMatch = n.match(/([A-Za-z]{1,3}\\-?\\d{2,4}[A-Za-z]?|\\bPro Max\\b|\\bPro\\b|\\bUltra\\b|\\bPlus\\b|\\bAir\\b|\\bMini\\b)/i);\n    const model = modelMatch ? modelMatch[1] : '';\n    const storageMatch = n.match(/(\\b\\d{2,4}\\s?(GB|TB)\\b)/i);\n    const storage = storageMatch ? storageMatch[1].replace(/\\s+/g, '') : '';\n    const colorMatch = n.match(/\\b(Black|White|Silver|Blue|Red|Green|Gold|Pink|Gray|Space Gray|Midnight|ブラック|ホワイト|シルバー|ブルー|レッド|グリーン|ゴールド|ピンク|グレー|スペースグレイ|ミッドナイト)\\b/i);\n    const color = colorMatch ? colorMatch[1] : '';\n    const sizeMatch = n.match(/(\\b\\d{1,2}(?:\\.\\d)?\\s?(?:吋|インチ|\"|英寸)\\b)/);\n    const size = sizeMatch ? sizeMatch[1] : '';\n    return {\n      brand,\n      series,\n      model,\n      storage,\n      color,\n      size\n    };\n  };\n  const facetIndex = allProducts.map(p => parseFacets(p.goodsName));\n  const brands = Array.from(new Set(facetIndex.map(f => f.brand).filter(Boolean)));\n  const series = Array.from(new Set(facetIndex.map(f => f.series).filter(Boolean)));\n  const models = Array.from(new Set(facetIndex.map(f => f.model).filter(Boolean)));\n  const storages = Array.from(new Set(facetIndex.map(f => f.storage).filter(Boolean)));\n  const colors = Array.from(new Set(facetIndex.map(f => f.color).filter(Boolean)));\n  const sizes = Array.from(new Set(facetIndex.map(f => f.size).filter(Boolean)));\n  const parseCategory = name => {\n    const n = (name || '').toLowerCase();\n    if (/手机壳|ケース|保护壳|カバー/.test(n)) return {\n      parent: 'スマホアクセサリー',\n      child: 'ケース'\n    };\n    if (/iphone|galaxy|xiaomi|huawei|pixel|xperia/.test(n)) return {\n      parent: '携帯電話・スマートフォン',\n      child: 'スマートフォン本体'\n    };\n    if (/ipad|galaxy tab|surface|tablet/.test(n)) return {\n      parent: 'パソコン・タブレット',\n      child: 'タブレットPC'\n    };\n    if (/macbook|thinkpad|notebook|laptop/.test(n)) return {\n      parent: 'パソコン・タブレット',\n      child: 'ノートパソコン'\n    };\n    if (/monitor|display|显示器/.test(n)) return {\n      parent: 'パソコン周辺機器',\n      child: 'モニター'\n    };\n    if (/mouse|keyboard|鼠标|键盘/.test(n)) return {\n      parent: 'パソコン周辺機器',\n      child: 'キーボード・マウス'\n    };\n    if (/airpods|buds|wh-|wf-|耳机/.test(n)) return {\n      parent: 'オーディオ・楽器',\n      child: 'ヘッドホン・イヤホン'\n    };\n    if (/tv|bravia|regza|电视/.test(n)) return {\n      parent: 'テレビ・映像機器',\n      child: 'テレビ'\n    };\n    if (/camera|eos|alpha|相机/.test(n)) return {\n      parent: 'カメラ',\n      child: 'デジタルカメラ'\n    };\n    if (/lens|镜头/.test(n)) return {\n      parent: 'カメラ',\n      child: 'レンズ'\n    };\n    if (/fridge|refrigerator|冰箱/.test(n)) return {\n      parent: '生活家電',\n      child: '冷蔵庫'\n    };\n    if (/washing|washer|洗衣机/.test(n)) return {\n      parent: '生活家電',\n      child: '洗濯機'\n    };\n    return {\n      parent: 'その他',\n      child: 'その他'\n    };\n  };\n  const categoriesAll = Array.from(new Set(allProducts.map(p => {\n    const c = parseCategory(p.goodsName);\n    return `${c.parent}>${c.child}`;\n  }).filter(x => x !== '其他>其他')));\n\n  // Build hierarchy tree\n  const categoryTree = {};\n  categoriesAll.forEach(c => {\n    const [p, child] = c.split('>');\n    if (!categoryTree[p]) categoryTree[p] = [];\n    if (!categoryTree[p].includes(child)) categoryTree[p].push(child);\n  });\n  const filteredProducts = allProducts.filter(p => {\n    const platformOk = selectedPlatforms.length === 0 || selectedPlatforms.includes(p.mallType);\n    const minOk = minPrice === '' || !isNaN(Number(minPrice)) && p.goodsPrice >= Number(minPrice);\n    const maxOk = maxPrice === '' || !isNaN(Number(maxPrice)) && p.goodsPrice <= Number(maxPrice);\n    const f = parseFacets(p.goodsName);\n    const brandOk = selectedBrands.length === 0 || f.brand && selectedBrands.includes(f.brand);\n    const seriesOk = selectedSeries.length === 0 || f.series && selectedSeries.includes(f.series);\n    const modelOk = selectedModels.length === 0 || f.model && selectedModels.includes(f.model);\n    const storageOk = selectedStorage.length === 0 || f.storage && selectedStorage.includes(f.storage);\n    const colorOk = selectedColors.length === 0 || f.color && selectedColors.includes(f.color);\n    const sizeOk = selectedSizes.length === 0 || f.size && selectedSizes.includes(f.size);\n    const cat = parseCategory(p.goodsName);\n    const catStr = `${cat.parent}>${cat.child}`;\n    const categoryOk = selectedCategories.length === 0 || selectedCategories.some(sc => sc === cat.parent || sc === catStr);\n    const validData = p.goodsPrice > 0 && p.goodsLink && p.goodsLink !== '#' && p.goodsLink !== '';\n    const accessoryOk = !shouldFilterAccessories || !isAccessoryProduct(p.goodsName);\n    const nameLower = (p.goodsName || '').toLowerCase();\n    const keywordOk = searchTokens.length === 0 || searchTokens.every(t => nameLower.includes(t));\n    return platformOk && minOk && maxOk && brandOk && seriesOk && modelOk && storageOk && colorOk && sizeOk && categoryOk && validData && accessoryOk && keywordOk;\n  });\n  const sortedProducts = [...filteredProducts].sort((a, b) => {\n    if (sortOption === 'price_asc') return a.goodsPrice - b.goodsPrice;\n    if (sortOption === 'price_desc') return b.goodsPrice - a.goodsPrice;\n    if (sortOption === 'platform') return a.mallType - b.mallType;\n    if (sortOption === 'name') return a.goodsName.localeCompare(b.goodsName);\n    return 0;\n  });\n  const togglePlatform = mt => {\n    setSelectedPlatforms(prev => prev.includes(mt) ? prev.filter(x => x !== mt) : [...prev, mt]);\n  };\n  const totalPages = searchSource === 'local' ? Math.max(1, Math.ceil(totalItems / pageSize)) : Math.max(1, Math.ceil(sortedProducts.length / pageSize));\n  const currentPageProducts = searchSource === 'local' ? sortedProducts : sortedProducts.slice((currentPage - 1) * pageSize, currentPage * pageSize);\n  const goPrev = () => setCurrentPage(p => Math.max(1, p - 1));\n  const goNext = () => setCurrentPage(p => Math.min(totalPages, p + 1));\n  const onChangePageSize = size => {\n    setPageSize(size);\n    setCurrentPage(1);\n  };\n  const getSelectKey = p => {\n    if (p.goodsId) return `id:${p.goodsId}`;\n    const base = `${p.mallType}-${p.goodsLink || ''}-${p.goodsName}`;\n    return `k:${base}`;\n  };\n  const isSelected = key => selectedKeys.includes(key);\n  const toggleSelect = p => {\n    const key = getSelectKey(p);\n    setSelectedKeys(prev => prev.includes(key) ? prev.filter(x => x !== key) : [...prev, key]);\n  };\n  const getSellerFromLink = url => {\n    if (!url) return '不明な店铺';\n    try {\n      const u = new URL(url.startsWith('http') ? url : 'https://' + url.replace(/^\\/\\//, ''));\n      return u.hostname.replace(/^www\\./, '');\n    } catch {\n      return '不明な店铺';\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"compare-page\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"search-section\",\n      children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n        children: \"\\u5546\\u54C1\\u4FA1\\u683C\\u6BD4\\u8F03\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 879,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"form\", {\n        onSubmit: handleSearch,\n        className: \"search-form\",\n        children: [/*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"text\",\n          value: query,\n          onChange: e => setQuery(e.target.value) // 仅更新状态，不触发搜索\n          ,\n          placeholder: \"\\u5546\\u54C1\\u540D\\u3092\\u5165\\u529B\\u3057\\u3066\\u4FA1\\u683C\\u6BD4\\u8F03...\",\n          className: \"search-input\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 881,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          type: \"submit\",\n          className: \"search-button\",\n          children: \"\\u641C\\u7D22\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 888,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 880,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 878,\n      columnNumber: 7\n    }, this), loading && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"loading\",\n      children: \"\\u691C\\u7D22\\u4E2D...\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 892,\n      columnNumber: 19\n    }, this), error && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"error\",\n      children: error\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 893,\n      columnNumber: 17\n    }, this), !loading && !error && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"compare-container\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"sidebar\",\n        children: [searchSource === 'local' && dynamicFilters.length > 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"sidebar-section dynamic-filters\",\n          children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n            className: \"sidebar-title\",\n            children: \"\\u5C5E\\u6027\\u7B5B\\u9009\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 905,\n            columnNumber: 17\n          }, this), dynamicFilters.map(attr => /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"filter-group\",\n            children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n              children: attr.name\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 908,\n              columnNumber: 21\n            }, this), /*#__PURE__*/_jsxDEV(\"ul\", {\n              className: \"filter-options\",\n              children: attr.values && attr.values.map(val => /*#__PURE__*/_jsxDEV(\"li\", {\n                children: /*#__PURE__*/_jsxDEV(\"label\", {\n                  children: [/*#__PURE__*/_jsxDEV(\"input\", {\n                    type: \"checkbox\",\n                    checked: selectedDynamicFilters[attr.id] === val,\n                    onChange: () => {\n                      setSelectedDynamicFilters(prev => {\n                        if (prev[attr.id] === val) {\n                          const next = {\n                            ...prev\n                          };\n                          delete next[attr.id];\n                          return next;\n                        }\n                        return {\n                          ...prev,\n                          [attr.id]: val\n                        };\n                      });\n                    }\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 913,\n                    columnNumber: 29\n                  }, this), val]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 912,\n                  columnNumber: 27\n                }, this)\n              }, val, false, {\n                fileName: _jsxFileName,\n                lineNumber: 911,\n                columnNumber: 25\n              }, this))\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 909,\n              columnNumber: 21\n            }, this)]\n          }, attr.id, true, {\n            fileName: _jsxFileName,\n            lineNumber: 907,\n            columnNumber: 19\n          }, this))]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 904,\n          columnNumber: 15\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"sidebar-section\",\n          children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n            className: \"sidebar-title\",\n            children: \"\\u4EF7\\u683C\\u533A\\u95F4\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 940,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"price-range-inputs\",\n            children: [/*#__PURE__*/_jsxDEV(\"input\", {\n              type: \"number\",\n              placeholder: \"\\xA5 min\",\n              value: minPrice,\n              onChange: e => setMinPrice(e.target.value)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 942,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              children: \"-\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 943,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n              type: \"number\",\n              placeholder: \"\\xA5 max\",\n              value: maxPrice,\n              onChange: e => setMaxPrice(e.target.value)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 944,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 941,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 939,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"sidebar-section\",\n          children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n            className: \"sidebar-title\",\n            children: \"\\u5546\\u57CE\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 949,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"ul\", {\n            className: \"filter-list\",\n            children: [/*#__PURE__*/_jsxDEV(\"li\", {\n              children: /*#__PURE__*/_jsxDEV(\"label\", {\n                children: [/*#__PURE__*/_jsxDEV(\"input\", {\n                  type: \"checkbox\",\n                  checked: selectedPlatforms.includes(10),\n                  onChange: () => togglePlatform(10)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 951,\n                  columnNumber: 28\n                }, this), \" \\u697D\\u5929\"]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 951,\n                columnNumber: 21\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 951,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n              children: /*#__PURE__*/_jsxDEV(\"label\", {\n                children: [/*#__PURE__*/_jsxDEV(\"input\", {\n                  type: \"checkbox\",\n                  checked: selectedPlatforms.includes(20),\n                  onChange: () => togglePlatform(20)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 952,\n                  columnNumber: 28\n                }, this), \" Yahoo!\\u30B7\\u30E7\\u30C3\\u30D4\\u30F3\\u30B0\"]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 952,\n                columnNumber: 21\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 952,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 950,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 948,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 899,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"main-content\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"results-header\",\n          children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n            children: [\"\\\"\", query, \"\\\" \\u641C\\u7D22\\u7ED3\\u679C \", /*#__PURE__*/_jsxDEV(\"span\", {\n              children: [\"(\", filteredProducts.length, \"\\u4EF6)\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 960,\n              columnNumber: 34\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 960,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"sort-bar\",\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"sort-label\",\n              children: \"\\u6392\\u5E8F:\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 962,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              className: `sort-tab ${sortOption === 'price_asc' ? 'active' : ''}`,\n              onClick: () => setSortOption('price_asc'),\n              children: \"\\u4EF7\\u683C\\u4F4E\\u5230\\u9AD8\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 963,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              className: `sort-tab ${sortOption === 'price_desc' ? 'active' : ''}`,\n              onClick: () => setSortOption('price_desc'),\n              children: \"\\u4EF7\\u683C\\u9AD8\\u5230\\u4F4E\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 964,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              className: `sort-tab ${sortOption === 'platform' ? 'active' : ''}`,\n              onClick: () => setSortOption('platform'),\n              children: \"\\u5546\\u57CE\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 965,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 961,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 959,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"product-list-view\",\n          children: currentPageProducts.map((product, index) => /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"product-row\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"p-image\",\n              children: /*#__PURE__*/_jsxDEV(\"img\", {\n                src: product.imgUrl || '/images/default-product.png',\n                alt: product.goodsName,\n                onError: e => e.target.src = '/images/default-product.png'\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 973,\n                columnNumber: 21\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 972,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"p-info\",\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"p-title-row\",\n                children: /*#__PURE__*/_jsxDEV(\"a\", {\n                  href: product.goodsLink,\n                  target: \"_blank\",\n                  rel: \"noopener noreferrer\",\n                  className: \"p-title\",\n                  onClick: e => {\n                    ensureGoodsIdAndHistory(product, e);\n                  },\n                  children: product.goodsName\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 977,\n                  columnNumber: 23\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 976,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"p-specs\",\n                children: function () {\n                  const f = parseFacets(product.goodsName);\n                  const parts = [f.brand, f.series, f.model, f.storage, f.color, f.size].filter(Boolean);\n                  return parts.join(' | ');\n                }()\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 987,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"p-meta\",\n                children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                  className: `mall-tag mall-${product.mallType}`,\n                  children: getPlatformName(product.mallType)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 995,\n                  columnNumber: 23\n                }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                  className: \"seller\",\n                  children: getSellerFromLink(product.goodsLink)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 996,\n                  columnNumber: 23\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 994,\n                columnNumber: 21\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 975,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"p-action\",\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"p-price\",\n                children: [product.goodsPrice.toLocaleString(), \"\\u5186\"]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 1000,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(\"a\", {\n                href: product.goodsLink,\n                target: \"_blank\",\n                rel: \"noopener noreferrer\",\n                className: \"btn-shop\",\n                onClick: e => {\n                  ensureGoodsIdAndHistory(product, e);\n                },\n                children: \"\\u524D\\u5F80\\u8D2D\\u4E70\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1001,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                className: \"btn-trend\",\n                onClick: () => {\n                  ensureGoodsIdAndCollect(product);\n                },\n                children: product.goodsId && collectedIds.has(product.goodsId) ? '取消收藏' : '收藏'\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1010,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                className: \"btn-trend\",\n                onClick: () => {\n                  const title = product.goodsName;\n                  const labels = Array.from({\n                    length: 12\n                  }, (_, i) => {\n                    const d = new Date();\n                    d.setMonth(d.getMonth() - (11 - i));\n                    const m = (d.getMonth() + 1).toString().padStart(2, '0');\n                    return `${d.getFullYear()}-${m}`;\n                  });\n                  const base = Math.max(1, product.goodsPrice);\n                  let val = base * 1.0;\n                  const series = labels.map((_, i) => {\n                    const drift = 1 + Math.sin(i / 3) * 0.05;\n                    const noise = 1 + (Math.random() - 0.5) * 0.08;\n                    val = Math.max(1, val * drift * noise);\n                    return Math.round(val);\n                  });\n                  setTrendTitle(title);\n                  setTrendLabels(labels);\n                  setTrendSeries(series);\n                  setTrendOpen(true);\n                },\n                children: \"\\u4EF7\\u683C\\u8D70\\u52BF\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1011,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n                className: \"compare-check\",\n                children: [/*#__PURE__*/_jsxDEV(\"input\", {\n                  type: \"checkbox\",\n                  checked: isSelected(getSelectKey(product)),\n                  onChange: () => toggleSelect(product)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1033,\n                  columnNumber: 23\n                }, this), \" \\u5BF9\\u6BD4\"]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 1032,\n                columnNumber: 21\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 999,\n              columnNumber: 19\n            }, this)]\n          }, index, true, {\n            fileName: _jsxFileName,\n            lineNumber: 971,\n            columnNumber: 17\n          }, this))\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 969,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"pagination-controls\",\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            type: \"button\",\n            onClick: goPrev,\n            disabled: currentPage === 1,\n            children: \"\\u4E0A\\u4E00\\u9875\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1041,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"page-info\",\n            children: [currentPage, \" / \", totalPages]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1042,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            type: \"button\",\n            onClick: goNext,\n            disabled: currentPage === totalPages,\n            children: \"\\u4E0B\\u4E00\\u9875\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1043,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1040,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 958,\n        columnNumber: 11\n      }, this), trendOpen && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"price-trend-modal\",\n        onClick: () => setTrendOpen(false),\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"modal-content\",\n          onClick: e => e.stopPropagation(),\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"modal-header\",\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"modal-title\",\n              children: trendTitle\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1051,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              type: \"button\",\n              className: \"modal-close\",\n              onClick: () => setTrendOpen(false),\n              children: \"\\xD7\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1052,\n              columnNumber: 19\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1050,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"modal-body\",\n            children: /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"trend-chart\",\n              children: function () {\n                const width = 600;\n                const height = 280;\n                const padding = 32;\n                const xs = trendSeries.map((_, i) => padding + i * (width - 2 * padding) / (trendSeries.length - 1));\n                const minV = Math.min(...trendSeries);\n                const maxV = Math.max(...trendSeries);\n                const ys = trendSeries.map(v => height - padding - (v - minV) / Math.max(1, maxV - minV) * (height - 2 * padding));\n                const path = xs.map((x, i) => `${i === 0 ? 'M' : 'L'}${x},${ys[i]}`).join(' ');\n                const gridY = [0.25, 0.5, 0.75].map(r => height - padding - r * (height - 2 * padding));\n                return /*#__PURE__*/_jsxDEV(\"svg\", {\n                  width: width,\n                  height: height,\n                  role: \"img\",\n                  \"aria-label\": \"\\u4EF7\\u683C\\u8D8B\\u52BF\\u56FE\",\n                  children: [gridY.map((gy, i) => /*#__PURE__*/_jsxDEV(\"line\", {\n                    x1: padding,\n                    y1: gy,\n                    x2: width - padding,\n                    y2: gy,\n                    stroke: \"#eee\"\n                  }, i, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1069,\n                    columnNumber: 29\n                  }, this)), /*#__PURE__*/_jsxDEV(\"path\", {\n                    d: path,\n                    fill: \"none\",\n                    stroke: \"#ff4400\",\n                    strokeWidth: 2\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1071,\n                    columnNumber: 27\n                  }, this), xs.map((x, i) => /*#__PURE__*/_jsxDEV(\"circle\", {\n                    cx: x,\n                    cy: ys[i],\n                    r: 3,\n                    fill: \"#ff4400\"\n                  }, i, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1073,\n                    columnNumber: 29\n                  }, this)), /*#__PURE__*/_jsxDEV(\"text\", {\n                    x: padding,\n                    y: height - 8,\n                    fontSize: 12,\n                    fill: \"#999\",\n                    children: trendLabels[0]\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1075,\n                    columnNumber: 27\n                  }, this), /*#__PURE__*/_jsxDEV(\"text\", {\n                    x: width - padding - 60,\n                    y: height - 8,\n                    fontSize: 12,\n                    fill: \"#999\",\n                    children: trendLabels[trendLabels.length - 1]\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1076,\n                    columnNumber: 27\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1067,\n                  columnNumber: 25\n                }, this);\n              }()\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1055,\n              columnNumber: 19\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1054,\n            columnNumber: 17\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1049,\n          columnNumber: 15\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1048,\n        columnNumber: 13\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 897,\n      columnNumber: 9\n    }, this), !loading && !error && compareGroups.length === 0 && query && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"no-results\",\n      children: \"\\u95A2\\u9023\\u5546\\u54C1\\u304C\\u898B\\u3064\\u304B\\u308A\\u307E\\u305B\\u3093\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 1089,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 877,\n    columnNumber: 5\n  }, this);\n};\n_s(ComparePage, \"nUjoAD+yfFmb9mI3mxpfTADMHsc=\", false, function () {\n  return [useSearchParams];\n});\n_c = ComparePage;\nexport default ComparePage;\nvar _c;\n$RefreshReg$(_c, \"ComparePage\");","map":{"version":3,"names":["React","useState","useEffect","useSearchParams","goodsApi","categoryApi","goodsOperateApi","jsxDEV","_jsxDEV","ComparePage","_s","searchParams","query","setQuery","saved","sessionStorage","getItem","get","compareGroups","setCompareGroups","JSON","parse","loading","setLoading","error","setError","sortOption","setSortOption","selectedPlatforms","setSelectedPlatforms","minPrice","setMinPrice","maxPrice","setMaxPrice","currentPage","setCurrentPage","parseInt","pageSize","setPageSize","selectedKeys","setSelectedKeys","selectedBrands","setSelectedBrands","selectedSeries","setSelectedSeries","selectedModels","setSelectedModels","selectedStorage","setSelectedStorage","selectedColors","setSelectedColors","selectedSizes","setSelectedSizes","selectedCategories","setSelectedCategories","trendOpen","setTrendOpen","trendLabels","setTrendLabels","trendSeries","setTrendSeries","trendTitle","setTrendTitle","collectedIds","setCollectedIds","Set","searchSource","setSearchSource","executedQuery","setExecutedQuery","totalItems","setTotalItems","categories","setCategories","dynamicFilters","setDynamicFilters","selectedDynamicFilters","setSelectedDynamicFilters","currentCatId","setCurrentCatId","setItem","stringify","toString","Array","from","getList","then","res","data","code","catch","err","console","warn","trim","searchProducts","getAttributes","getMyCollect","isArray","ids","map","g","goodsId","filter","id","e","toggleCollect","has","cancelCollect","prev","next","delete","collect","add","alert","ensureGoodsIdAndCollect","product","token","localStorage","payload","goodsName","goodsPrice","goodsLink","imgUrl","mallType","status","addRes","addAndReturn","newId","ensureGoodsIdAndHistory","event","targetUrl","window","open","searchQuery","minP","Number","undefined","maxP","response","getGoodsPage","records","total","processedData","goodsList","lowestPrice","lowestPlatform","getPlatformName","length","cmpRes","compareGoods","responseData","cmpProcessed","group","lowestProduct","reduce","lowest","current","localRes","_localRes$data$data","_localRes$data$data2","byNameRes","searchGoodsByName","list","searchRes","searchGoods","byNameList","fallbackErr","handleSearch","preventDefault","getPlatformColor","getPlatformBadgeClass","allProducts","flatMap","normalizedQuery","toLowerCase","buildSearchTokens","q","n","baseParts","split","s","Boolean","splitToken","t","currentType","ch","isLatin","test","type","push","allParts","forEach","p","parts","deduped","searchTokens","hasDeviceKeyword","hasAccessoryKeyword","shouldFilterAccessories","isAccessoryProduct","name","knownBrands","parseFacets","brand","find","b","RegExp","seriesMatch","match","series","modelMatch","model","storageMatch","storage","replace","colorMatch","color","sizeMatch","size","facetIndex","brands","f","models","storages","colors","sizes","parseCategory","parent","child","categoriesAll","c","x","categoryTree","includes","filteredProducts","platformOk","minOk","isNaN","maxOk","brandOk","seriesOk","modelOk","storageOk","colorOk","sizeOk","cat","catStr","categoryOk","some","sc","validData","accessoryOk","nameLower","keywordOk","every","sortedProducts","sort","a","localeCompare","togglePlatform","mt","totalPages","Math","max","ceil","currentPageProducts","slice","goPrev","goNext","min","onChangePageSize","getSelectKey","base","isSelected","key","toggleSelect","getSellerFromLink","url","u","URL","startsWith","hostname","className","children","fileName","_jsxFileName","lineNumber","columnNumber","onSubmit","value","onChange","target","placeholder","attr","values","val","checked","onClick","index","src","alt","onError","href","rel","join","toLocaleString","title","labels","_","i","d","Date","setMonth","getMonth","m","padStart","getFullYear","drift","sin","noise","random","round","disabled","stopPropagation","width","height","padding","xs","minV","maxV","ys","v","path","gridY","r","role","gy","x1","y1","x2","y2","stroke","fill","strokeWidth","cx","cy","y","fontSize","_c","$RefreshReg$"],"sources":["C:/Users/3jz/Desktop/HJZDM/frontend/hjzdm-frontend/src/pages/ComparePage.tsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { useSearchParams } from 'react-router-dom';\r\nimport './ComparePage.css';\r\nimport { goodsApi, categoryApi, userApi, goodsOperateApi } from '../services/api';\r\n\r\ninterface Product {\r\n  goodsId?: number;\r\n  goodsName: string;\r\n  goodsPrice: number;\r\n  goodsLink: string;\r\n  imgUrl?: string;\r\n  mallType: number;\r\n}\r\n\r\ninterface CompareGroup {\r\n  goodsName: string;\r\n  goodsList: Product[];\r\n  lowestPrice: number | null;\r\n  lowestPlatform?: string;\r\n}\r\n\r\nconst ComparePage: React.FC = () => {\r\n  const [searchParams] = useSearchParams();\r\n  \r\n  // 从 sessionStorage 恢复状态\r\n  const [query, setQuery] = useState(() => {\r\n    const saved = sessionStorage.getItem('comparePage_query');\r\n    return searchParams.get('query') || saved || '';\r\n  });\r\n  \r\n  const [compareGroups, setCompareGroups] = useState<CompareGroup[]>(() => {\r\n    const saved = sessionStorage.getItem('comparePage_compareGroups');\r\n    return saved ? JSON.parse(saved) : [];\r\n  });\r\n  \r\n  const [loading, setLoading] = useState(() => {\r\n    const saved = sessionStorage.getItem('comparePage_loading');\r\n    return saved ? JSON.parse(saved) : false;\r\n  });\r\n  \r\n  const [error, setError] = useState<string | null>(() => {\r\n    const saved = sessionStorage.getItem('comparePage_error');\r\n    return saved ? JSON.parse(saved) : null;\r\n  });\r\n  \r\n  const [sortOption, setSortOption] = useState(() => {\r\n    const saved = sessionStorage.getItem('comparePage_sortOption');\r\n    return saved || 'price_asc';\r\n  });\r\n  \r\n  const [selectedPlatforms, setSelectedPlatforms] = useState<number[]>(() => {\r\n    const saved = sessionStorage.getItem('comparePage_selectedPlatforms');\r\n    return saved ? JSON.parse(saved) : [];\r\n  });\r\n  \r\n  const [minPrice, setMinPrice] = useState(() => {\r\n    const saved = sessionStorage.getItem('comparePage_minPrice');\r\n    return saved || '';\r\n  });\r\n  \r\n  const [maxPrice, setMaxPrice] = useState(() => {\r\n    const saved = sessionStorage.getItem('comparePage_maxPrice');\r\n    return saved || '';\r\n  });\r\n  \r\n  const [currentPage, setCurrentPage] = useState(() => {\r\n    const saved = sessionStorage.getItem('comparePage_currentPage');\r\n    return saved ? parseInt(saved) : 1;\r\n  });\r\n  \r\n  const [pageSize, setPageSize] = useState(() => {\r\n    const saved = sessionStorage.getItem('comparePage_pageSize');\r\n    return saved ? parseInt(saved) : 50;\r\n  });\r\n  \r\n  const [selectedKeys, setSelectedKeys] = useState<string[]>(() => {\r\n    const saved = sessionStorage.getItem('comparePage_selectedKeys');\r\n    return saved ? JSON.parse(saved) : [];\r\n  });\r\n  \r\n  const [selectedBrands, setSelectedBrands] = useState<string[]>(() => {\r\n    const saved = sessionStorage.getItem('comparePage_selectedBrands');\r\n    return saved ? JSON.parse(saved) : [];\r\n  });\r\n  \r\n  const [selectedSeries, setSelectedSeries] = useState<string[]>(() => {\r\n    const saved = sessionStorage.getItem('comparePage_selectedSeries');\r\n    return saved ? JSON.parse(saved) : [];\r\n  });\r\n  \r\n  const [selectedModels, setSelectedModels] = useState<string[]>(() => {\r\n    const saved = sessionStorage.getItem('comparePage_selectedModels');\r\n    return saved ? JSON.parse(saved) : [];\r\n  });\r\n  \r\n  const [selectedStorage, setSelectedStorage] = useState<string[]>(() => {\r\n    const saved = sessionStorage.getItem('comparePage_selectedStorage');\r\n    return saved ? JSON.parse(saved) : [];\r\n  });\r\n  \r\n  const [selectedColors, setSelectedColors] = useState<string[]>(() => {\r\n    const saved = sessionStorage.getItem('comparePage_selectedColors');\r\n    return saved ? JSON.parse(saved) : [];\r\n  });\r\n  \r\n  const [selectedSizes, setSelectedSizes] = useState<string[]>(() => {\r\n    const saved = sessionStorage.getItem('comparePage_selectedSizes');\r\n    return saved ? JSON.parse(saved) : [];\r\n  });\r\n  \r\n  const [selectedCategories, setSelectedCategories] = useState<string[]>(() => {\r\n    const saved = sessionStorage.getItem('comparePage_selectedCategories');\r\n    return saved ? JSON.parse(saved) : [];\r\n  });\r\n  \r\n  const [trendOpen, setTrendOpen] = useState(() => {\r\n    const saved = sessionStorage.getItem('comparePage_trendOpen');\r\n    return saved ? JSON.parse(saved) : false;\r\n  });\r\n  \r\n  const [trendLabels, setTrendLabels] = useState<string[]>(() => {\r\n    const saved = sessionStorage.getItem('comparePage_trendLabels');\r\n    return saved ? JSON.parse(saved) : [];\r\n  });\r\n  \r\n  const [trendSeries, setTrendSeries] = useState<number[]>(() => {\r\n    const saved = sessionStorage.getItem('comparePage_trendSeries');\r\n    return saved ? JSON.parse(saved) : [];\r\n  });\r\n  \r\n  const [trendTitle, setTrendTitle] = useState(() => {\r\n    const saved = sessionStorage.getItem('comparePage_trendTitle');\r\n    return saved || '';\r\n  });\r\n  \r\n  const [collectedIds, setCollectedIds] = useState<Set<number>>(() => {\r\n    const saved = sessionStorage.getItem('comparePage_collectedIds');\r\n    return saved ? new Set(JSON.parse(saved)) : new Set();\r\n  });\r\n  \r\n  // Search Source\r\n  const [searchSource, setSearchSource] = useState<'local' | 'compare'>(() => {\r\n    const saved = sessionStorage.getItem('comparePage_searchSource');\r\n    return saved || 'compare';\r\n  });\r\n  \r\n  const [executedQuery, setExecutedQuery] = useState(() => {\r\n    const saved = sessionStorage.getItem('comparePage_executedQuery');\r\n    return saved || '';\r\n  });\r\n  \r\n  const [totalItems, setTotalItems] = useState(() => {\r\n    const saved = sessionStorage.getItem('comparePage_totalItems');\r\n    return saved ? parseInt(saved) : 0;\r\n  });\r\n\r\n  // Dynamic Filters State\r\n  const [categories, setCategories] = useState<{ catId: number, catName: string, children?: any[] }[]>([]);\r\n  const [dynamicFilters, setDynamicFilters] = useState<{ id: number, name: string, type: string, attrId: number, attrName: string, values?: string[] }[]>([]);\r\n  const [selectedDynamicFilters, setSelectedDynamicFilters] = useState<Record<string, string>>({});\r\n  const [currentCatId, setCurrentCatId] = useState<number | null>(null);\r\n\r\n  // 保存状态到 sessionStorage\r\n  useEffect(() => {\r\n    sessionStorage.setItem('comparePage_query', query);\r\n  }, [query]);\r\n  \r\n  useEffect(() => {\r\n    sessionStorage.setItem('comparePage_compareGroups', JSON.stringify(compareGroups));\r\n  }, [compareGroups]);\r\n  \r\n  useEffect(() => {\r\n    sessionStorage.setItem('comparePage_loading', JSON.stringify(loading));\r\n  }, [loading]);\r\n  \r\n  useEffect(() => {\r\n    sessionStorage.setItem('comparePage_error', JSON.stringify(error));\r\n  }, [error]);\r\n  \r\n  useEffect(() => {\r\n    sessionStorage.setItem('comparePage_sortOption', sortOption);\r\n  }, [sortOption]);\r\n  \r\n  useEffect(() => {\r\n    sessionStorage.setItem('comparePage_selectedPlatforms', JSON.stringify(selectedPlatforms));\r\n  }, [selectedPlatforms]);\r\n  \r\n  useEffect(() => {\r\n    sessionStorage.setItem('comparePage_minPrice', minPrice);\r\n  }, [minPrice]);\r\n  \r\n  useEffect(() => {\r\n    sessionStorage.setItem('comparePage_maxPrice', maxPrice);\r\n  }, [maxPrice]);\r\n  \r\n  useEffect(() => {\r\n    sessionStorage.setItem('comparePage_currentPage', currentPage.toString());\r\n  }, [currentPage]);\r\n  \r\n  useEffect(() => {\r\n    sessionStorage.setItem('comparePage_pageSize', pageSize.toString());\r\n  }, [pageSize]);\r\n  \r\n  useEffect(() => {\r\n    sessionStorage.setItem('comparePage_selectedKeys', JSON.stringify(selectedKeys));\r\n  }, [selectedKeys]);\r\n  \r\n  useEffect(() => {\r\n    sessionStorage.setItem('comparePage_selectedBrands', JSON.stringify(selectedBrands));\r\n  }, [selectedBrands]);\r\n  \r\n  useEffect(() => {\r\n    sessionStorage.setItem('comparePage_selectedSeries', JSON.stringify(selectedSeries));\r\n  }, [selectedSeries]);\r\n  \r\n  useEffect(() => {\r\n    sessionStorage.setItem('comparePage_selectedModels', JSON.stringify(selectedModels));\r\n  }, [selectedModels]);\r\n  \r\n  useEffect(() => {\r\n    sessionStorage.setItem('comparePage_selectedStorage', JSON.stringify(selectedStorage));\r\n  }, [selectedStorage]);\r\n  \r\n  useEffect(() => {\r\n    sessionStorage.setItem('comparePage_selectedColors', JSON.stringify(selectedColors));\r\n  }, [selectedColors]);\r\n  \r\n  useEffect(() => {\r\n    sessionStorage.setItem('comparePage_selectedSizes', JSON.stringify(selectedSizes));\r\n  }, [selectedSizes]);\r\n  \r\n  useEffect(() => {\r\n    sessionStorage.setItem('comparePage_selectedCategories', JSON.stringify(selectedCategories));\r\n  }, [selectedCategories]);\r\n  \r\n  useEffect(() => {\r\n    sessionStorage.setItem('comparePage_trendOpen', JSON.stringify(trendOpen));\r\n  }, [trendOpen]);\r\n  \r\n  useEffect(() => {\r\n    sessionStorage.setItem('comparePage_trendLabels', JSON.stringify(trendLabels));\r\n  }, [trendLabels]);\r\n  \r\n  useEffect(() => {\r\n    sessionStorage.setItem('comparePage_trendSeries', JSON.stringify(trendSeries));\r\n  }, [trendSeries]);\r\n  \r\n  useEffect(() => {\r\n    sessionStorage.setItem('comparePage_trendTitle', trendTitle);\r\n  }, [trendTitle]);\r\n  \r\n  useEffect(() => {\r\n    sessionStorage.setItem('comparePage_collectedIds', JSON.stringify(Array.from(collectedIds)));\r\n  }, [collectedIds]);\r\n  \r\n  useEffect(() => {\r\n    sessionStorage.setItem('comparePage_searchSource', searchSource);\r\n  }, [searchSource]);\r\n  \r\n  useEffect(() => {\r\n    sessionStorage.setItem('comparePage_executedQuery', executedQuery);\r\n  }, [executedQuery]);\r\n  \r\n  useEffect(() => {\r\n    sessionStorage.setItem('comparePage_totalItems', totalItems.toString());\r\n  }, [totalItems]);\r\n  \r\n  // Fetch categories on mount\r\n  useEffect(() => {\r\n    categoryApi.getList().then(res => {\r\n      if (res.data.code === 200) {\r\n        setCategories(res.data.data);\r\n      }\r\n    }).catch(err => console.warn(\"Failed to fetch categories\", err));\r\n  }, []);\r\n\r\n  // 仅在页面加载时，如果有URL参数，则执行搜索\r\n  useEffect(() => {\r\n    if (query.trim()) {\r\n      searchProducts(query);\r\n    }\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, []);\r\n\r\n  // Fetch dynamic attributes when category changes\r\n  useEffect(() => {\r\n    if (currentCatId) {\r\n      categoryApi.getAttributes(currentCatId).then(res => {\r\n        if (res.data.code === 200) {\r\n          setDynamicFilters(res.data.data);\r\n        }\r\n      }).catch(err => console.warn(\"Failed to fetch attributes\", err));\r\n    } else {\r\n      setDynamicFilters([]);\r\n    }\r\n  }, [currentCatId]);\r\n\r\n  // Auto-search when filters change (Local Mode only)\r\n  useEffect(() => {\r\n    if (searchSource === 'local') {\r\n      searchProducts(executedQuery || query);\r\n    }\r\n  }, [selectedDynamicFilters, currentCatId, currentPage, pageSize, searchSource, selectedPlatforms]);\r\n\r\n  useEffect(() => {\r\n    (async () => {\r\n      try {\r\n        const res = await goodsApi.getMyCollect(1, 500);\r\n        if (res.data && res.data.code === 200 && Array.isArray(res.data.data)) {\r\n          const ids = res.data.data.map((g: { goodsId: number }) => g.goodsId).filter((id: number) => typeof id === 'number');\r\n          setCollectedIds(new Set(ids));\r\n        }\r\n      } catch (e) {\r\n      }\r\n    })();\r\n  }, []);\r\n\r\n  const toggleCollect = async (goodsId: number) => {\r\n    try {\r\n      if (collectedIds.has(goodsId)) {\r\n        const res = await goodsOperateApi.cancelCollect(goodsId);\r\n        if (res.data && res.data.code === 200) {\r\n          setCollectedIds(prev => {\r\n            const next = new Set(prev);\r\n            next.delete(goodsId);\r\n            return next;\r\n          });\r\n        }\r\n      } else {\r\n        const res = await goodsOperateApi.collect(goodsId);\r\n        if (res.data && res.data.code === 200) {\r\n          setCollectedIds(prev => {\r\n            const next = new Set(prev);\r\n            next.add(goodsId);\r\n            return next;\r\n          });\r\n        } else {\r\n          alert('请先登录');\r\n        }\r\n      }\r\n    } catch (e) {\r\n      alert('操作失败');\r\n    }\r\n  };\r\n\r\n  const ensureGoodsIdAndCollect = async (product: Product) => {\r\n    try {\r\n      const token = localStorage.getItem('token');\r\n      if (!token) {\r\n        alert('请先登录');\r\n        return;\r\n      }\r\n      if (product.goodsId) {\r\n        await toggleCollect(product.goodsId);\r\n        return;\r\n      }\r\n      const payload: { goodsName: string, goodsPrice: number, goodsLink: string, imgUrl: string, mallType: number, status: number } = {\r\n        goodsName: product.goodsName,\r\n        goodsPrice: product.goodsPrice,\r\n        goodsLink: product.goodsLink,\r\n        imgUrl: product.imgUrl || '',\r\n        mallType: product.mallType,\r\n        status: 1\r\n      };\r\n      const addRes = await goodsApi.addAndReturn(payload);\r\n      if (addRes.data && addRes.data.code === 200 && addRes.data.data && addRes.data.data.goodsId) {\r\n        const newId = addRes.data.data.goodsId as number;\r\n        await toggleCollect(newId);\r\n      } else {\r\n        alert('新增商品失败');\r\n      }\r\n    } catch (e) {\r\n      alert('操作失败');\r\n    }\r\n  };\r\n\r\n  const ensureGoodsIdAndHistory = async (product: Product, event?: React.MouseEvent) => {\r\n    // 直接跳转，不再记录浏览历史\r\n    const targetUrl = product.goodsLink;\r\n    if (targetUrl) {\r\n      window.open(targetUrl, '_blank', 'noopener,noreferrer');\r\n    }\r\n  };\r\n\r\n  const searchProducts = async (searchQuery: string) => {\r\n    // Debug log removed\r\n    if (!searchQuery.trim() && searchSource === 'compare') return;\r\n\r\n    setExecutedQuery(searchQuery);\r\n    setLoading(true);\r\n    setError(null);\r\n\r\n    try {\r\n      if (searchSource === 'local') {\r\n        const minP = minPrice ? Number(minPrice) : undefined;\r\n        const maxP = maxPrice ? Number(maxPrice) : undefined;\r\n        // Debug log removed\r\n        const response = await goodsApi.getGoodsPage(searchQuery, selectedDynamicFilters, currentCatId || undefined, currentPage, pageSize, minP, maxP, selectedPlatforms);\r\n        // Debug log removed\r\n\r\n        if (response.data && response.data.code === 200) {\r\n          const records = response.data.data.records || [];\r\n          setTotalItems(response.data.data.total || 0);\r\n          const processedData = records.map((g: { goodsId: number, goodsName: string, goodsPrice: number, goodsLink: string, imgUrl: string, mallType: number }) => ({\r\n            goodsName: g.goodsName,\r\n            goodsList: [{\r\n              goodsId: g.goodsId,\r\n              goodsName: g.goodsName,\r\n              goodsPrice: g.goodsPrice,\r\n              goodsLink: g.goodsLink || '#',\r\n              imgUrl: g.imgUrl,\r\n              mallType: g.mallType || 0\r\n            }],\r\n            lowestPrice: g.goodsPrice,\r\n            lowestPlatform: getPlatformName(g.mallType || 0)\r\n          }));\r\n          if (processedData.length === 0) {\r\n            try {\r\n              const cmpRes = await goodsApi.compareGoods(searchQuery);\r\n              let responseData: { goodsName: string, goodsList: any[], lowestPrice: number, lowestPlatform: string }[] = [];\r\n              if (cmpRes.data && cmpRes.data.data) {\r\n                responseData = Array.isArray(cmpRes.data.data) ? cmpRes.data.data : [cmpRes.data.data];\r\n              }\r\n              let cmpProcessed: { goodsName: string, goodsList: any[], lowestPrice: number, lowestPlatform: string }[] = [];\r\n              if (responseData.length > 0) {\r\n                cmpProcessed = responseData.map((group: { goodsName: string, goodsList: any[], lowestPrice: number, lowestPlatform: string }) => {\r\n                  const goodsList = Array.isArray(group.goodsList) ? group.goodsList : [];\r\n                  let lowestPrice: number | null = null;\r\n                  let lowestPlatform = '不明';\r\n                  if (goodsList.length > 0) {\r\n                    const lowestProduct = goodsList.reduce((lowest: any, current: any) =>\r\n                      current.goodsPrice < lowest.goodsPrice ? current : lowest, goodsList[0]);\r\n                    lowestPrice = lowestProduct.goodsPrice;\r\n                    lowestPlatform = getPlatformName(lowestProduct.mallType);\r\n                  }\r\n                  return {\r\n                    goodsName: group.goodsName || '不明な商品',\r\n                    goodsList: goodsList.map((product: any) => ({\r\n                      goodsId: product.goodsId,\r\n                      goodsName: product.goodsName,\r\n                      goodsPrice: product.goodsPrice,\r\n                      goodsLink: product.goodsLink,\r\n                      imgUrl: product.imgUrl || '',\r\n                      mallType: product.mallType\r\n                    })),\r\n                    lowestPrice: lowestPrice || 0,\r\n                    lowestPlatform\r\n                  };\r\n                });\r\n              }\r\n              setCompareGroups(cmpProcessed);\r\n              setLoading(false);\r\n              return;\r\n            } catch (e) {\r\n              console.warn('Fallback compare search failed', e);\r\n            }\r\n          }\r\n          setCompareGroups(processedData);\r\n        } else {\r\n          setCompareGroups([]);\r\n          setTotalItems(0);\r\n          try {\r\n            const cmpRes = await goodsApi.compareGoods(searchQuery);\r\n            let responseData: { goodsName: string, goodsList: any[], lowestPrice: number, lowestPlatform: string }[] = [];\r\n            if (cmpRes.data && cmpRes.data.data) {\r\n              responseData = Array.isArray(cmpRes.data.data) ? cmpRes.data.data : [cmpRes.data.data];\r\n            }\r\n            let processedData: { goodsName: string, goodsList: any[], lowestPrice: number, lowestPlatform: string }[] = [];\r\n            if (responseData.length > 0) {\r\n              processedData = responseData.map((group: { goodsName: string, goodsList: any[], lowestPrice: number | null, lowestPlatform: string }) => {\r\n                const goodsList = Array.isArray(group.goodsList) ? group.goodsList : [];\r\n                let lowestPrice: number | null = null;\r\n                let lowestPlatform = '不明';\r\n                if (goodsList.length > 0) {\r\n                  const lowestProduct = goodsList.reduce((lowest: { goodsPrice: number, mallType?: number }, current: { goodsPrice: number, mallType?: number }) =>\r\n                    current.goodsPrice < lowest.goodsPrice ? current : lowest, goodsList[0]);\r\n                  lowestPrice = lowestProduct.goodsPrice;\r\n                  lowestPlatform = getPlatformName((lowestProduct as any).mallType || 0);\r\n                }\r\n                return {\r\n                  goodsName: group.goodsName || '不明な商品',\r\n                  goodsList: goodsList.map((product: { goodsId: number, goodsName: string, goodsPrice: number, goodsLink: string, imgUrl: string, mallType: number }) => ({\r\n                    goodsId: product.goodsId,\r\n                    goodsName: product.goodsName,\r\n                    goodsPrice: product.goodsPrice,\r\n                    goodsLink: product.goodsLink,\r\n                    imgUrl: product.imgUrl,\r\n                    mallType: product.mallType\r\n                  })),\r\n                  lowestPrice: lowestPrice || 0,\r\n                  lowestPlatform\r\n                };\r\n              });\r\n            }\r\n            setCompareGroups(processedData);\r\n          } catch (e) {\r\n            console.warn('Fallback compare search failed', e);\r\n          }\r\n        }\r\n        setLoading(false);\r\n        return;\r\n      }\r\n\r\n      // デバッグ用ログ removed\r\n\r\n      // 使用api.ts中定义的API服务\r\n      const response = await goodsApi.compareGoods(searchQuery);\r\n\r\n      // デバッグ用ログ removed\r\n\r\n      let responseData = [];\r\n      if (response.data && response.data.data) {\r\n        responseData = Array.isArray(response.data.data) ? response.data.data : [response.data.data];\r\n      } else {\r\n        responseData = [];\r\n      }\r\n\r\n      // デバッグ用ログ removed\r\n\r\n      // レスポンスデータを処理\r\n      let processedData: { goodsName: string, goodsList: { goodsId: number, goodsName: string, goodsPrice: number, goodsLink: string, imgUrl: string, mallType: number }[], lowestPrice: number, lowestPlatform: string }[] = [];\r\n\r\n      if (responseData.length > 0) {\r\n        // APIが返すグループデータを適切に処理\r\n        processedData = responseData.map((group: { goodsName: string, goodsList: { goodsId: number, goodsName: string, goodsPrice: number, goodsLink: string, imgUrl: string, mallType: number }[], lowestPrice: number, lowestPlatform: string }) => {\r\n          // グループ内の商品リストを処理\r\n          const goodsList = Array.isArray(group.goodsList) ? group.goodsList : [];\r\n\r\n          // 最低価格とプラットフォームを特定\r\n          let lowestPrice = null;\r\n          let lowestPlatform = '不明';\r\n\r\n          // 最低価格を計算\r\n          if (goodsList.length > 0) {\r\n            const lowestProduct = goodsList.reduce((lowest: any, current: any) =>\r\n              current.goodsPrice < lowest.goodsPrice ? current : lowest, goodsList[0]);\r\n\r\n            lowestPrice = lowestProduct.goodsPrice;\r\n            lowestPlatform = getPlatformName(lowestProduct.mallType);\r\n          }\r\n\r\n          return {\r\n            goodsName: group.goodsName || '不明な商品',\r\n            goodsList: goodsList.map((product: { goodsId: number, goodsName: string, goodsPrice: number, goodsLink: string, imgUrl: string, mallType: number }) => ({\r\n              goodsId: product.goodsId,\r\n              goodsName: product.goodsName,\r\n              goodsPrice: product.goodsPrice,\r\n              goodsLink: product.goodsLink,\r\n              imgUrl: product.imgUrl,\r\n              mallType: product.mallType\r\n            })),\r\n            lowestPrice: lowestPrice || 0,\r\n            lowestPlatform: lowestPlatform\r\n          };\r\n        });\r\n\r\n        // デバッグ用ログ removed\r\n      }\r\n\r\n      // Fallback: if compare returns empty, try local catalog search\r\n      if (processedData.length === 0) {\r\n        try {\r\n          const localRes = await goodsApi.getGoodsPage(\r\n            searchQuery,\r\n            undefined,\r\n            undefined,\r\n            currentPage,\r\n            pageSize,\r\n            undefined,\r\n            undefined,\r\n            selectedPlatforms\r\n          );\r\n          if (localRes.data && localRes.data.code === 200) {\r\n            const records = localRes.data.data?.records || [];\r\n            setTotalItems(localRes.data.data?.total || 0);\r\n            processedData = records.map((g: { goodsId: number, goodsName: string, goodsPrice: number, goodsLink: string, imgUrl: string, mallType: number }) => ({\r\n              goodsName: g.goodsName,\r\n              goodsList: [{\r\n                goodsId: g.goodsId,\r\n                goodsName: g.goodsName,\r\n                goodsPrice: g.goodsPrice,\r\n                goodsLink: g.goodsLink || '#',\r\n                imgUrl: g.imgUrl,\r\n                mallType: g.mallType || 0\r\n              }],\r\n              lowestPrice: g.goodsPrice,\r\n              lowestPlatform: getPlatformName(g.mallType || 0)\r\n            }));\r\n          }\r\n          // If still empty, try name-based search as last resort\r\n          if (processedData.length === 0) {\r\n            try {\r\n              const byNameRes = await goodsApi.searchGoodsByName(searchQuery);\r\n              const list = (byNameRes.data && byNameRes.data.data)\r\n                ? (Array.isArray(byNameRes.data.data) ? byNameRes.data.data : [byNameRes.data.data])\r\n                : [];\r\n              processedData = list.map((g: { goodsId: number, goodsName: string, goodsPrice: number, goodsLink: string, imgUrl: string, mallType: number }) => ({\r\n                goodsName: g.goodsName,\r\n                goodsList: [{\r\n                  goodsId: g.goodsId,\r\n                  goodsName: g.goodsName,\r\n                  goodsPrice: g.goodsPrice,\r\n                  goodsLink: g.goodsLink || '#',\r\n                  imgUrl: g.imgUrl,\r\n                  mallType: g.mallType || 0\r\n                }],\r\n                lowestPrice: g.goodsPrice,\r\n                lowestPlatform: getPlatformName(g.mallType || 0)\r\n              }));\r\n            } catch (e) {\r\n              console.warn('Name-based fallback search failed', e);\r\n            }\r\n          }\r\n        } catch (e) {\r\n          console.warn('Local catalog fallback search failed', e);\r\n        }\r\n      }\r\n\r\n      // デバッグ用ログ removed\r\n\r\n      setCompareGroups(processedData);\r\n      setLoading(false);\r\n    } catch (err) {\r\n      try {\r\n        let processedData: { goodsName: string, goodsList: { goodsId: number, goodsName: string, goodsPrice: number, goodsLink: string, imgUrl: string, mallType: number }[], lowestPrice: number, lowestPlatform: string }[] = [];\r\n        const searchRes = await goodsApi.searchGoods(searchQuery);\r\n        const list = (searchRes.data && searchRes.data.data)\r\n          ? (Array.isArray(searchRes.data.data) ? searchRes.data.data : [searchRes.data.data])\r\n          : [];\r\n        processedData = list.map((g: { goodsId: number, goodsName: string, goodsPrice: number, goodsLink: string, imgUrl: string, mallType: number }) => ({\r\n          goodsName: g.goodsName,\r\n          goodsList: [{\r\n            goodsId: g.goodsId,\r\n            goodsName: g.goodsName,\r\n            goodsPrice: g.goodsPrice,\r\n            goodsLink: g.goodsLink || '#',\r\n            imgUrl: g.imgUrl,\r\n            mallType: g.mallType || 0\r\n          }],\r\n          lowestPrice: g.goodsPrice,\r\n          lowestPlatform: getPlatformName(g.mallType || 0)\r\n        }));\r\n        if (processedData.length === 0) {\r\n          const byNameRes = await goodsApi.searchGoodsByName(searchQuery);\r\n          const byNameList = (byNameRes.data && byNameRes.data.data)\r\n            ? (Array.isArray(byNameRes.data.data) ? byNameRes.data.data : [byNameRes.data.data])\r\n            : [];\r\n          processedData = byNameList.map((g: { goodsId: number, goodsName: string, goodsPrice: number, goodsLink: string, imgUrl: string, mallType: number }) => ({\r\n            goodsName: g.goodsName,\r\n            goodsList: [{\r\n              goodsId: g.goodsId,\r\n              goodsName: g.goodsName,\r\n              goodsPrice: g.goodsPrice,\r\n              goodsLink: g.goodsLink || '#',\r\n              imgUrl: g.imgUrl,\r\n              mallType: g.mallType || 0\r\n            }],\r\n            lowestPrice: g.goodsPrice,\r\n            lowestPlatform: getPlatformName(g.mallType || 0)\r\n          }));\r\n        }\r\n        setCompareGroups(processedData);\r\n      } catch (fallbackErr) {\r\n        setError('検索に失敗しました。後ほど再試行してください');\r\n        console.warn(fallbackErr);\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n      console.warn(err);\r\n    }\r\n  };\r\n\r\n  const handleSearch = (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    if (query.trim()) {\r\n      searchProducts(query);\r\n    }\r\n  };\r\n\r\n  const getPlatformName = (mallType: number): string => {\r\n    switch (mallType) {\r\n      case 10: return '楽天';\r\n      case 20: return 'Yahoo!';\r\n      case 40: return 'Amazon';\r\n      default: return '其他';\r\n    }\r\n  };\r\n\r\n  const getPlatformColor = (mallType: number): string => {\r\n    switch (mallType) {\r\n      case 10: return '#bf0000'; // Rakuten Red\r\n      case 20: return '#ff0033'; // Yahoo Red\r\n      case 40: return '#FF9900'; // Amazon Orange\r\n      default: return '#666';\r\n    }\r\n  };\r\n\r\n  const getPlatformBadgeClass = (mallType: number): string => {\r\n    switch (mallType) {\r\n      case 10: return 'platform-badge rakuten';\r\n      case 20: return 'platform-badge yahoo';\r\n      case 40: return 'platform-badge amazon';\r\n      default: return 'platform-badge unknown';\r\n    }\r\n  };\r\n\r\n  const allProducts: Product[] = compareGroups.flatMap(group => group.goodsList);\r\n  const normalizedQuery = (executedQuery || query || '').toLowerCase();\r\n  const buildSearchTokens = (q: string): string[] => {\r\n    const n = (q || '').toLowerCase().trim();\r\n    if (!n) return [];\r\n    const baseParts = n.split(/[\\s、，,。]+/).map(s => s.trim()).filter(Boolean);\r\n    const splitToken = (t: string): string[] => {\r\n      const res: string[] = [];\r\n      let current = '';\r\n      let currentType: 'latin' | 'other' | null = null;\r\n      for (const ch of t) {\r\n        const isLatin = /[a-z0-9]/i.test(ch);\r\n        const type: 'latin' | 'other' = isLatin ? 'latin' : 'other';\r\n        if (currentType === null || currentType === type) {\r\n          current += ch;\r\n          currentType = type;\r\n        } else {\r\n          if (current.length > 0) {\r\n            res.push(current);\r\n          }\r\n          current = ch;\r\n          currentType = type;\r\n        }\r\n      }\r\n      if (current.length > 0) {\r\n        res.push(current);\r\n      }\r\n      return res;\r\n    };\r\n    const allParts: string[] = [];\r\n    baseParts.forEach(p => {\r\n      const parts = splitToken(p);\r\n      if (parts.length > 0) {\r\n        allParts.push(...parts);\r\n      } else {\r\n        allParts.push(p);\r\n      }\r\n    });\r\n    const deduped = Array.from(new Set(allParts));\r\n    return deduped.filter(p => p.length >= 2);\r\n  };\r\n  const searchTokens = buildSearchTokens(normalizedQuery);\r\n  const hasDeviceKeyword = /iphone|galaxy|xiaomi|huawei|pixel|xperia|ipad|macbook|thinkpad|notebook|laptop|surface|switch|playstation|ps5|xbox|tv|bravia|regza|monitor|display|camera|eos|alpha|冷蔵庫|冰箱|洗濯機|洗衣机|airpods|buds/i.test(normalizedQuery);\r\n  const hasAccessoryKeyword = /ケース|カバー|フィルム|充電器|ケーブル|保護|スタンド|ガラス|バンパー|壳|膜|支架|充電器|アダプタ|adapter|case|cover|charger|cable|ストラップ|ホルダー|dock|ドック|イヤホン|ヘッドホン/i.test(normalizedQuery);\r\n  const shouldFilterAccessories = hasDeviceKeyword && !hasAccessoryKeyword;\r\n  const isAccessoryProduct = (name: string) => {\r\n    const n = (name || '').toLowerCase();\r\n    return /ケース|カバー|フィルム|充電器|ケーブル|保護|スタンド|ガラス|バンパー|ストラップ|ホルダー|dock|ドック|adapter|アダプタ|イヤホン|ヘッドホン|screen protector|case|cover|charger|cable/.test(n);\r\n  };\r\n  const knownBrands = ['Apple', 'Samsung', 'Sony', 'Xiaomi', 'Huawei', 'Lenovo', 'Dell', 'HP', 'ASUS', 'Acer', 'Nintendo', 'Microsoft', 'Canon', 'Nikon'];\r\n  const parseFacets = (name: string) => {\r\n    const n = name || '';\r\n    const brand = knownBrands.find(b => new RegExp(b, 'i').test(n)) || '';\r\n    const seriesMatch = n.match(/(iPhone|MacBook|iPad|Galaxy|ThinkPad|Surface|PlayStation|Switch|WH\\-\\d{4}XM\\d|RX\\s?\\d{3,}|EOS\\s?\\w+)/i);\r\n    const series = seriesMatch ? seriesMatch[1] : '';\r\n    const modelMatch = n.match(/([A-Za-z]{1,3}\\-?\\d{2,4}[A-Za-z]?|\\bPro Max\\b|\\bPro\\b|\\bUltra\\b|\\bPlus\\b|\\bAir\\b|\\bMini\\b)/i);\r\n    const model = modelMatch ? modelMatch[1] : '';\r\n    const storageMatch = n.match(/(\\b\\d{2,4}\\s?(GB|TB)\\b)/i);\r\n    const storage = storageMatch ? storageMatch[1].replace(/\\s+/g, '') : '';\r\n    const colorMatch = n.match(/\\b(Black|White|Silver|Blue|Red|Green|Gold|Pink|Gray|Space Gray|Midnight|ブラック|ホワイト|シルバー|ブルー|レッド|グリーン|ゴールド|ピンク|グレー|スペースグレイ|ミッドナイト)\\b/i);\r\n    const color = colorMatch ? colorMatch[1] : '';\r\n    const sizeMatch = n.match(/(\\b\\d{1,2}(?:\\.\\d)?\\s?(?:吋|インチ|\"|英寸)\\b)/);\r\n    const size = sizeMatch ? sizeMatch[1] : '';\r\n    return { brand, series, model, storage, color, size };\r\n  };\r\n  const facetIndex = allProducts.map(p => parseFacets(p.goodsName));\r\n  const brands = Array.from(new Set(facetIndex.map(f => f.brand).filter(Boolean)));\r\n  const series = Array.from(new Set(facetIndex.map(f => f.series).filter(Boolean)));\r\n  const models = Array.from(new Set(facetIndex.map(f => f.model).filter(Boolean)));\r\n  const storages = Array.from(new Set(facetIndex.map(f => f.storage).filter(Boolean)));\r\n  const colors = Array.from(new Set(facetIndex.map(f => f.color).filter(Boolean)));\r\n  const sizes = Array.from(new Set(facetIndex.map(f => f.size).filter(Boolean)));\r\n  const parseCategory = (name: string) => {\r\n    const n = (name || '').toLowerCase();\r\n    if (/手机壳|ケース|保护壳|カバー/.test(n)) return { parent: 'スマホアクセサリー', child: 'ケース' };\r\n    if (/iphone|galaxy|xiaomi|huawei|pixel|xperia/.test(n)) return { parent: '携帯電話・スマートフォン', child: 'スマートフォン本体' };\r\n    if (/ipad|galaxy tab|surface|tablet/.test(n)) return { parent: 'パソコン・タブレット', child: 'タブレットPC' };\r\n    if (/macbook|thinkpad|notebook|laptop/.test(n)) return { parent: 'パソコン・タブレット', child: 'ノートパソコン' };\r\n    if (/monitor|display|显示器/.test(n)) return { parent: 'パソコン周辺機器', child: 'モニター' };\r\n    if (/mouse|keyboard|鼠标|键盘/.test(n)) return { parent: 'パソコン周辺機器', child: 'キーボード・マウス' };\r\n    if (/airpods|buds|wh-|wf-|耳机/.test(n)) return { parent: 'オーディオ・楽器', child: 'ヘッドホン・イヤホン' };\r\n    if (/tv|bravia|regza|电视/.test(n)) return { parent: 'テレビ・映像機器', child: 'テレビ' };\r\n    if (/camera|eos|alpha|相机/.test(n)) return { parent: 'カメラ', child: 'デジタルカメラ' };\r\n    if (/lens|镜头/.test(n)) return { parent: 'カメラ', child: 'レンズ' };\r\n    if (/fridge|refrigerator|冰箱/.test(n)) return { parent: '生活家電', child: '冷蔵庫' };\r\n    if (/washing|washer|洗衣机/.test(n)) return { parent: '生活家電', child: '洗濯機' };\r\n    return { parent: 'その他', child: 'その他' };\r\n  };\r\n\r\n  const categoriesAll = Array.from(new Set(allProducts.map(p => {\r\n    const c = parseCategory(p.goodsName);\r\n    return `${c.parent}>${c.child}`;\r\n  }).filter(x => x !== '其他>其他')));\r\n\r\n  // Build hierarchy tree\r\n  const categoryTree: Record<string, string[]> = {};\r\n  categoriesAll.forEach(c => {\r\n    const [p, child] = c.split('>');\r\n    if (!categoryTree[p]) categoryTree[p] = [];\r\n    if (!categoryTree[p].includes(child)) categoryTree[p].push(child);\r\n  });\r\n\r\n  const filteredProducts: Product[] = allProducts.filter(p => {\r\n    const platformOk = selectedPlatforms.length === 0 || selectedPlatforms.includes(p.mallType);\r\n    const minOk = minPrice === '' || (!isNaN(Number(minPrice)) && p.goodsPrice >= Number(minPrice));\r\n    const maxOk = maxPrice === '' || (!isNaN(Number(maxPrice)) && p.goodsPrice <= Number(maxPrice));\r\n    const f = parseFacets(p.goodsName);\r\n    const brandOk = selectedBrands.length === 0 || (f.brand && selectedBrands.includes(f.brand));\r\n    const seriesOk = selectedSeries.length === 0 || (f.series && selectedSeries.includes(f.series));\r\n    const modelOk = selectedModels.length === 0 || (f.model && selectedModels.includes(f.model));\r\n    const storageOk = selectedStorage.length === 0 || (f.storage && selectedStorage.includes(f.storage));\r\n    const colorOk = selectedColors.length === 0 || (f.color && selectedColors.includes(f.color));\r\n    const sizeOk = selectedSizes.length === 0 || (f.size && selectedSizes.includes(f.size));\r\n\r\n    const cat = parseCategory(p.goodsName);\r\n    const catStr = `${cat.parent}>${cat.child}`;\r\n    const categoryOk = selectedCategories.length === 0 ||\r\n      selectedCategories.some(sc => sc === cat.parent || sc === catStr);\r\n\r\n    const validData = p.goodsPrice > 0 && p.goodsLink && p.goodsLink !== '#' && p.goodsLink !== '';\r\n    const accessoryOk = !shouldFilterAccessories || !isAccessoryProduct(p.goodsName);\r\n    const nameLower = (p.goodsName || '').toLowerCase();\r\n    const keywordOk = searchTokens.length === 0 || searchTokens.every(t => nameLower.includes(t));\r\n\r\n    return platformOk && minOk && maxOk && brandOk && seriesOk && modelOk && storageOk && colorOk && sizeOk && categoryOk && validData && accessoryOk && keywordOk;\r\n  });\r\n  const sortedProducts: Product[] = [...filteredProducts].sort((a, b) => {\r\n    if (sortOption === 'price_asc') return a.goodsPrice - b.goodsPrice;\r\n    if (sortOption === 'price_desc') return b.goodsPrice - a.goodsPrice;\r\n    if (sortOption === 'platform') return a.mallType - b.mallType;\r\n    if (sortOption === 'name') return a.goodsName.localeCompare(b.goodsName);\r\n    return 0;\r\n  });\r\n  const togglePlatform = (mt: number) => {\r\n    setSelectedPlatforms(prev => prev.includes(mt) ? prev.filter(x => x !== mt) : [...prev, mt]);\r\n  };\r\n\r\n  const totalPages = searchSource === 'local'\r\n    ? Math.max(1, Math.ceil(totalItems / pageSize))\r\n    : Math.max(1, Math.ceil(sortedProducts.length / pageSize));\r\n\r\n  const currentPageProducts = searchSource === 'local'\r\n    ? sortedProducts\r\n    : sortedProducts.slice((currentPage - 1) * pageSize, currentPage * pageSize);\r\n  const goPrev = () => setCurrentPage(p => Math.max(1, p - 1));\r\n  const goNext = () => setCurrentPage(p => Math.min(totalPages, p + 1));\r\n  const onChangePageSize = (size: number) => { setPageSize(size); setCurrentPage(1); };\r\n\r\n  const getSelectKey = (p: Product) => {\r\n    if (p.goodsId) return `id:${p.goodsId}`;\r\n    const base = `${p.mallType}-${p.goodsLink || ''}-${p.goodsName}`;\r\n    return `k:${base}`;\r\n  };\r\n  const isSelected = (key: string) => selectedKeys.includes(key);\r\n  const toggleSelect = (p: Product) => {\r\n    const key = getSelectKey(p);\r\n    setSelectedKeys(prev => prev.includes(key) ? prev.filter(x => x !== key) : [...prev, key]);\r\n  };\r\n\r\n  const getSellerFromLink = (url?: string) => {\r\n    if (!url) return '不明な店铺';\r\n    try {\r\n      const u = new URL(url.startsWith('http') ? url : ('https://' + url.replace(/^\\/\\//, '')));\r\n      return u.hostname.replace(/^www\\./, '');\r\n    } catch {\r\n      return '不明な店铺';\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"compare-page\">\r\n      <div className=\"search-section\">\r\n        <h1>商品価格比較</h1>\r\n        <form onSubmit={handleSearch} className=\"search-form\">\r\n          <input\r\n            type=\"text\"\r\n            value={query}\r\n            onChange={(e) => setQuery(e.target.value)} // 仅更新状态，不触发搜索\r\n            placeholder=\"商品名を入力して価格比較...\"\r\n            className=\"search-input\"\r\n          />\r\n          <button type=\"submit\" className=\"search-button\">搜索</button>\r\n        </form>\r\n      </div>\r\n\r\n      {loading && <div className=\"loading\">検索中...</div>}\r\n      {error && <div className=\"error\">{error}</div>}\r\n\r\n      {/* Show container if not loading/error, OR if we have results, OR to show sidebar even when empty */}\r\n      {!loading && !error && (\r\n        <div className=\"compare-container\">\r\n          {/* Sidebar Filters */}\r\n          <div className=\"sidebar\">\r\n            {/* Category Tree (Local Mode) removed by request */}\r\n\r\n            {/* Dynamic Filters (Local Mode + Category Selected) */}\r\n            {searchSource === 'local' && dynamicFilters.length > 0 && (\r\n              <div className=\"sidebar-section dynamic-filters\">\r\n                <h3 className=\"sidebar-title\">属性筛选</h3>\r\n                {dynamicFilters.map(attr => (\r\n                  <div key={attr.id} className=\"filter-group\">\r\n                    <h4>{attr.name}</h4>\r\n                    <ul className=\"filter-options\">\r\n                      {(attr as any).values && (attr as any).values.map((val: string) => (\r\n                        <li key={val}>\r\n                          <label>\r\n                            <input\r\n                              type=\"checkbox\"\r\n                              checked={selectedDynamicFilters[attr.id] === val}\r\n                              onChange={() => {\r\n                                setSelectedDynamicFilters(prev => {\r\n                                  if (prev[attr.id] === val) {\r\n                                    const next = { ...prev };\r\n                                    delete next[attr.id];\r\n                                    return next;\r\n                                  }\r\n                                  return { ...prev, [attr.id]: val };\r\n                                });\r\n                              }}\r\n                            />\r\n                            {val}\r\n                          </label>\r\n                        </li>\r\n                      ))}\r\n                    </ul>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            )}\r\n\r\n            {/* Compare mode category filters removed by request */}\r\n\r\n            <div className=\"sidebar-section\">\r\n              <h3 className=\"sidebar-title\">价格区间</h3>\r\n              <div className=\"price-range-inputs\">\r\n                <input type=\"number\" placeholder=\"¥ min\" value={minPrice} onChange={e => setMinPrice(e.target.value)} />\r\n                <span>-</span>\r\n                <input type=\"number\" placeholder=\"¥ max\" value={maxPrice} onChange={e => setMaxPrice(e.target.value)} />\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"sidebar-section\">\r\n              <h3 className=\"sidebar-title\">商城</h3>\r\n              <ul className=\"filter-list\">\r\n                <li><label><input type=\"checkbox\" checked={selectedPlatforms.includes(10)} onChange={() => togglePlatform(10)} /> 楽天</label></li>\r\n                <li><label><input type=\"checkbox\" checked={selectedPlatforms.includes(20)} onChange={() => togglePlatform(20)} /> Yahoo!ショッピング</label></li>\r\n              </ul>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Main Content Results */}\r\n          <div className=\"main-content\">\r\n            <div className=\"results-header\">\r\n              <h2>\"{query}\" 搜索结果 <span>({filteredProducts.length}件)</span></h2>\r\n              <div className=\"sort-bar\">\r\n                <span className=\"sort-label\">排序:</span>\r\n                <button className={`sort-tab ${sortOption === 'price_asc' ? 'active' : ''}`} onClick={() => setSortOption('price_asc')}>价格低到高</button>\r\n                <button className={`sort-tab ${sortOption === 'price_desc' ? 'active' : ''}`} onClick={() => setSortOption('price_desc')}>价格高到低</button>\r\n                <button className={`sort-tab ${sortOption === 'platform' ? 'active' : ''}`} onClick={() => setSortOption('platform')}>商城</button>\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"product-list-view\">\r\n              {currentPageProducts.map((product, index) => (\r\n                <div key={index} className=\"product-row\">\r\n                  <div className=\"p-image\">\r\n                    <img src={product.imgUrl || '/images/default-product.png'} alt={product.goodsName} onError={(e) => (e.target as HTMLImageElement).src = '/images/default-product.png'} />\r\n                  </div>\r\n                  <div className=\"p-info\">\r\n                    <div className=\"p-title-row\">\r\n                      <a\r\n                        href={product.goodsLink}\r\n                        target=\"_blank\"\r\n                        rel=\"noopener noreferrer\"\r\n                        className=\"p-title\"\r\n                        onClick={(e) => { ensureGoodsIdAndHistory(product, e); }}\r\n                      >\r\n                        {product.goodsName}\r\n                      </a>\r\n                    </div>\r\n                    <div className=\"p-specs\">\r\n                      {(function () {\r\n                        const f = parseFacets(product.goodsName);\r\n                        const parts = [f.brand, f.series, f.model, f.storage, f.color, f.size].filter(Boolean);\r\n                        return parts.join(' | ');\r\n                      })()}\r\n                    </div>\r\n                    <div className=\"p-meta\">\r\n                      <span className={`mall-tag mall-${product.mallType}`}>{getPlatformName(product.mallType)}</span>\r\n                      <span className=\"seller\">{getSellerFromLink(product.goodsLink)}</span>\r\n                    </div>\r\n                  </div>\r\n                  <div className=\"p-action\">\r\n                    <div className=\"p-price\">{product.goodsPrice.toLocaleString()}円</div>\r\n                    <a\r\n                      href={product.goodsLink}\r\n                      target=\"_blank\"\r\n                      rel=\"noopener noreferrer\"\r\n                      className=\"btn-shop\"\r\n                      onClick={(e) => { ensureGoodsIdAndHistory(product, e); }}\r\n                    >\r\n                      前往购买\r\n                    </a>\r\n                    <button className=\"btn-trend\" onClick={() => { ensureGoodsIdAndCollect(product); }}>{product.goodsId && collectedIds.has(product.goodsId) ? '取消收藏' : '收藏'}</button>\r\n                    <button className=\"btn-trend\" onClick={() => {\r\n                      const title = product.goodsName;\r\n                      const labels = Array.from({ length: 12 }, (_, i) => {\r\n                        const d = new Date();\r\n                        d.setMonth(d.getMonth() - (11 - i));\r\n                        const m = (d.getMonth() + 1).toString().padStart(2, '0');\r\n                        return `${d.getFullYear()}-${m}`;\r\n                      });\r\n                      const base = Math.max(1, product.goodsPrice);\r\n                      let val = base * 1.0;\r\n                      const series = labels.map((_, i) => {\r\n                        const drift = 1 + Math.sin(i / 3) * 0.05;\r\n                        const noise = 1 + ((Math.random() - 0.5) * 0.08);\r\n                        val = Math.max(1, val * drift * noise);\r\n                        return Math.round(val);\r\n                      });\r\n                      setTrendTitle(title);\r\n                      setTrendLabels(labels);\r\n                      setTrendSeries(series);\r\n                      setTrendOpen(true);\r\n                    }}>价格走势</button>\r\n                    <label className=\"compare-check\">\r\n                      <input type=\"checkbox\" checked={isSelected(getSelectKey(product))} onChange={() => toggleSelect(product)} /> 对比\r\n                    </label>\r\n                  </div>\r\n                </div>\r\n              ))}\r\n            </div>\r\n\r\n            <div className=\"pagination-controls\">\r\n              <button type=\"button\" onClick={goPrev} disabled={currentPage === 1}>上一页</button>\r\n              <span className=\"page-info\">{currentPage} / {totalPages}</span>\r\n              <button type=\"button\" onClick={goNext} disabled={currentPage === totalPages}>下一页</button>\r\n            </div>\r\n          </div>\r\n\r\n          {trendOpen && (\r\n            <div className=\"price-trend-modal\" onClick={() => setTrendOpen(false)}>\r\n              <div className=\"modal-content\" onClick={(e) => e.stopPropagation()}>\r\n                <div className=\"modal-header\">\r\n                  <span className=\"modal-title\">{trendTitle}</span>\r\n                  <button type=\"button\" className=\"modal-close\" onClick={() => setTrendOpen(false)}>×</button>\r\n                </div>\r\n                <div className=\"modal-body\">\r\n                  <div className=\"trend-chart\">\r\n                    {(function () {\r\n                      const width = 600;\r\n                      const height = 280;\r\n                      const padding = 32;\r\n                      const xs = trendSeries.map((_, i) => padding + (i * (width - 2 * padding)) / (trendSeries.length - 1));\r\n                      const minV = Math.min(...trendSeries);\r\n                      const maxV = Math.max(...trendSeries);\r\n                      const ys = trendSeries.map(v => height - padding - ((v - minV) / (Math.max(1, maxV - minV))) * (height - 2 * padding));\r\n                      const path = xs.map((x, i) => `${i === 0 ? 'M' : 'L'}${x},${ys[i]}`).join(' ');\r\n                      const gridY = [0.25, 0.5, 0.75].map(r => height - padding - r * (height - 2 * padding));\r\n                      return (\r\n                        <svg width={width} height={height} role=\"img\" aria-label=\"价格趋势图\">\r\n                          {gridY.map((gy, i) => (\r\n                            <line key={i} x1={padding} y1={gy} x2={width - padding} y2={gy} stroke=\"#eee\" />\r\n                          ))}\r\n                          <path d={path} fill=\"none\" stroke=\"#ff4400\" strokeWidth={2} />\r\n                          {xs.map((x, i) => (\r\n                            <circle key={i} cx={x} cy={ys[i]} r={3} fill=\"#ff4400\" />\r\n                          ))}\r\n                          <text x={padding} y={height - 8} fontSize={12} fill=\"#999\">{trendLabels[0]}</text>\r\n                          <text x={width - padding - 60} y={height - 8} fontSize={12} fill=\"#999\">{trendLabels[trendLabels.length - 1]}</text>\r\n                        </svg>\r\n                      );\r\n                    })()}\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          )}\r\n        </div>\r\n      )}\r\n\r\n      {!loading && !error && compareGroups.length === 0 && query && (\r\n        <div className=\"no-results\">関連商品が見つかりません</div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ComparePage;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}