{"ast":null,"code":"import _objectSpread from\"C:/Users/3jz/Desktop/HJZDM/frontend/hjzdm-frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect}from'react';import{useSearchParams}from'react-router-dom';import'./ComparePage.css';import{goodsApi,categoryApi,userApi,goodsOperateApi}from'../services/api';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const ComparePage=()=>{const[searchParams]=useSearchParams();const[query,setQuery]=useState(searchParams.get('query')||'');const[compareGroups,setCompareGroups]=useState([]);const[loading,setLoading]=useState(false);const[error,setError]=useState(null);const[sortOption,setSortOption]=useState('price_asc');const[selectedPlatforms,setSelectedPlatforms]=useState([]);const[minPrice,setMinPrice]=useState('');const[maxPrice,setMaxPrice]=useState('');const[currentPage,setCurrentPage]=useState(1);const[pageSize,setPageSize]=useState(50);const[selectedKeys,setSelectedKeys]=useState([]);const[selectedBrands,setSelectedBrands]=useState([]);const[selectedSeries,setSelectedSeries]=useState([]);const[selectedModels,setSelectedModels]=useState([]);const[selectedStorage,setSelectedStorage]=useState([]);const[selectedColors,setSelectedColors]=useState([]);const[selectedSizes,setSelectedSizes]=useState([]);const[selectedCategories,setSelectedCategories]=useState([]);const[trendOpen,setTrendOpen]=useState(false);const[trendLabels,setTrendLabels]=useState([]);const[trendSeries,setTrendSeries]=useState([]);const[trendTitle,setTrendTitle]=useState('');const[collectedIds,setCollectedIds]=useState(new Set());// Search Source\nconst[searchSource,setSearchSource]=useState('compare');const[executedQuery,setExecutedQuery]=useState('');const[totalItems,setTotalItems]=useState(0);// Dynamic Filters State\nconst[categories,setCategories]=useState([]);const[dynamicFilters,setDynamicFilters]=useState([]);const[selectedDynamicFilters,setSelectedDynamicFilters]=useState({});const[currentCatId,setCurrentCatId]=useState(null);// Fetch categories on mount\nuseEffect(()=>{categoryApi.getList().then(res=>{if(res.data.code===200){setCategories(res.data.data);}}).catch(err=>console.warn(\"Failed to fetch categories\",err));},[]);// 仅在页面加载时，如果有URL参数，则执行搜索\nuseEffect(()=>{if(query.trim()){searchProducts(query);}// eslint-disable-next-line react-hooks/exhaustive-deps\n},[]);// Fetch dynamic attributes when category changes\nuseEffect(()=>{if(currentCatId){categoryApi.getAttributes(currentCatId).then(res=>{if(res.data.code===200){setDynamicFilters(res.data.data);}}).catch(err=>console.warn(\"Failed to fetch attributes\",err));}else{setDynamicFilters([]);}},[currentCatId]);// Auto-search when filters change (Local Mode only)\nuseEffect(()=>{if(searchSource==='local'){searchProducts(executedQuery||query);}},[selectedDynamicFilters,currentCatId,currentPage,pageSize,searchSource,selectedPlatforms]);useEffect(()=>{(async()=>{try{const res=await goodsApi.getMyCollect(1,500);if(res.data&&res.data.code===200&&Array.isArray(res.data.data)){const ids=res.data.data.map(g=>g.goodsId).filter(id=>typeof id==='number');setCollectedIds(new Set(ids));}}catch(e){}})();},[]);const toggleCollect=async goodsId=>{try{if(collectedIds.has(goodsId)){const res=await goodsOperateApi.cancelCollect(goodsId);if(res.data&&res.data.code===200){setCollectedIds(prev=>{const next=new Set(prev);next.delete(goodsId);return next;});}}else{const res=await goodsOperateApi.collect(goodsId);if(res.data&&res.data.code===200){setCollectedIds(prev=>{const next=new Set(prev);next.add(goodsId);return next;});}else{alert('请先登录');}}}catch(e){alert('操作失败');}};const ensureGoodsIdAndCollect=async product=>{try{const token=localStorage.getItem('token');if(!token){alert('请先登录');return;}if(product.goodsId){await toggleCollect(product.goodsId);return;}const payload={goodsName:product.goodsName,goodsPrice:product.goodsPrice,goodsLink:product.goodsLink,imgUrl:product.imgUrl||'',mallType:product.mallType,status:1};const addRes=await goodsApi.addAndReturn(payload);if(addRes.data&&addRes.data.code===200&&addRes.data.data&&addRes.data.data.goodsId){const newId=addRes.data.data.goodsId;await toggleCollect(newId);}else{alert('新增商品失败');}}catch(e){alert('操作失败');}};const ensureGoodsIdAndHistory=async(product,event)=>{// 阻止默认跳转，必须等待历史记录完成\nif(event){event.preventDefault();event.stopPropagation();}const targetUrl=product.goodsLink;const doRedirect=()=>{if(targetUrl){window.open(targetUrl,'_blank','noopener,noreferrer');}};try{const token=localStorage.getItem('token');if(!token){doRedirect();return;}// Debug log removed\n// 核心逻辑：无论是已有ID还是新商品，都强制等待 API 完成\n// 为了防止 API 卡死，设置一个 3000ms 的超时的 Promise\nconst historyPromise=(async()=>{if(product.goodsId){// Debug log removed\nawait userApi.addHistory(product.goodsId);// Debug log removed\n}else{// Debug log removed\nconst payload={goodsName:product.goodsName,goodsPrice:product.goodsPrice,goodsLink:product.goodsLink,imgUrl:product.imgUrl||'',mallType:product.mallType,status:1};// Use the new combined endpoint\nawait goodsApi.addAndHistory(payload);// Debug log removed\n}})();// 竞速：API 完成 vs 5000ms 超时\nawait Promise.race([historyPromise,new Promise(resolve=>setTimeout(resolve,5000))]);// Debug logs removed\n}catch(e){console.error('History record failed:',e);}finally{// 无论成功失败，必须跳转\ndoRedirect();}};const searchProducts=async searchQuery=>{// Debug log removed\nif(!searchQuery.trim()&&searchSource==='compare')return;setExecutedQuery(searchQuery);setLoading(true);setError(null);try{if(searchSource==='local'){const minP=minPrice?Number(minPrice):undefined;const maxP=maxPrice?Number(maxPrice):undefined;// Debug log removed\nconst response=await goodsApi.getGoodsPage(searchQuery,selectedDynamicFilters,currentCatId||undefined,currentPage,pageSize,minP,maxP,selectedPlatforms);// Debug log removed\nif(response.data&&response.data.code===200){const records=response.data.data.records||[];setTotalItems(response.data.data.total||0);const processedData=records.map(g=>({goodsName:g.goodsName,goodsList:[{goodsId:g.goodsId,goodsName:g.goodsName,goodsPrice:g.goodsPrice,goodsLink:g.goodsLink||'#',imgUrl:g.imgUrl,mallType:g.mallType||0}],lowestPrice:g.goodsPrice,lowestPlatform:getPlatformName(g.mallType||0)}));if(processedData.length===0){try{const cmpRes=await goodsApi.compareGoods(searchQuery);let responseData=[];if(cmpRes.data&&cmpRes.data.data){responseData=Array.isArray(cmpRes.data.data)?cmpRes.data.data:[cmpRes.data.data];}let cmpProcessed=[];if(responseData.length>0){cmpProcessed=responseData.map(group=>{const goodsList=Array.isArray(group.goodsList)?group.goodsList:[];let lowestPrice=null;let lowestPlatform='不明';if(goodsList.length>0){const lowestProduct=goodsList.reduce((lowest,current)=>current.goodsPrice<lowest.goodsPrice?current:lowest,goodsList[0]);lowestPrice=lowestProduct.goodsPrice;lowestPlatform=getPlatformName(lowestProduct.mallType);}return{goodsName:group.goodsName||'不明な商品',goodsList:goodsList.map(product=>({goodsId:product.goodsId,goodsName:product.goodsName,goodsPrice:product.goodsPrice,goodsLink:product.goodsLink,imgUrl:product.imgUrl||'',mallType:product.mallType})),lowestPrice:lowestPrice||0,lowestPlatform};});}setCompareGroups(cmpProcessed);setLoading(false);return;}catch(e){console.warn('Fallback compare search failed',e);}}setCompareGroups(processedData);}else{setCompareGroups([]);setTotalItems(0);try{const cmpRes=await goodsApi.compareGoods(searchQuery);let responseData=[];if(cmpRes.data&&cmpRes.data.data){responseData=Array.isArray(cmpRes.data.data)?cmpRes.data.data:[cmpRes.data.data];}let processedData=[];if(responseData.length>0){processedData=responseData.map(group=>{const goodsList=Array.isArray(group.goodsList)?group.goodsList:[];let lowestPrice=null;let lowestPlatform='不明';if(goodsList.length>0){const lowestProduct=goodsList.reduce((lowest,current)=>current.goodsPrice<lowest.goodsPrice?current:lowest,goodsList[0]);lowestPrice=lowestProduct.goodsPrice;lowestPlatform=getPlatformName(lowestProduct.mallType||0);}return{goodsName:group.goodsName||'不明な商品',goodsList:goodsList.map(product=>({goodsId:product.goodsId,goodsName:product.goodsName,goodsPrice:product.goodsPrice,goodsLink:product.goodsLink,imgUrl:product.imgUrl,mallType:product.mallType})),lowestPrice:lowestPrice||0,lowestPlatform};});}setCompareGroups(processedData);}catch(e){console.warn('Fallback compare search failed',e);}}setLoading(false);return;}// デバッグ用ログ removed\n// 使用api.ts中定义的API服务\nconst response=await goodsApi.compareGoods(searchQuery);// デバッグ用ログ removed\nlet responseData=[];if(response.data&&response.data.data){responseData=Array.isArray(response.data.data)?response.data.data:[response.data.data];}else{responseData=[];}// デバッグ用ログ removed\n// レスポンスデータを処理\nlet processedData=[];if(responseData.length>0){// APIが返すグループデータを適切に処理\nprocessedData=responseData.map(group=>{// グループ内の商品リストを処理\nconst goodsList=Array.isArray(group.goodsList)?group.goodsList:[];// 最低価格とプラットフォームを特定\nlet lowestPrice=null;let lowestPlatform='不明';// 最低価格を計算\nif(goodsList.length>0){const lowestProduct=goodsList.reduce((lowest,current)=>current.goodsPrice<lowest.goodsPrice?current:lowest,goodsList[0]);lowestPrice=lowestProduct.goodsPrice;lowestPlatform=getPlatformName(lowestProduct.mallType);}return{goodsName:group.goodsName||'不明な商品',goodsList:goodsList.map(product=>({goodsId:product.goodsId,goodsName:product.goodsName,goodsPrice:product.goodsPrice,goodsLink:product.goodsLink,imgUrl:product.imgUrl,mallType:product.mallType})),lowestPrice:lowestPrice||0,lowestPlatform:lowestPlatform};});// デバッグ用ログ removed\n}// Fallback: if compare returns empty, try local catalog search\nif(processedData.length===0){try{const localRes=await goodsApi.getGoodsPage(searchQuery,undefined,undefined,currentPage,pageSize,undefined,undefined,selectedPlatforms);if(localRes.data&&localRes.data.code===200){var _localRes$data$data,_localRes$data$data2;const records=((_localRes$data$data=localRes.data.data)===null||_localRes$data$data===void 0?void 0:_localRes$data$data.records)||[];setTotalItems(((_localRes$data$data2=localRes.data.data)===null||_localRes$data$data2===void 0?void 0:_localRes$data$data2.total)||0);processedData=records.map(g=>({goodsName:g.goodsName,goodsList:[{goodsId:g.goodsId,goodsName:g.goodsName,goodsPrice:g.goodsPrice,goodsLink:g.goodsLink||'#',imgUrl:g.imgUrl,mallType:g.mallType||0}],lowestPrice:g.goodsPrice,lowestPlatform:getPlatformName(g.mallType||0)}));}// If still empty, try name-based search as last resort\nif(processedData.length===0){try{const byNameRes=await goodsApi.searchGoodsByName(searchQuery);const list=byNameRes.data&&byNameRes.data.data?Array.isArray(byNameRes.data.data)?byNameRes.data.data:[byNameRes.data.data]:[];processedData=list.map(g=>({goodsName:g.goodsName,goodsList:[{goodsId:g.goodsId,goodsName:g.goodsName,goodsPrice:g.goodsPrice,goodsLink:g.goodsLink||'#',imgUrl:g.imgUrl,mallType:g.mallType||0}],lowestPrice:g.goodsPrice,lowestPlatform:getPlatformName(g.mallType||0)}));}catch(e){console.warn('Name-based fallback search failed',e);}}}catch(e){console.warn('Local catalog fallback search failed',e);}}// デバッグ用ログ removed\nsetCompareGroups(processedData);setLoading(false);}catch(err){try{let processedData=[];const searchRes=await goodsApi.searchGoods(searchQuery);const list=searchRes.data&&searchRes.data.data?Array.isArray(searchRes.data.data)?searchRes.data.data:[searchRes.data.data]:[];processedData=list.map(g=>({goodsName:g.goodsName,goodsList:[{goodsId:g.goodsId,goodsName:g.goodsName,goodsPrice:g.goodsPrice,goodsLink:g.goodsLink||'#',imgUrl:g.imgUrl,mallType:g.mallType||0}],lowestPrice:g.goodsPrice,lowestPlatform:getPlatformName(g.mallType||0)}));if(processedData.length===0){const byNameRes=await goodsApi.searchGoodsByName(searchQuery);const byNameList=byNameRes.data&&byNameRes.data.data?Array.isArray(byNameRes.data.data)?byNameRes.data.data:[byNameRes.data.data]:[];processedData=byNameList.map(g=>({goodsName:g.goodsName,goodsList:[{goodsId:g.goodsId,goodsName:g.goodsName,goodsPrice:g.goodsPrice,goodsLink:g.goodsLink||'#',imgUrl:g.imgUrl,mallType:g.mallType||0}],lowestPrice:g.goodsPrice,lowestPlatform:getPlatformName(g.mallType||0)}));}setCompareGroups(processedData);}catch(fallbackErr){setError('検索に失敗しました。後ほど再試行してください');console.warn(fallbackErr);}finally{setLoading(false);}console.warn(err);}};const handleSearch=e=>{e.preventDefault();if(query.trim()){searchProducts(query);}};const getPlatformName=mallType=>{switch(mallType){case 10:return'楽天';case 20:return'Yahoo!';case 40:return'Amazon';default:return'其他';}};const getPlatformColor=mallType=>{switch(mallType){case 10:return'#bf0000';// Rakuten Red\ncase 20:return'#ff0033';// Yahoo Red\ncase 40:return'#FF9900';// Amazon Orange\ndefault:return'#666';}};const getPlatformBadgeClass=mallType=>{switch(mallType){case 10:return'platform-badge rakuten';case 20:return'platform-badge yahoo';case 40:return'platform-badge amazon';default:return'platform-badge unknown';}};const allProducts=compareGroups.flatMap(group=>group.goodsList);const normalizedQuery=(executedQuery||query||'').toLowerCase();const buildSearchTokens=q=>{const n=(q||'').toLowerCase().trim();if(!n)return[];const baseParts=n.split(/[\\s、，,。]+/).map(s=>s.trim()).filter(Boolean);const splitToken=t=>{const res=[];let current='';let currentType=null;for(const ch of t){const isLatin=/[a-z0-9]/i.test(ch);const type=isLatin?'latin':'other';if(currentType===null||currentType===type){current+=ch;currentType=type;}else{if(current.length>0){res.push(current);}current=ch;currentType=type;}}if(current.length>0){res.push(current);}return res;};const allParts=[];baseParts.forEach(p=>{const parts=splitToken(p);if(parts.length>0){allParts.push(...parts);}else{allParts.push(p);}});const deduped=Array.from(new Set(allParts));return deduped.filter(p=>p.length>=2);};const searchTokens=buildSearchTokens(normalizedQuery);const hasDeviceKeyword=/iphone|galaxy|xiaomi|huawei|pixel|xperia|ipad|macbook|thinkpad|notebook|laptop|surface|switch|playstation|ps5|xbox|tv|bravia|regza|monitor|display|camera|eos|alpha|冷蔵庫|冰箱|洗濯機|洗衣机|airpods|buds/i.test(normalizedQuery);const hasAccessoryKeyword=/ケース|カバー|フィルム|充電器|ケーブル|保護|スタンド|ガラス|バンパー|壳|膜|支架|充電器|アダプタ|adapter|case|cover|charger|cable|ストラップ|ホルダー|dock|ドック|イヤホン|ヘッドホン/i.test(normalizedQuery);const shouldFilterAccessories=hasDeviceKeyword&&!hasAccessoryKeyword;const isAccessoryProduct=name=>{const n=(name||'').toLowerCase();return /ケース|カバー|フィルム|充電器|ケーブル|保護|スタンド|ガラス|バンパー|ストラップ|ホルダー|dock|ドック|adapter|アダプタ|イヤホン|ヘッドホン|screen protector|case|cover|charger|cable/.test(n);};const knownBrands=['Apple','Samsung','Sony','Xiaomi','Huawei','Lenovo','Dell','HP','ASUS','Acer','Nintendo','Microsoft','Canon','Nikon'];const parseFacets=name=>{const n=name||'';const brand=knownBrands.find(b=>new RegExp(b,'i').test(n))||'';const seriesMatch=n.match(/(iPhone|MacBook|iPad|Galaxy|ThinkPad|Surface|PlayStation|Switch|WH\\-\\d{4}XM\\d|RX\\s?\\d{3,}|EOS\\s?\\w+)/i);const series=seriesMatch?seriesMatch[1]:'';const modelMatch=n.match(/([A-Za-z]{1,3}\\-?\\d{2,4}[A-Za-z]?|\\bPro Max\\b|\\bPro\\b|\\bUltra\\b|\\bPlus\\b|\\bAir\\b|\\bMini\\b)/i);const model=modelMatch?modelMatch[1]:'';const storageMatch=n.match(/(\\b\\d{2,4}\\s?(GB|TB)\\b)/i);const storage=storageMatch?storageMatch[1].replace(/\\s+/g,''):'';const colorMatch=n.match(/\\b(Black|White|Silver|Blue|Red|Green|Gold|Pink|Gray|Space Gray|Midnight|ブラック|ホワイト|シルバー|ブルー|レッド|グリーン|ゴールド|ピンク|グレー|スペースグレイ|ミッドナイト)\\b/i);const color=colorMatch?colorMatch[1]:'';const sizeMatch=n.match(/(\\b\\d{1,2}(?:\\.\\d)?\\s?(?:吋|インチ|\"|英寸)\\b)/);const size=sizeMatch?sizeMatch[1]:'';return{brand,series,model,storage,color,size};};const facetIndex=allProducts.map(p=>parseFacets(p.goodsName));const brands=Array.from(new Set(facetIndex.map(f=>f.brand).filter(Boolean)));const series=Array.from(new Set(facetIndex.map(f=>f.series).filter(Boolean)));const models=Array.from(new Set(facetIndex.map(f=>f.model).filter(Boolean)));const storages=Array.from(new Set(facetIndex.map(f=>f.storage).filter(Boolean)));const colors=Array.from(new Set(facetIndex.map(f=>f.color).filter(Boolean)));const sizes=Array.from(new Set(facetIndex.map(f=>f.size).filter(Boolean)));const parseCategory=name=>{const n=(name||'').toLowerCase();if(/手机壳|ケース|保护壳|カバー/.test(n))return{parent:'スマホアクセサリー',child:'ケース'};if(/iphone|galaxy|xiaomi|huawei|pixel|xperia/.test(n))return{parent:'携帯電話・スマートフォン',child:'スマートフォン本体'};if(/ipad|galaxy tab|surface|tablet/.test(n))return{parent:'パソコン・タブレット',child:'タブレットPC'};if(/macbook|thinkpad|notebook|laptop/.test(n))return{parent:'パソコン・タブレット',child:'ノートパソコン'};if(/monitor|display|显示器/.test(n))return{parent:'パソコン周辺機器',child:'モニター'};if(/mouse|keyboard|鼠标|键盘/.test(n))return{parent:'パソコン周辺機器',child:'キーボード・マウス'};if(/airpods|buds|wh-|wf-|耳机/.test(n))return{parent:'オーディオ・楽器',child:'ヘッドホン・イヤホン'};if(/tv|bravia|regza|电视/.test(n))return{parent:'テレビ・映像機器',child:'テレビ'};if(/camera|eos|alpha|相机/.test(n))return{parent:'カメラ',child:'デジタルカメラ'};if(/lens|镜头/.test(n))return{parent:'カメラ',child:'レンズ'};if(/fridge|refrigerator|冰箱/.test(n))return{parent:'生活家電',child:'冷蔵庫'};if(/washing|washer|洗衣机/.test(n))return{parent:'生活家電',child:'洗濯機'};return{parent:'その他',child:'その他'};};const categoriesAll=Array.from(new Set(allProducts.map(p=>{const c=parseCategory(p.goodsName);return\"\".concat(c.parent,\">\").concat(c.child);}).filter(x=>x!=='其他>其他')));// Build hierarchy tree\nconst categoryTree={};categoriesAll.forEach(c=>{const[p,child]=c.split('>');if(!categoryTree[p])categoryTree[p]=[];if(!categoryTree[p].includes(child))categoryTree[p].push(child);});const filteredProducts=allProducts.filter(p=>{const platformOk=selectedPlatforms.length===0||selectedPlatforms.includes(p.mallType);const minOk=minPrice===''||!isNaN(Number(minPrice))&&p.goodsPrice>=Number(minPrice);const maxOk=maxPrice===''||!isNaN(Number(maxPrice))&&p.goodsPrice<=Number(maxPrice);const f=parseFacets(p.goodsName);const brandOk=selectedBrands.length===0||f.brand&&selectedBrands.includes(f.brand);const seriesOk=selectedSeries.length===0||f.series&&selectedSeries.includes(f.series);const modelOk=selectedModels.length===0||f.model&&selectedModels.includes(f.model);const storageOk=selectedStorage.length===0||f.storage&&selectedStorage.includes(f.storage);const colorOk=selectedColors.length===0||f.color&&selectedColors.includes(f.color);const sizeOk=selectedSizes.length===0||f.size&&selectedSizes.includes(f.size);const cat=parseCategory(p.goodsName);const catStr=\"\".concat(cat.parent,\">\").concat(cat.child);const categoryOk=selectedCategories.length===0||selectedCategories.some(sc=>sc===cat.parent||sc===catStr);const validData=p.goodsPrice>0&&p.goodsLink&&p.goodsLink!=='#'&&p.goodsLink!=='';const accessoryOk=!shouldFilterAccessories||!isAccessoryProduct(p.goodsName);const nameLower=(p.goodsName||'').toLowerCase();const keywordOk=searchTokens.length===0||searchTokens.every(t=>nameLower.includes(t));return platformOk&&minOk&&maxOk&&brandOk&&seriesOk&&modelOk&&storageOk&&colorOk&&sizeOk&&categoryOk&&validData&&accessoryOk&&keywordOk;});const sortedProducts=[...filteredProducts].sort((a,b)=>{if(sortOption==='price_asc')return a.goodsPrice-b.goodsPrice;if(sortOption==='price_desc')return b.goodsPrice-a.goodsPrice;if(sortOption==='platform')return a.mallType-b.mallType;if(sortOption==='name')return a.goodsName.localeCompare(b.goodsName);return 0;});const togglePlatform=mt=>{setSelectedPlatforms(prev=>prev.includes(mt)?prev.filter(x=>x!==mt):[...prev,mt]);};const totalPages=searchSource==='local'?Math.max(1,Math.ceil(totalItems/pageSize)):Math.max(1,Math.ceil(sortedProducts.length/pageSize));const currentPageProducts=searchSource==='local'?sortedProducts:sortedProducts.slice((currentPage-1)*pageSize,currentPage*pageSize);const goPrev=()=>setCurrentPage(p=>Math.max(1,p-1));const goNext=()=>setCurrentPage(p=>Math.min(totalPages,p+1));const onChangePageSize=size=>{setPageSize(size);setCurrentPage(1);};const getSelectKey=p=>{if(p.goodsId)return\"id:\".concat(p.goodsId);const base=\"\".concat(p.mallType,\"-\").concat(p.goodsLink||'',\"-\").concat(p.goodsName);return\"k:\".concat(base);};const isSelected=key=>selectedKeys.includes(key);const toggleSelect=p=>{const key=getSelectKey(p);setSelectedKeys(prev=>prev.includes(key)?prev.filter(x=>x!==key):[...prev,key]);};const getSellerFromLink=url=>{if(!url)return'不明な店铺';try{const u=new URL(url.startsWith('http')?url:'https://'+url.replace(/^\\/\\//,''));return u.hostname.replace(/^www\\./,'');}catch(_unused){return'不明な店铺';}};return/*#__PURE__*/_jsxs(\"div\",{className:\"compare-page\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"search-section\",children:[/*#__PURE__*/_jsx(\"h1\",{children:\"\\u5546\\u54C1\\u4FA1\\u683C\\u6BD4\\u8F03\"}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSearch,className:\"search-form\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:query,onChange:e=>setQuery(e.target.value)// 仅更新状态，不触发搜索\n,placeholder:\"\\u5546\\u54C1\\u540D\\u3092\\u5165\\u529B\\u3057\\u3066\\u4FA1\\u683C\\u6BD4\\u8F03...\",className:\"search-input\"}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"search-button\",children:\"\\u641C\\u7D22\"})]})]}),loading&&/*#__PURE__*/_jsx(\"div\",{className:\"loading\",children:\"\\u691C\\u7D22\\u4E2D...\"}),error&&/*#__PURE__*/_jsx(\"div\",{className:\"error\",children:error}),!loading&&!error&&/*#__PURE__*/_jsxs(\"div\",{className:\"compare-container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"sidebar\",children:[searchSource==='local'&&dynamicFilters.length>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"sidebar-section dynamic-filters\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"sidebar-title\",children:\"\\u5C5E\\u6027\\u7B5B\\u9009\"}),dynamicFilters.map(attr=>/*#__PURE__*/_jsxs(\"div\",{className:\"filter-group\",children:[/*#__PURE__*/_jsx(\"h4\",{children:attr.name}),/*#__PURE__*/_jsx(\"ul\",{className:\"filter-options\",children:attr.values&&attr.values.map(val=>/*#__PURE__*/_jsx(\"li\",{children:/*#__PURE__*/_jsxs(\"label\",{children:[/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",checked:selectedDynamicFilters[attr.id]===val,onChange:()=>{setSelectedDynamicFilters(prev=>{if(prev[attr.id]===val){const next=_objectSpread({},prev);delete next[attr.id];return next;}return _objectSpread(_objectSpread({},prev),{},{[attr.id]:val});});}}),val]})},val))})]},attr.id))]}),/*#__PURE__*/_jsxs(\"div\",{className:\"sidebar-section\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"sidebar-title\",children:\"\\u4EF7\\u683C\\u533A\\u95F4\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"price-range-inputs\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"number\",placeholder:\"\\xA5 min\",value:minPrice,onChange:e=>setMinPrice(e.target.value)}),/*#__PURE__*/_jsx(\"span\",{children:\"-\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",placeholder:\"\\xA5 max\",value:maxPrice,onChange:e=>setMaxPrice(e.target.value)})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"sidebar-section\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"sidebar-title\",children:\"\\u5546\\u57CE\"}),/*#__PURE__*/_jsxs(\"ul\",{className:\"filter-list\",children:[/*#__PURE__*/_jsx(\"li\",{children:/*#__PURE__*/_jsxs(\"label\",{children:[/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",checked:selectedPlatforms.includes(10),onChange:()=>togglePlatform(10)}),\" \\u697D\\u5929\"]})}),/*#__PURE__*/_jsx(\"li\",{children:/*#__PURE__*/_jsxs(\"label\",{children:[/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",checked:selectedPlatforms.includes(20),onChange:()=>togglePlatform(20)}),\" Yahoo!\\u30B7\\u30E7\\u30C3\\u30D4\\u30F3\\u30B0\"]})})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"main-content\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"results-header\",children:[/*#__PURE__*/_jsxs(\"h2\",{children:[\"\\\"\",query,\"\\\" \\u641C\\u7D22\\u7ED3\\u679C \",/*#__PURE__*/_jsxs(\"span\",{children:[\"(\",filteredProducts.length,\"\\u4EF6)\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"sort-bar\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"sort-label\",children:\"\\u6392\\u5E8F:\"}),/*#__PURE__*/_jsx(\"button\",{className:\"sort-tab \".concat(sortOption==='price_asc'?'active':''),onClick:()=>setSortOption('price_asc'),children:\"\\u4EF7\\u683C\\u4F4E\\u5230\\u9AD8\"}),/*#__PURE__*/_jsx(\"button\",{className:\"sort-tab \".concat(sortOption==='price_desc'?'active':''),onClick:()=>setSortOption('price_desc'),children:\"\\u4EF7\\u683C\\u9AD8\\u5230\\u4F4E\"}),/*#__PURE__*/_jsx(\"button\",{className:\"sort-tab \".concat(sortOption==='platform'?'active':''),onClick:()=>setSortOption('platform'),children:\"\\u5546\\u57CE\"})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"product-list-view\",children:currentPageProducts.map((product,index)=>/*#__PURE__*/_jsxs(\"div\",{className:\"product-row\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"p-image\",children:/*#__PURE__*/_jsx(\"img\",{src:product.imgUrl||'/images/default-product.png',alt:product.goodsName,onError:e=>e.target.src='/images/default-product.png'})}),/*#__PURE__*/_jsxs(\"div\",{className:\"p-info\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"p-title-row\",children:/*#__PURE__*/_jsx(\"a\",{href:product.goodsLink,target:\"_blank\",rel:\"noopener noreferrer\",className:\"p-title\",onClick:e=>{ensureGoodsIdAndHistory(product,e);},children:product.goodsName})}),/*#__PURE__*/_jsx(\"div\",{className:\"p-specs\",children:function(){const f=parseFacets(product.goodsName);const parts=[f.brand,f.series,f.model,f.storage,f.color,f.size].filter(Boolean);return parts.join(' | ');}()}),/*#__PURE__*/_jsxs(\"div\",{className:\"p-meta\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"mall-tag mall-\".concat(product.mallType),children:getPlatformName(product.mallType)}),/*#__PURE__*/_jsx(\"span\",{className:\"seller\",children:getSellerFromLink(product.goodsLink)})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"p-action\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"p-price\",children:[product.goodsPrice.toLocaleString(),\"\\u5186\"]}),/*#__PURE__*/_jsx(\"a\",{href:product.goodsLink,target:\"_blank\",rel:\"noopener noreferrer\",className:\"btn-shop\",onClick:e=>{ensureGoodsIdAndHistory(product,e);},children:\"\\u524D\\u5F80\\u8D2D\\u4E70\"}),/*#__PURE__*/_jsx(\"button\",{className:\"btn-trend\",onClick:()=>{ensureGoodsIdAndCollect(product);},children:product.goodsId&&collectedIds.has(product.goodsId)?'取消收藏':'收藏'}),/*#__PURE__*/_jsx(\"button\",{className:\"btn-trend\",onClick:()=>{const title=product.goodsName;const labels=Array.from({length:12},(_,i)=>{const d=new Date();d.setMonth(d.getMonth()-(11-i));const m=(d.getMonth()+1).toString().padStart(2,'0');return\"\".concat(d.getFullYear(),\"-\").concat(m);});const base=Math.max(1,product.goodsPrice);let val=base*1.0;const series=labels.map((_,i)=>{const drift=1+Math.sin(i/3)*0.05;const noise=1+(Math.random()-0.5)*0.08;val=Math.max(1,val*drift*noise);return Math.round(val);});setTrendTitle(title);setTrendLabels(labels);setTrendSeries(series);setTrendOpen(true);},children:\"\\u4EF7\\u683C\\u8D70\\u52BF\"}),/*#__PURE__*/_jsxs(\"label\",{className:\"compare-check\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",checked:isSelected(getSelectKey(product)),onChange:()=>toggleSelect(product)}),\" \\u5BF9\\u6BD4\"]})]})]},index))}),/*#__PURE__*/_jsxs(\"div\",{className:\"pagination-controls\",children:[/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:goPrev,disabled:currentPage===1,children:\"\\u4E0A\\u4E00\\u9875\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"page-info\",children:[currentPage,\" / \",totalPages]}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:goNext,disabled:currentPage===totalPages,children:\"\\u4E0B\\u4E00\\u9875\"})]})]}),trendOpen&&/*#__PURE__*/_jsx(\"div\",{className:\"price-trend-modal\",onClick:()=>setTrendOpen(false),children:/*#__PURE__*/_jsxs(\"div\",{className:\"modal-content\",onClick:e=>e.stopPropagation(),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"modal-header\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"modal-title\",children:trendTitle}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"modal-close\",onClick:()=>setTrendOpen(false),children:\"\\xD7\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"modal-body\",children:/*#__PURE__*/_jsx(\"div\",{className:\"trend-chart\",children:function(){const width=600;const height=280;const padding=32;const xs=trendSeries.map((_,i)=>padding+i*(width-2*padding)/(trendSeries.length-1));const minV=Math.min(...trendSeries);const maxV=Math.max(...trendSeries);const ys=trendSeries.map(v=>height-padding-(v-minV)/Math.max(1,maxV-minV)*(height-2*padding));const path=xs.map((x,i)=>\"\".concat(i===0?'M':'L').concat(x,\",\").concat(ys[i])).join(' ');const gridY=[0.25,0.5,0.75].map(r=>height-padding-r*(height-2*padding));return/*#__PURE__*/_jsxs(\"svg\",{width:width,height:height,role:\"img\",\"aria-label\":\"\\u4EF7\\u683C\\u8D8B\\u52BF\\u56FE\",children:[gridY.map((gy,i)=>/*#__PURE__*/_jsx(\"line\",{x1:padding,y1:gy,x2:width-padding,y2:gy,stroke:\"#eee\"},i)),/*#__PURE__*/_jsx(\"path\",{d:path,fill:\"none\",stroke:\"#ff4400\",strokeWidth:2}),xs.map((x,i)=>/*#__PURE__*/_jsx(\"circle\",{cx:x,cy:ys[i],r:3,fill:\"#ff4400\"},i)),/*#__PURE__*/_jsx(\"text\",{x:padding,y:height-8,fontSize:12,fill:\"#999\",children:trendLabels[0]}),/*#__PURE__*/_jsx(\"text\",{x:width-padding-60,y:height-8,fontSize:12,fill:\"#999\",children:trendLabels[trendLabels.length-1]})]});}()})})]})})]}),!loading&&!error&&compareGroups.length===0&&query&&/*#__PURE__*/_jsx(\"div\",{className:\"no-results\",children:\"\\u95A2\\u9023\\u5546\\u54C1\\u304C\\u898B\\u3064\\u304B\\u308A\\u307E\\u305B\\u3093\"})]});};export default ComparePage;","map":{"version":3,"names":["React","useState","useEffect","useSearchParams","goodsApi","categoryApi","userApi","goodsOperateApi","jsx","_jsx","jsxs","_jsxs","ComparePage","searchParams","query","setQuery","get","compareGroups","setCompareGroups","loading","setLoading","error","setError","sortOption","setSortOption","selectedPlatforms","setSelectedPlatforms","minPrice","setMinPrice","maxPrice","setMaxPrice","currentPage","setCurrentPage","pageSize","setPageSize","selectedKeys","setSelectedKeys","selectedBrands","setSelectedBrands","selectedSeries","setSelectedSeries","selectedModels","setSelectedModels","selectedStorage","setSelectedStorage","selectedColors","setSelectedColors","selectedSizes","setSelectedSizes","selectedCategories","setSelectedCategories","trendOpen","setTrendOpen","trendLabels","setTrendLabels","trendSeries","setTrendSeries","trendTitle","setTrendTitle","collectedIds","setCollectedIds","Set","searchSource","setSearchSource","executedQuery","setExecutedQuery","totalItems","setTotalItems","categories","setCategories","dynamicFilters","setDynamicFilters","selectedDynamicFilters","setSelectedDynamicFilters","currentCatId","setCurrentCatId","getList","then","res","data","code","catch","err","console","warn","trim","searchProducts","getAttributes","getMyCollect","Array","isArray","ids","map","g","goodsId","filter","id","e","toggleCollect","has","cancelCollect","prev","next","delete","collect","add","alert","ensureGoodsIdAndCollect","product","token","localStorage","getItem","payload","goodsName","goodsPrice","goodsLink","imgUrl","mallType","status","addRes","addAndReturn","newId","ensureGoodsIdAndHistory","event","preventDefault","stopPropagation","targetUrl","doRedirect","window","open","historyPromise","addHistory","addAndHistory","Promise","race","resolve","setTimeout","searchQuery","minP","Number","undefined","maxP","response","getGoodsPage","records","total","processedData","goodsList","lowestPrice","lowestPlatform","getPlatformName","length","cmpRes","compareGoods","responseData","cmpProcessed","group","lowestProduct","reduce","lowest","current","localRes","_localRes$data$data","_localRes$data$data2","byNameRes","searchGoodsByName","list","searchRes","searchGoods","byNameList","fallbackErr","handleSearch","getPlatformColor","getPlatformBadgeClass","allProducts","flatMap","normalizedQuery","toLowerCase","buildSearchTokens","q","n","baseParts","split","s","Boolean","splitToken","t","currentType","ch","isLatin","test","type","push","allParts","forEach","p","parts","deduped","from","searchTokens","hasDeviceKeyword","hasAccessoryKeyword","shouldFilterAccessories","isAccessoryProduct","name","knownBrands","parseFacets","brand","find","b","RegExp","seriesMatch","match","series","modelMatch","model","storageMatch","storage","replace","colorMatch","color","sizeMatch","size","facetIndex","brands","f","models","storages","colors","sizes","parseCategory","parent","child","categoriesAll","c","concat","x","categoryTree","includes","filteredProducts","platformOk","minOk","isNaN","maxOk","brandOk","seriesOk","modelOk","storageOk","colorOk","sizeOk","cat","catStr","categoryOk","some","sc","validData","accessoryOk","nameLower","keywordOk","every","sortedProducts","sort","a","localeCompare","togglePlatform","mt","totalPages","Math","max","ceil","currentPageProducts","slice","goPrev","goNext","min","onChangePageSize","getSelectKey","base","isSelected","key","toggleSelect","getSellerFromLink","url","u","URL","startsWith","hostname","_unused","className","children","onSubmit","value","onChange","target","placeholder","attr","values","val","checked","_objectSpread","onClick","index","src","alt","onError","href","rel","join","toLocaleString","title","labels","_","i","d","Date","setMonth","getMonth","m","toString","padStart","getFullYear","drift","sin","noise","random","round","disabled","width","height","padding","xs","minV","maxV","ys","v","path","gridY","r","role","gy","x1","y1","x2","y2","stroke","fill","strokeWidth","cx","cy","y","fontSize"],"sources":["C:/Users/3jz/Desktop/HJZDM/frontend/hjzdm-frontend/src/pages/ComparePage.tsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { useSearchParams } from 'react-router-dom';\r\nimport './ComparePage.css';\r\nimport { goodsApi, categoryApi, userApi, goodsOperateApi } from '../services/api';\r\n\r\ninterface Product {\r\n  goodsId?: number;\r\n  goodsName: string;\r\n  goodsPrice: number;\r\n  goodsLink: string;\r\n  imgUrl?: string;\r\n  mallType: number;\r\n}\r\n\r\ninterface CompareGroup {\r\n  goodsName: string;\r\n  goodsList: Product[];\r\n  lowestPrice: number | null;\r\n  lowestPlatform?: string;\r\n}\r\n\r\nconst ComparePage: React.FC = () => {\r\n  const [searchParams] = useSearchParams();\r\n  const [query, setQuery] = useState(searchParams.get('query') || '');\r\n  const [compareGroups, setCompareGroups] = useState<CompareGroup[]>([]);\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [sortOption, setSortOption] = useState('price_asc');\r\n  const [selectedPlatforms, setSelectedPlatforms] = useState<number[]>([]);\r\n  const [minPrice, setMinPrice] = useState('');\r\n  const [maxPrice, setMaxPrice] = useState('');\r\n  const [currentPage, setCurrentPage] = useState(1);\r\n  const [pageSize, setPageSize] = useState(50);\r\n  const [selectedKeys, setSelectedKeys] = useState<string[]>([]);\r\n  const [selectedBrands, setSelectedBrands] = useState<string[]>([]);\r\n  const [selectedSeries, setSelectedSeries] = useState<string[]>([]);\r\n  const [selectedModels, setSelectedModels] = useState<string[]>([]);\r\n  const [selectedStorage, setSelectedStorage] = useState<string[]>([]);\r\n  const [selectedColors, setSelectedColors] = useState<string[]>([]);\r\n  const [selectedSizes, setSelectedSizes] = useState<string[]>([]);\r\n  const [selectedCategories, setSelectedCategories] = useState<string[]>([]);\r\n  const [trendOpen, setTrendOpen] = useState(false);\r\n  const [trendLabels, setTrendLabels] = useState<string[]>([]);\r\n  const [trendSeries, setTrendSeries] = useState<number[]>([]);\r\n  const [trendTitle, setTrendTitle] = useState('');\r\n  const [collectedIds, setCollectedIds] = useState<Set<number>>(new Set());\r\n\r\n  // Search Source\r\n  const [searchSource, setSearchSource] = useState<'local' | 'compare'>('compare');\r\n  const [executedQuery, setExecutedQuery] = useState('');\r\n  const [totalItems, setTotalItems] = useState(0);\r\n\r\n  // Dynamic Filters State\r\n  const [categories, setCategories] = useState<{ catId: number, catName: string, children?: any[] }[]>([]);\r\n  const [dynamicFilters, setDynamicFilters] = useState<{ id: number, name: string, type: string, attrId: number, attrName: string, values?: string[] }[]>([]);\r\n  const [selectedDynamicFilters, setSelectedDynamicFilters] = useState<Record<string, string>>({});\r\n  const [currentCatId, setCurrentCatId] = useState<number | null>(null);\r\n\r\n  // Fetch categories on mount\r\n  useEffect(() => {\r\n    categoryApi.getList().then(res => {\r\n      if (res.data.code === 200) {\r\n        setCategories(res.data.data);\r\n      }\r\n    }).catch(err => console.warn(\"Failed to fetch categories\", err));\r\n  }, []);\r\n\r\n  // 仅在页面加载时，如果有URL参数，则执行搜索\r\n  useEffect(() => {\r\n    if (query.trim()) {\r\n      searchProducts(query);\r\n    }\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, []);\r\n\r\n  // Fetch dynamic attributes when category changes\r\n  useEffect(() => {\r\n    if (currentCatId) {\r\n      categoryApi.getAttributes(currentCatId).then(res => {\r\n        if (res.data.code === 200) {\r\n          setDynamicFilters(res.data.data);\r\n        }\r\n      }).catch(err => console.warn(\"Failed to fetch attributes\", err));\r\n    } else {\r\n      setDynamicFilters([]);\r\n    }\r\n  }, [currentCatId]);\r\n\r\n  // Auto-search when filters change (Local Mode only)\r\n  useEffect(() => {\r\n    if (searchSource === 'local') {\r\n      searchProducts(executedQuery || query);\r\n    }\r\n  }, [selectedDynamicFilters, currentCatId, currentPage, pageSize, searchSource, selectedPlatforms]);\r\n\r\n  useEffect(() => {\r\n    (async () => {\r\n      try {\r\n        const res = await goodsApi.getMyCollect(1, 500);\r\n        if (res.data && res.data.code === 200 && Array.isArray(res.data.data)) {\r\n          const ids = res.data.data.map((g: { goodsId: number }) => g.goodsId).filter((id: number) => typeof id === 'number');\r\n          setCollectedIds(new Set(ids));\r\n        }\r\n      } catch (e) {\r\n      }\r\n    })();\r\n  }, []);\r\n\r\n  const toggleCollect = async (goodsId: number) => {\r\n    try {\r\n      if (collectedIds.has(goodsId)) {\r\n        const res = await goodsOperateApi.cancelCollect(goodsId);\r\n        if (res.data && res.data.code === 200) {\r\n          setCollectedIds(prev => {\r\n            const next = new Set(prev);\r\n            next.delete(goodsId);\r\n            return next;\r\n          });\r\n        }\r\n      } else {\r\n        const res = await goodsOperateApi.collect(goodsId);\r\n        if (res.data && res.data.code === 200) {\r\n          setCollectedIds(prev => {\r\n            const next = new Set(prev);\r\n            next.add(goodsId);\r\n            return next;\r\n          });\r\n        } else {\r\n          alert('请先登录');\r\n        }\r\n      }\r\n    } catch (e) {\r\n      alert('操作失败');\r\n    }\r\n  };\r\n\r\n  const ensureGoodsIdAndCollect = async (product: Product) => {\r\n    try {\r\n      const token = localStorage.getItem('token');\r\n      if (!token) {\r\n        alert('请先登录');\r\n        return;\r\n      }\r\n      if (product.goodsId) {\r\n        await toggleCollect(product.goodsId);\r\n        return;\r\n      }\r\n      const payload: { goodsName: string, goodsPrice: number, goodsLink: string, imgUrl: string, mallType: number, status: number } = {\r\n        goodsName: product.goodsName,\r\n        goodsPrice: product.goodsPrice,\r\n        goodsLink: product.goodsLink,\r\n        imgUrl: product.imgUrl || '',\r\n        mallType: product.mallType,\r\n        status: 1\r\n      };\r\n      const addRes = await goodsApi.addAndReturn(payload);\r\n      if (addRes.data && addRes.data.code === 200 && addRes.data.data && addRes.data.data.goodsId) {\r\n        const newId = addRes.data.data.goodsId as number;\r\n        await toggleCollect(newId);\r\n      } else {\r\n        alert('新增商品失败');\r\n      }\r\n    } catch (e) {\r\n      alert('操作失败');\r\n    }\r\n  };\r\n\r\n  const ensureGoodsIdAndHistory = async (product: Product, event?: React.MouseEvent) => {\r\n    // 阻止默认跳转，必须等待历史记录完成\r\n    if (event) {\r\n      event.preventDefault();\r\n      event.stopPropagation();\r\n    }\r\n\r\n    const targetUrl = product.goodsLink;\r\n    const doRedirect = () => {\r\n      if (targetUrl) {\r\n        window.open(targetUrl, '_blank', 'noopener,noreferrer');\r\n      }\r\n    };\r\n\r\n    try {\r\n      const token = localStorage.getItem('token');\r\n      if (!token) {\r\n        doRedirect();\r\n        return;\r\n      }\r\n\r\n      // Debug log removed\r\n\r\n      // 核心逻辑：无论是已有ID还是新商品，都强制等待 API 完成\r\n      // 为了防止 API 卡死，设置一个 3000ms 的超时的 Promise\r\n      const historyPromise = (async () => {\r\n        if (product.goodsId) {\r\n          // Debug log removed\r\n          await userApi.addHistory(product.goodsId);\r\n          // Debug log removed\r\n        } else {\r\n          // Debug log removed\r\n          const payload: { goodsName: string, goodsPrice: number, goodsLink: string, imgUrl: string, mallType: number, status: number } = {\r\n            goodsName: product.goodsName,\r\n            goodsPrice: product.goodsPrice,\r\n            goodsLink: product.goodsLink,\r\n            imgUrl: product.imgUrl || '',\r\n            mallType: product.mallType,\r\n            status: 1\r\n          };\r\n          // Use the new combined endpoint\r\n          await goodsApi.addAndHistory(payload);\r\n          // Debug log removed\r\n        }\r\n      })();\r\n\r\n      // 竞速：API 完成 vs 5000ms 超时\r\n      await Promise.race([\r\n        historyPromise,\r\n        new Promise(resolve => setTimeout(resolve, 5000))\r\n      ]);\r\n      // Debug logs removed\r\n\r\n    } catch (e) {\r\n      console.error('History record failed:', e);\r\n    } finally {\r\n      // 无论成功失败，必须跳转\r\n      doRedirect();\r\n    }\r\n  };\r\n\r\n  const searchProducts = async (searchQuery: string) => {\r\n    // Debug log removed\r\n    if (!searchQuery.trim() && searchSource === 'compare') return;\r\n\r\n    setExecutedQuery(searchQuery);\r\n    setLoading(true);\r\n    setError(null);\r\n\r\n    try {\r\n      if (searchSource === 'local') {\r\n        const minP = minPrice ? Number(minPrice) : undefined;\r\n        const maxP = maxPrice ? Number(maxPrice) : undefined;\r\n        // Debug log removed\r\n        const response = await goodsApi.getGoodsPage(searchQuery, selectedDynamicFilters, currentCatId || undefined, currentPage, pageSize, minP, maxP, selectedPlatforms);\r\n        // Debug log removed\r\n\r\n        if (response.data && response.data.code === 200) {\r\n          const records = response.data.data.records || [];\r\n          setTotalItems(response.data.data.total || 0);\r\n          const processedData = records.map((g: { goodsId: number, goodsName: string, goodsPrice: number, goodsLink: string, imgUrl: string, mallType: number }) => ({\r\n            goodsName: g.goodsName,\r\n            goodsList: [{\r\n              goodsId: g.goodsId,\r\n              goodsName: g.goodsName,\r\n              goodsPrice: g.goodsPrice,\r\n              goodsLink: g.goodsLink || '#',\r\n              imgUrl: g.imgUrl,\r\n              mallType: g.mallType || 0\r\n            }],\r\n            lowestPrice: g.goodsPrice,\r\n            lowestPlatform: getPlatformName(g.mallType || 0)\r\n          }));\r\n          if (processedData.length === 0) {\r\n            try {\r\n              const cmpRes = await goodsApi.compareGoods(searchQuery);\r\n              let responseData: { goodsName: string, goodsList: any[], lowestPrice: number, lowestPlatform: string }[] = [];\r\n              if (cmpRes.data && cmpRes.data.data) {\r\n                responseData = Array.isArray(cmpRes.data.data) ? cmpRes.data.data : [cmpRes.data.data];\r\n              }\r\n              let cmpProcessed: { goodsName: string, goodsList: any[], lowestPrice: number, lowestPlatform: string }[] = [];\r\n              if (responseData.length > 0) {\r\n                cmpProcessed = responseData.map((group: { goodsName: string, goodsList: any[], lowestPrice: number, lowestPlatform: string }) => {\r\n                  const goodsList = Array.isArray(group.goodsList) ? group.goodsList : [];\r\n                  let lowestPrice: number | null = null;\r\n                  let lowestPlatform = '不明';\r\n                  if (goodsList.length > 0) {\r\n                    const lowestProduct = goodsList.reduce((lowest: any, current: any) =>\r\n                      current.goodsPrice < lowest.goodsPrice ? current : lowest, goodsList[0]);\r\n                    lowestPrice = lowestProduct.goodsPrice;\r\n                    lowestPlatform = getPlatformName(lowestProduct.mallType);\r\n                  }\r\n                  return {\r\n                    goodsName: group.goodsName || '不明な商品',\r\n                    goodsList: goodsList.map((product: any) => ({\r\n                      goodsId: product.goodsId,\r\n                      goodsName: product.goodsName,\r\n                      goodsPrice: product.goodsPrice,\r\n                      goodsLink: product.goodsLink,\r\n                      imgUrl: product.imgUrl || '',\r\n                      mallType: product.mallType\r\n                    })),\r\n                    lowestPrice: lowestPrice || 0,\r\n                    lowestPlatform\r\n                  };\r\n                });\r\n              }\r\n              setCompareGroups(cmpProcessed);\r\n              setLoading(false);\r\n              return;\r\n            } catch (e) {\r\n              console.warn('Fallback compare search failed', e);\r\n            }\r\n          }\r\n          setCompareGroups(processedData);\r\n        } else {\r\n          setCompareGroups([]);\r\n          setTotalItems(0);\r\n          try {\r\n            const cmpRes = await goodsApi.compareGoods(searchQuery);\r\n            let responseData: { goodsName: string, goodsList: any[], lowestPrice: number, lowestPlatform: string }[] = [];\r\n            if (cmpRes.data && cmpRes.data.data) {\r\n              responseData = Array.isArray(cmpRes.data.data) ? cmpRes.data.data : [cmpRes.data.data];\r\n            }\r\n            let processedData: { goodsName: string, goodsList: any[], lowestPrice: number, lowestPlatform: string }[] = [];\r\n            if (responseData.length > 0) {\r\n              processedData = responseData.map((group: { goodsName: string, goodsList: any[], lowestPrice: number | null, lowestPlatform: string }) => {\r\n                const goodsList = Array.isArray(group.goodsList) ? group.goodsList : [];\r\n                let lowestPrice: number | null = null;\r\n                let lowestPlatform = '不明';\r\n                if (goodsList.length > 0) {\r\n                  const lowestProduct = goodsList.reduce((lowest: { goodsPrice: number, mallType?: number }, current: { goodsPrice: number, mallType?: number }) =>\r\n                    current.goodsPrice < lowest.goodsPrice ? current : lowest, goodsList[0]);\r\n                  lowestPrice = lowestProduct.goodsPrice;\r\n                  lowestPlatform = getPlatformName((lowestProduct as any).mallType || 0);\r\n                }\r\n                return {\r\n                  goodsName: group.goodsName || '不明な商品',\r\n                  goodsList: goodsList.map((product: { goodsId: number, goodsName: string, goodsPrice: number, goodsLink: string, imgUrl: string, mallType: number }) => ({\r\n                    goodsId: product.goodsId,\r\n                    goodsName: product.goodsName,\r\n                    goodsPrice: product.goodsPrice,\r\n                    goodsLink: product.goodsLink,\r\n                    imgUrl: product.imgUrl,\r\n                    mallType: product.mallType\r\n                  })),\r\n                  lowestPrice: lowestPrice || 0,\r\n                  lowestPlatform\r\n                };\r\n              });\r\n            }\r\n            setCompareGroups(processedData);\r\n          } catch (e) {\r\n            console.warn('Fallback compare search failed', e);\r\n          }\r\n        }\r\n        setLoading(false);\r\n        return;\r\n      }\r\n\r\n      // デバッグ用ログ removed\r\n\r\n      // 使用api.ts中定义的API服务\r\n      const response = await goodsApi.compareGoods(searchQuery);\r\n\r\n      // デバッグ用ログ removed\r\n\r\n      let responseData = [];\r\n      if (response.data && response.data.data) {\r\n        responseData = Array.isArray(response.data.data) ? response.data.data : [response.data.data];\r\n      } else {\r\n        responseData = [];\r\n      }\r\n\r\n      // デバッグ用ログ removed\r\n\r\n      // レスポンスデータを処理\r\n      let processedData: { goodsName: string, goodsList: { goodsId: number, goodsName: string, goodsPrice: number, goodsLink: string, imgUrl: string, mallType: number }[], lowestPrice: number, lowestPlatform: string }[] = [];\r\n\r\n      if (responseData.length > 0) {\r\n        // APIが返すグループデータを適切に処理\r\n        processedData = responseData.map((group: { goodsName: string, goodsList: { goodsId: number, goodsName: string, goodsPrice: number, goodsLink: string, imgUrl: string, mallType: number }[], lowestPrice: number, lowestPlatform: string }) => {\r\n          // グループ内の商品リストを処理\r\n          const goodsList = Array.isArray(group.goodsList) ? group.goodsList : [];\r\n\r\n          // 最低価格とプラットフォームを特定\r\n          let lowestPrice = null;\r\n          let lowestPlatform = '不明';\r\n\r\n          // 最低価格を計算\r\n          if (goodsList.length > 0) {\r\n            const lowestProduct = goodsList.reduce((lowest: any, current: any) =>\r\n              current.goodsPrice < lowest.goodsPrice ? current : lowest, goodsList[0]);\r\n\r\n            lowestPrice = lowestProduct.goodsPrice;\r\n            lowestPlatform = getPlatformName(lowestProduct.mallType);\r\n          }\r\n\r\n          return {\r\n            goodsName: group.goodsName || '不明な商品',\r\n            goodsList: goodsList.map((product: { goodsId: number, goodsName: string, goodsPrice: number, goodsLink: string, imgUrl: string, mallType: number }) => ({\r\n              goodsId: product.goodsId,\r\n              goodsName: product.goodsName,\r\n              goodsPrice: product.goodsPrice,\r\n              goodsLink: product.goodsLink,\r\n              imgUrl: product.imgUrl,\r\n              mallType: product.mallType\r\n            })),\r\n            lowestPrice: lowestPrice || 0,\r\n            lowestPlatform: lowestPlatform\r\n          };\r\n        });\r\n\r\n        // デバッグ用ログ removed\r\n      }\r\n\r\n      // Fallback: if compare returns empty, try local catalog search\r\n      if (processedData.length === 0) {\r\n        try {\r\n          const localRes = await goodsApi.getGoodsPage(\r\n            searchQuery,\r\n            undefined,\r\n            undefined,\r\n            currentPage,\r\n            pageSize,\r\n            undefined,\r\n            undefined,\r\n            selectedPlatforms\r\n          );\r\n          if (localRes.data && localRes.data.code === 200) {\r\n            const records = localRes.data.data?.records || [];\r\n            setTotalItems(localRes.data.data?.total || 0);\r\n            processedData = records.map((g: { goodsId: number, goodsName: string, goodsPrice: number, goodsLink: string, imgUrl: string, mallType: number }) => ({\r\n              goodsName: g.goodsName,\r\n              goodsList: [{\r\n                goodsId: g.goodsId,\r\n                goodsName: g.goodsName,\r\n                goodsPrice: g.goodsPrice,\r\n                goodsLink: g.goodsLink || '#',\r\n                imgUrl: g.imgUrl,\r\n                mallType: g.mallType || 0\r\n              }],\r\n              lowestPrice: g.goodsPrice,\r\n              lowestPlatform: getPlatformName(g.mallType || 0)\r\n            }));\r\n          }\r\n          // If still empty, try name-based search as last resort\r\n          if (processedData.length === 0) {\r\n            try {\r\n              const byNameRes = await goodsApi.searchGoodsByName(searchQuery);\r\n              const list = (byNameRes.data && byNameRes.data.data)\r\n                ? (Array.isArray(byNameRes.data.data) ? byNameRes.data.data : [byNameRes.data.data])\r\n                : [];\r\n              processedData = list.map((g: { goodsId: number, goodsName: string, goodsPrice: number, goodsLink: string, imgUrl: string, mallType: number }) => ({\r\n                goodsName: g.goodsName,\r\n                goodsList: [{\r\n                  goodsId: g.goodsId,\r\n                  goodsName: g.goodsName,\r\n                  goodsPrice: g.goodsPrice,\r\n                  goodsLink: g.goodsLink || '#',\r\n                  imgUrl: g.imgUrl,\r\n                  mallType: g.mallType || 0\r\n                }],\r\n                lowestPrice: g.goodsPrice,\r\n                lowestPlatform: getPlatformName(g.mallType || 0)\r\n              }));\r\n            } catch (e) {\r\n              console.warn('Name-based fallback search failed', e);\r\n            }\r\n          }\r\n        } catch (e) {\r\n          console.warn('Local catalog fallback search failed', e);\r\n        }\r\n      }\r\n\r\n      // デバッグ用ログ removed\r\n\r\n      setCompareGroups(processedData);\r\n      setLoading(false);\r\n    } catch (err) {\r\n      try {\r\n        let processedData: { goodsName: string, goodsList: { goodsId: number, goodsName: string, goodsPrice: number, goodsLink: string, imgUrl: string, mallType: number }[], lowestPrice: number, lowestPlatform: string }[] = [];\r\n        const searchRes = await goodsApi.searchGoods(searchQuery);\r\n        const list = (searchRes.data && searchRes.data.data)\r\n          ? (Array.isArray(searchRes.data.data) ? searchRes.data.data : [searchRes.data.data])\r\n          : [];\r\n        processedData = list.map((g: { goodsId: number, goodsName: string, goodsPrice: number, goodsLink: string, imgUrl: string, mallType: number }) => ({\r\n          goodsName: g.goodsName,\r\n          goodsList: [{\r\n            goodsId: g.goodsId,\r\n            goodsName: g.goodsName,\r\n            goodsPrice: g.goodsPrice,\r\n            goodsLink: g.goodsLink || '#',\r\n            imgUrl: g.imgUrl,\r\n            mallType: g.mallType || 0\r\n          }],\r\n          lowestPrice: g.goodsPrice,\r\n          lowestPlatform: getPlatformName(g.mallType || 0)\r\n        }));\r\n        if (processedData.length === 0) {\r\n          const byNameRes = await goodsApi.searchGoodsByName(searchQuery);\r\n          const byNameList = (byNameRes.data && byNameRes.data.data)\r\n            ? (Array.isArray(byNameRes.data.data) ? byNameRes.data.data : [byNameRes.data.data])\r\n            : [];\r\n          processedData = byNameList.map((g: { goodsId: number, goodsName: string, goodsPrice: number, goodsLink: string, imgUrl: string, mallType: number }) => ({\r\n            goodsName: g.goodsName,\r\n            goodsList: [{\r\n              goodsId: g.goodsId,\r\n              goodsName: g.goodsName,\r\n              goodsPrice: g.goodsPrice,\r\n              goodsLink: g.goodsLink || '#',\r\n              imgUrl: g.imgUrl,\r\n              mallType: g.mallType || 0\r\n            }],\r\n            lowestPrice: g.goodsPrice,\r\n            lowestPlatform: getPlatformName(g.mallType || 0)\r\n          }));\r\n        }\r\n        setCompareGroups(processedData);\r\n      } catch (fallbackErr) {\r\n        setError('検索に失敗しました。後ほど再試行してください');\r\n        console.warn(fallbackErr);\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n      console.warn(err);\r\n    }\r\n  };\r\n\r\n  const handleSearch = (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    if (query.trim()) {\r\n      searchProducts(query);\r\n    }\r\n  };\r\n\r\n  const getPlatformName = (mallType: number): string => {\r\n    switch (mallType) {\r\n      case 10: return '楽天';\r\n      case 20: return 'Yahoo!';\r\n      case 40: return 'Amazon';\r\n      default: return '其他';\r\n    }\r\n  };\r\n\r\n  const getPlatformColor = (mallType: number): string => {\r\n    switch (mallType) {\r\n      case 10: return '#bf0000'; // Rakuten Red\r\n      case 20: return '#ff0033'; // Yahoo Red\r\n      case 40: return '#FF9900'; // Amazon Orange\r\n      default: return '#666';\r\n    }\r\n  };\r\n\r\n  const getPlatformBadgeClass = (mallType: number): string => {\r\n    switch (mallType) {\r\n      case 10: return 'platform-badge rakuten';\r\n      case 20: return 'platform-badge yahoo';\r\n      case 40: return 'platform-badge amazon';\r\n      default: return 'platform-badge unknown';\r\n    }\r\n  };\r\n\r\n  const allProducts: Product[] = compareGroups.flatMap(group => group.goodsList);\r\n  const normalizedQuery = (executedQuery || query || '').toLowerCase();\r\n  const buildSearchTokens = (q: string): string[] => {\r\n    const n = (q || '').toLowerCase().trim();\r\n    if (!n) return [];\r\n    const baseParts = n.split(/[\\s、，,。]+/).map(s => s.trim()).filter(Boolean);\r\n    const splitToken = (t: string): string[] => {\r\n      const res: string[] = [];\r\n      let current = '';\r\n      let currentType: 'latin' | 'other' | null = null;\r\n      for (const ch of t) {\r\n        const isLatin = /[a-z0-9]/i.test(ch);\r\n        const type: 'latin' | 'other' = isLatin ? 'latin' : 'other';\r\n        if (currentType === null || currentType === type) {\r\n          current += ch;\r\n          currentType = type;\r\n        } else {\r\n          if (current.length > 0) {\r\n            res.push(current);\r\n          }\r\n          current = ch;\r\n          currentType = type;\r\n        }\r\n      }\r\n      if (current.length > 0) {\r\n        res.push(current);\r\n      }\r\n      return res;\r\n    };\r\n    const allParts: string[] = [];\r\n    baseParts.forEach(p => {\r\n      const parts = splitToken(p);\r\n      if (parts.length > 0) {\r\n        allParts.push(...parts);\r\n      } else {\r\n        allParts.push(p);\r\n      }\r\n    });\r\n    const deduped = Array.from(new Set(allParts));\r\n    return deduped.filter(p => p.length >= 2);\r\n  };\r\n  const searchTokens = buildSearchTokens(normalizedQuery);\r\n  const hasDeviceKeyword = /iphone|galaxy|xiaomi|huawei|pixel|xperia|ipad|macbook|thinkpad|notebook|laptop|surface|switch|playstation|ps5|xbox|tv|bravia|regza|monitor|display|camera|eos|alpha|冷蔵庫|冰箱|洗濯機|洗衣机|airpods|buds/i.test(normalizedQuery);\r\n  const hasAccessoryKeyword = /ケース|カバー|フィルム|充電器|ケーブル|保護|スタンド|ガラス|バンパー|壳|膜|支架|充電器|アダプタ|adapter|case|cover|charger|cable|ストラップ|ホルダー|dock|ドック|イヤホン|ヘッドホン/i.test(normalizedQuery);\r\n  const shouldFilterAccessories = hasDeviceKeyword && !hasAccessoryKeyword;\r\n  const isAccessoryProduct = (name: string) => {\r\n    const n = (name || '').toLowerCase();\r\n    return /ケース|カバー|フィルム|充電器|ケーブル|保護|スタンド|ガラス|バンパー|ストラップ|ホルダー|dock|ドック|adapter|アダプタ|イヤホン|ヘッドホン|screen protector|case|cover|charger|cable/.test(n);\r\n  };\r\n  const knownBrands = ['Apple', 'Samsung', 'Sony', 'Xiaomi', 'Huawei', 'Lenovo', 'Dell', 'HP', 'ASUS', 'Acer', 'Nintendo', 'Microsoft', 'Canon', 'Nikon'];\r\n  const parseFacets = (name: string) => {\r\n    const n = name || '';\r\n    const brand = knownBrands.find(b => new RegExp(b, 'i').test(n)) || '';\r\n    const seriesMatch = n.match(/(iPhone|MacBook|iPad|Galaxy|ThinkPad|Surface|PlayStation|Switch|WH\\-\\d{4}XM\\d|RX\\s?\\d{3,}|EOS\\s?\\w+)/i);\r\n    const series = seriesMatch ? seriesMatch[1] : '';\r\n    const modelMatch = n.match(/([A-Za-z]{1,3}\\-?\\d{2,4}[A-Za-z]?|\\bPro Max\\b|\\bPro\\b|\\bUltra\\b|\\bPlus\\b|\\bAir\\b|\\bMini\\b)/i);\r\n    const model = modelMatch ? modelMatch[1] : '';\r\n    const storageMatch = n.match(/(\\b\\d{2,4}\\s?(GB|TB)\\b)/i);\r\n    const storage = storageMatch ? storageMatch[1].replace(/\\s+/g, '') : '';\r\n    const colorMatch = n.match(/\\b(Black|White|Silver|Blue|Red|Green|Gold|Pink|Gray|Space Gray|Midnight|ブラック|ホワイト|シルバー|ブルー|レッド|グリーン|ゴールド|ピンク|グレー|スペースグレイ|ミッドナイト)\\b/i);\r\n    const color = colorMatch ? colorMatch[1] : '';\r\n    const sizeMatch = n.match(/(\\b\\d{1,2}(?:\\.\\d)?\\s?(?:吋|インチ|\"|英寸)\\b)/);\r\n    const size = sizeMatch ? sizeMatch[1] : '';\r\n    return { brand, series, model, storage, color, size };\r\n  };\r\n  const facetIndex = allProducts.map(p => parseFacets(p.goodsName));\r\n  const brands = Array.from(new Set(facetIndex.map(f => f.brand).filter(Boolean)));\r\n  const series = Array.from(new Set(facetIndex.map(f => f.series).filter(Boolean)));\r\n  const models = Array.from(new Set(facetIndex.map(f => f.model).filter(Boolean)));\r\n  const storages = Array.from(new Set(facetIndex.map(f => f.storage).filter(Boolean)));\r\n  const colors = Array.from(new Set(facetIndex.map(f => f.color).filter(Boolean)));\r\n  const sizes = Array.from(new Set(facetIndex.map(f => f.size).filter(Boolean)));\r\n  const parseCategory = (name: string) => {\r\n    const n = (name || '').toLowerCase();\r\n    if (/手机壳|ケース|保护壳|カバー/.test(n)) return { parent: 'スマホアクセサリー', child: 'ケース' };\r\n    if (/iphone|galaxy|xiaomi|huawei|pixel|xperia/.test(n)) return { parent: '携帯電話・スマートフォン', child: 'スマートフォン本体' };\r\n    if (/ipad|galaxy tab|surface|tablet/.test(n)) return { parent: 'パソコン・タブレット', child: 'タブレットPC' };\r\n    if (/macbook|thinkpad|notebook|laptop/.test(n)) return { parent: 'パソコン・タブレット', child: 'ノートパソコン' };\r\n    if (/monitor|display|显示器/.test(n)) return { parent: 'パソコン周辺機器', child: 'モニター' };\r\n    if (/mouse|keyboard|鼠标|键盘/.test(n)) return { parent: 'パソコン周辺機器', child: 'キーボード・マウス' };\r\n    if (/airpods|buds|wh-|wf-|耳机/.test(n)) return { parent: 'オーディオ・楽器', child: 'ヘッドホン・イヤホン' };\r\n    if (/tv|bravia|regza|电视/.test(n)) return { parent: 'テレビ・映像機器', child: 'テレビ' };\r\n    if (/camera|eos|alpha|相机/.test(n)) return { parent: 'カメラ', child: 'デジタルカメラ' };\r\n    if (/lens|镜头/.test(n)) return { parent: 'カメラ', child: 'レンズ' };\r\n    if (/fridge|refrigerator|冰箱/.test(n)) return { parent: '生活家電', child: '冷蔵庫' };\r\n    if (/washing|washer|洗衣机/.test(n)) return { parent: '生活家電', child: '洗濯機' };\r\n    return { parent: 'その他', child: 'その他' };\r\n  };\r\n\r\n  const categoriesAll = Array.from(new Set(allProducts.map(p => {\r\n    const c = parseCategory(p.goodsName);\r\n    return `${c.parent}>${c.child}`;\r\n  }).filter(x => x !== '其他>其他')));\r\n\r\n  // Build hierarchy tree\r\n  const categoryTree: Record<string, string[]> = {};\r\n  categoriesAll.forEach(c => {\r\n    const [p, child] = c.split('>');\r\n    if (!categoryTree[p]) categoryTree[p] = [];\r\n    if (!categoryTree[p].includes(child)) categoryTree[p].push(child);\r\n  });\r\n\r\n  const filteredProducts: Product[] = allProducts.filter(p => {\r\n    const platformOk = selectedPlatforms.length === 0 || selectedPlatforms.includes(p.mallType);\r\n    const minOk = minPrice === '' || (!isNaN(Number(minPrice)) && p.goodsPrice >= Number(minPrice));\r\n    const maxOk = maxPrice === '' || (!isNaN(Number(maxPrice)) && p.goodsPrice <= Number(maxPrice));\r\n    const f = parseFacets(p.goodsName);\r\n    const brandOk = selectedBrands.length === 0 || (f.brand && selectedBrands.includes(f.brand));\r\n    const seriesOk = selectedSeries.length === 0 || (f.series && selectedSeries.includes(f.series));\r\n    const modelOk = selectedModels.length === 0 || (f.model && selectedModels.includes(f.model));\r\n    const storageOk = selectedStorage.length === 0 || (f.storage && selectedStorage.includes(f.storage));\r\n    const colorOk = selectedColors.length === 0 || (f.color && selectedColors.includes(f.color));\r\n    const sizeOk = selectedSizes.length === 0 || (f.size && selectedSizes.includes(f.size));\r\n\r\n    const cat = parseCategory(p.goodsName);\r\n    const catStr = `${cat.parent}>${cat.child}`;\r\n    const categoryOk = selectedCategories.length === 0 ||\r\n      selectedCategories.some(sc => sc === cat.parent || sc === catStr);\r\n\r\n    const validData = p.goodsPrice > 0 && p.goodsLink && p.goodsLink !== '#' && p.goodsLink !== '';\r\n    const accessoryOk = !shouldFilterAccessories || !isAccessoryProduct(p.goodsName);\r\n    const nameLower = (p.goodsName || '').toLowerCase();\r\n    const keywordOk = searchTokens.length === 0 || searchTokens.every(t => nameLower.includes(t));\r\n\r\n    return platformOk && minOk && maxOk && brandOk && seriesOk && modelOk && storageOk && colorOk && sizeOk && categoryOk && validData && accessoryOk && keywordOk;\r\n  });\r\n  const sortedProducts: Product[] = [...filteredProducts].sort((a, b) => {\r\n    if (sortOption === 'price_asc') return a.goodsPrice - b.goodsPrice;\r\n    if (sortOption === 'price_desc') return b.goodsPrice - a.goodsPrice;\r\n    if (sortOption === 'platform') return a.mallType - b.mallType;\r\n    if (sortOption === 'name') return a.goodsName.localeCompare(b.goodsName);\r\n    return 0;\r\n  });\r\n  const togglePlatform = (mt: number) => {\r\n    setSelectedPlatforms(prev => prev.includes(mt) ? prev.filter(x => x !== mt) : [...prev, mt]);\r\n  };\r\n\r\n  const totalPages = searchSource === 'local'\r\n    ? Math.max(1, Math.ceil(totalItems / pageSize))\r\n    : Math.max(1, Math.ceil(sortedProducts.length / pageSize));\r\n\r\n  const currentPageProducts = searchSource === 'local'\r\n    ? sortedProducts\r\n    : sortedProducts.slice((currentPage - 1) * pageSize, currentPage * pageSize);\r\n  const goPrev = () => setCurrentPage(p => Math.max(1, p - 1));\r\n  const goNext = () => setCurrentPage(p => Math.min(totalPages, p + 1));\r\n  const onChangePageSize = (size: number) => { setPageSize(size); setCurrentPage(1); };\r\n\r\n  const getSelectKey = (p: Product) => {\r\n    if (p.goodsId) return `id:${p.goodsId}`;\r\n    const base = `${p.mallType}-${p.goodsLink || ''}-${p.goodsName}`;\r\n    return `k:${base}`;\r\n  };\r\n  const isSelected = (key: string) => selectedKeys.includes(key);\r\n  const toggleSelect = (p: Product) => {\r\n    const key = getSelectKey(p);\r\n    setSelectedKeys(prev => prev.includes(key) ? prev.filter(x => x !== key) : [...prev, key]);\r\n  };\r\n\r\n  const getSellerFromLink = (url?: string) => {\r\n    if (!url) return '不明な店铺';\r\n    try {\r\n      const u = new URL(url.startsWith('http') ? url : ('https://' + url.replace(/^\\/\\//, '')));\r\n      return u.hostname.replace(/^www\\./, '');\r\n    } catch {\r\n      return '不明な店铺';\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"compare-page\">\r\n      <div className=\"search-section\">\r\n        <h1>商品価格比較</h1>\r\n        <form onSubmit={handleSearch} className=\"search-form\">\r\n          <input\r\n            type=\"text\"\r\n            value={query}\r\n            onChange={(e) => setQuery(e.target.value)} // 仅更新状态，不触发搜索\r\n            placeholder=\"商品名を入力して価格比較...\"\r\n            className=\"search-input\"\r\n          />\r\n          <button type=\"submit\" className=\"search-button\">搜索</button>\r\n        </form>\r\n      </div>\r\n\r\n      {loading && <div className=\"loading\">検索中...</div>}\r\n      {error && <div className=\"error\">{error}</div>}\r\n\r\n      {/* Show container if not loading/error, OR if we have results, OR to show sidebar even when empty */}\r\n      {!loading && !error && (\r\n        <div className=\"compare-container\">\r\n          {/* Sidebar Filters */}\r\n          <div className=\"sidebar\">\r\n            {/* Category Tree (Local Mode) removed by request */}\r\n\r\n            {/* Dynamic Filters (Local Mode + Category Selected) */}\r\n            {searchSource === 'local' && dynamicFilters.length > 0 && (\r\n              <div className=\"sidebar-section dynamic-filters\">\r\n                <h3 className=\"sidebar-title\">属性筛选</h3>\r\n                {dynamicFilters.map(attr => (\r\n                  <div key={attr.id} className=\"filter-group\">\r\n                    <h4>{attr.name}</h4>\r\n                    <ul className=\"filter-options\">\r\n                      {(attr as any).values && (attr as any).values.map((val: string) => (\r\n                        <li key={val}>\r\n                          <label>\r\n                            <input\r\n                              type=\"checkbox\"\r\n                              checked={selectedDynamicFilters[attr.id] === val}\r\n                              onChange={() => {\r\n                                setSelectedDynamicFilters(prev => {\r\n                                  if (prev[attr.id] === val) {\r\n                                    const next = { ...prev };\r\n                                    delete next[attr.id];\r\n                                    return next;\r\n                                  }\r\n                                  return { ...prev, [attr.id]: val };\r\n                                });\r\n                              }}\r\n                            />\r\n                            {val}\r\n                          </label>\r\n                        </li>\r\n                      ))}\r\n                    </ul>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            )}\r\n\r\n            {/* Compare mode category filters removed by request */}\r\n\r\n            <div className=\"sidebar-section\">\r\n              <h3 className=\"sidebar-title\">价格区间</h3>\r\n              <div className=\"price-range-inputs\">\r\n                <input type=\"number\" placeholder=\"¥ min\" value={minPrice} onChange={e => setMinPrice(e.target.value)} />\r\n                <span>-</span>\r\n                <input type=\"number\" placeholder=\"¥ max\" value={maxPrice} onChange={e => setMaxPrice(e.target.value)} />\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"sidebar-section\">\r\n              <h3 className=\"sidebar-title\">商城</h3>\r\n              <ul className=\"filter-list\">\r\n                <li><label><input type=\"checkbox\" checked={selectedPlatforms.includes(10)} onChange={() => togglePlatform(10)} /> 楽天</label></li>\r\n                <li><label><input type=\"checkbox\" checked={selectedPlatforms.includes(20)} onChange={() => togglePlatform(20)} /> Yahoo!ショッピング</label></li>\r\n              </ul>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Main Content Results */}\r\n          <div className=\"main-content\">\r\n            <div className=\"results-header\">\r\n              <h2>\"{query}\" 搜索结果 <span>({filteredProducts.length}件)</span></h2>\r\n              <div className=\"sort-bar\">\r\n                <span className=\"sort-label\">排序:</span>\r\n                <button className={`sort-tab ${sortOption === 'price_asc' ? 'active' : ''}`} onClick={() => setSortOption('price_asc')}>价格低到高</button>\r\n                <button className={`sort-tab ${sortOption === 'price_desc' ? 'active' : ''}`} onClick={() => setSortOption('price_desc')}>价格高到低</button>\r\n                <button className={`sort-tab ${sortOption === 'platform' ? 'active' : ''}`} onClick={() => setSortOption('platform')}>商城</button>\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"product-list-view\">\r\n              {currentPageProducts.map((product, index) => (\r\n                <div key={index} className=\"product-row\">\r\n                  <div className=\"p-image\">\r\n                    <img src={product.imgUrl || '/images/default-product.png'} alt={product.goodsName} onError={(e) => (e.target as HTMLImageElement).src = '/images/default-product.png'} />\r\n                  </div>\r\n                  <div className=\"p-info\">\r\n                    <div className=\"p-title-row\">\r\n                      <a\r\n                        href={product.goodsLink}\r\n                        target=\"_blank\"\r\n                        rel=\"noopener noreferrer\"\r\n                        className=\"p-title\"\r\n                        onClick={(e) => { ensureGoodsIdAndHistory(product, e); }}\r\n                      >\r\n                        {product.goodsName}\r\n                      </a>\r\n                    </div>\r\n                    <div className=\"p-specs\">\r\n                      {(function () {\r\n                        const f = parseFacets(product.goodsName);\r\n                        const parts = [f.brand, f.series, f.model, f.storage, f.color, f.size].filter(Boolean);\r\n                        return parts.join(' | ');\r\n                      })()}\r\n                    </div>\r\n                    <div className=\"p-meta\">\r\n                      <span className={`mall-tag mall-${product.mallType}`}>{getPlatformName(product.mallType)}</span>\r\n                      <span className=\"seller\">{getSellerFromLink(product.goodsLink)}</span>\r\n                    </div>\r\n                  </div>\r\n                  <div className=\"p-action\">\r\n                    <div className=\"p-price\">{product.goodsPrice.toLocaleString()}円</div>\r\n                    <a\r\n                      href={product.goodsLink}\r\n                      target=\"_blank\"\r\n                      rel=\"noopener noreferrer\"\r\n                      className=\"btn-shop\"\r\n                      onClick={(e) => { ensureGoodsIdAndHistory(product, e); }}\r\n                    >\r\n                      前往购买\r\n                    </a>\r\n                    <button className=\"btn-trend\" onClick={() => { ensureGoodsIdAndCollect(product); }}>{product.goodsId && collectedIds.has(product.goodsId) ? '取消收藏' : '收藏'}</button>\r\n                    <button className=\"btn-trend\" onClick={() => {\r\n                      const title = product.goodsName;\r\n                      const labels = Array.from({ length: 12 }, (_, i) => {\r\n                        const d = new Date();\r\n                        d.setMonth(d.getMonth() - (11 - i));\r\n                        const m = (d.getMonth() + 1).toString().padStart(2, '0');\r\n                        return `${d.getFullYear()}-${m}`;\r\n                      });\r\n                      const base = Math.max(1, product.goodsPrice);\r\n                      let val = base * 1.0;\r\n                      const series = labels.map((_, i) => {\r\n                        const drift = 1 + Math.sin(i / 3) * 0.05;\r\n                        const noise = 1 + ((Math.random() - 0.5) * 0.08);\r\n                        val = Math.max(1, val * drift * noise);\r\n                        return Math.round(val);\r\n                      });\r\n                      setTrendTitle(title);\r\n                      setTrendLabels(labels);\r\n                      setTrendSeries(series);\r\n                      setTrendOpen(true);\r\n                    }}>价格走势</button>\r\n                    <label className=\"compare-check\">\r\n                      <input type=\"checkbox\" checked={isSelected(getSelectKey(product))} onChange={() => toggleSelect(product)} /> 对比\r\n                    </label>\r\n                  </div>\r\n                </div>\r\n              ))}\r\n            </div>\r\n\r\n            <div className=\"pagination-controls\">\r\n              <button type=\"button\" onClick={goPrev} disabled={currentPage === 1}>上一页</button>\r\n              <span className=\"page-info\">{currentPage} / {totalPages}</span>\r\n              <button type=\"button\" onClick={goNext} disabled={currentPage === totalPages}>下一页</button>\r\n            </div>\r\n          </div>\r\n\r\n          {trendOpen && (\r\n            <div className=\"price-trend-modal\" onClick={() => setTrendOpen(false)}>\r\n              <div className=\"modal-content\" onClick={(e) => e.stopPropagation()}>\r\n                <div className=\"modal-header\">\r\n                  <span className=\"modal-title\">{trendTitle}</span>\r\n                  <button type=\"button\" className=\"modal-close\" onClick={() => setTrendOpen(false)}>×</button>\r\n                </div>\r\n                <div className=\"modal-body\">\r\n                  <div className=\"trend-chart\">\r\n                    {(function () {\r\n                      const width = 600;\r\n                      const height = 280;\r\n                      const padding = 32;\r\n                      const xs = trendSeries.map((_, i) => padding + (i * (width - 2 * padding)) / (trendSeries.length - 1));\r\n                      const minV = Math.min(...trendSeries);\r\n                      const maxV = Math.max(...trendSeries);\r\n                      const ys = trendSeries.map(v => height - padding - ((v - minV) / (Math.max(1, maxV - minV))) * (height - 2 * padding));\r\n                      const path = xs.map((x, i) => `${i === 0 ? 'M' : 'L'}${x},${ys[i]}`).join(' ');\r\n                      const gridY = [0.25, 0.5, 0.75].map(r => height - padding - r * (height - 2 * padding));\r\n                      return (\r\n                        <svg width={width} height={height} role=\"img\" aria-label=\"价格趋势图\">\r\n                          {gridY.map((gy, i) => (\r\n                            <line key={i} x1={padding} y1={gy} x2={width - padding} y2={gy} stroke=\"#eee\" />\r\n                          ))}\r\n                          <path d={path} fill=\"none\" stroke=\"#ff4400\" strokeWidth={2} />\r\n                          {xs.map((x, i) => (\r\n                            <circle key={i} cx={x} cy={ys[i]} r={3} fill=\"#ff4400\" />\r\n                          ))}\r\n                          <text x={padding} y={height - 8} fontSize={12} fill=\"#999\">{trendLabels[0]}</text>\r\n                          <text x={width - padding - 60} y={height - 8} fontSize={12} fill=\"#999\">{trendLabels[trendLabels.length - 1]}</text>\r\n                        </svg>\r\n                      );\r\n                    })()}\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          )}\r\n        </div>\r\n      )}\r\n\r\n      {!loading && !error && compareGroups.length === 0 && query && (\r\n        <div className=\"no-results\">関連商品が見つかりません</div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ComparePage;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}