{"ast":null,"code":"import _objectSpread from\"C:/Users/3jz/Desktop/HJZDM/frontend/hjzdm-frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect}from'react';import{useNavigate}from'react-router-dom';import{notificationApi}from'../services/api';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const NotificationPage=()=>{const navigate=useNavigate();const[list,setList]=useState([]);const[loading,setLoading]=useState(true);const load=async()=>{try{var _res$data;setLoading(true);const res=await notificationApi.getMyNotifications();setList(((_res$data=res.data)===null||_res$data===void 0?void 0:_res$data.data)||[]);}catch(e){console.error(e);}finally{setLoading(false);}};useEffect(()=>{load();},[]);const handleRead=async id=>{// 乐观更新\nsetList(prev=>prev.map(it=>it.id===id?_objectSpread(_objectSpread({},it),{},{isRead:1}):it));try{await notificationApi.markAsRead(id);}catch(e){console.error(e);}};const handleReadAll=async()=>{setList(prev=>prev.map(it=>_objectSpread(_objectSpread({},it),{},{isRead:1})));try{await notificationApi.markAllAsRead();}catch(e){console.error(e);}};const handleDelete=async id=>{if(window.confirm('この通知を削除してもよろしいですか？')){try{await notificationApi.deleteNotification(id);// 通知リストを更新\nsetList(prev=>prev.filter(it=>it.id!==id));}catch(e){console.error(e);alert('通知の削除に失敗しました');}}};return/*#__PURE__*/_jsxs(\"div\",{style:{maxWidth:800,margin:'20px auto',padding:20,background:'#fff',borderRadius:8,boxShadow:'0 2px 8px rgba(0,0,0,0.1)'},children:[/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:20,borderBottom:'1px solid #eee',paddingBottom:10},children:[/*#__PURE__*/_jsx(\"h2\",{style:{margin:0},children:\"\\u30E1\\u30C3\\u30BB\\u30FC\\u30B8\\u901A\\u77E5\"}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',gap:10},children:[/*#__PURE__*/_jsx(\"button\",{onClick:handleReadAll,style:{padding:'6px 12px',background:'#fff',border:'1px solid #ddd',borderRadius:4,cursor:'pointer'},children:\"\\u5168\\u3066\\u65E2\\u8AAD\\u306B\\u3059\\u308B\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>navigate(-1),style:{padding:'6px 12px',background:'#f5f5f5',border:'1px solid #ddd',borderRadius:4,cursor:'pointer'},children:\"\\u623B\\u308B\"})]})]}),loading?/*#__PURE__*/_jsx(\"div\",{style:{textAlign:'center',padding:20},children:\"Loading...\"}):/*#__PURE__*/_jsxs(\"div\",{children:[list.length===0&&/*#__PURE__*/_jsx(\"div\",{style:{textAlign:'center',color:'#999',padding:40},children:\"\\u901A\\u77E5\\u306F\\u3042\\u308A\\u307E\\u305B\\u3093\"}),list.map(item=>/*#__PURE__*/_jsxs(\"div\",{onClick:()=>item.isRead===0&&handleRead(item.id),style:{padding:'15px',borderBottom:'1px solid #eee',background:item.isRead===0?'#e6f7ff':'#fff',cursor:item.isRead===0?'pointer':'default',transition:'background 0.3s',position:'relative'},children:[/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',justifyContent:'space-between',marginBottom:6},children:[/*#__PURE__*/_jsxs(\"div\",{style:{fontWeight:'bold',color:'#333'},children:[item.isRead===0&&/*#__PURE__*/_jsx(\"span\",{style:{color:'#1890ff',marginRight:6},children:\"\\u25CF\"}),item.title]}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',alignItems:'center',gap:8},children:[/*#__PURE__*/_jsx(\"div\",{style:{fontSize:12,color:'#999'},children:new Date(item.createTime).toLocaleString()}),/*#__PURE__*/_jsx(\"button\",{onClick:e=>{e.stopPropagation();// Prevent triggering the parent click handler\nhandleDelete(item.id);},style:{padding:'4px 8px',background:'#f5f5f5',border:'1px solid #ddd',borderRadius:'4px',cursor:'pointer',fontSize:'12px'},children:\"\\u524A\\u9664\"})]})]}),/*#__PURE__*/_jsx(\"div\",{style:{color:'#666',fontSize:14,lineHeight:1.5},children:item.content})]},item.id))]})]});};export default NotificationPage;","map":{"version":3,"names":["React","useState","useEffect","useNavigate","notificationApi","jsx","_jsx","jsxs","_jsxs","NotificationPage","navigate","list","setList","loading","setLoading","load","_res$data","res","getMyNotifications","data","e","console","error","handleRead","id","prev","map","it","_objectSpread","isRead","markAsRead","handleReadAll","markAllAsRead","handleDelete","window","confirm","deleteNotification","filter","alert","style","maxWidth","margin","padding","background","borderRadius","boxShadow","children","display","justifyContent","alignItems","marginBottom","borderBottom","paddingBottom","gap","onClick","border","cursor","textAlign","length","color","item","transition","position","fontWeight","marginRight","title","fontSize","Date","createTime","toLocaleString","stopPropagation","lineHeight","content"],"sources":["C:/Users/3jz/Desktop/HJZDM/frontend/hjzdm-frontend/src/pages/NotificationPage.tsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { notificationApi } from '../services/api';\n\ninterface Notification {\n  id: number;\n  title: string;\n  content: string;\n  isRead: number;\n  createTime: string;\n}\n\nconst NotificationPage: React.FC = () => {\n  const navigate = useNavigate();\n  const [list, setList] = useState<Notification[]>([]);\n  const [loading, setLoading] = useState(true);\n\n  const load = async () => {\n    try {\n      setLoading(true);\n      const res = await notificationApi.getMyNotifications();\n      setList(res.data?.data || []);\n    } catch (e) {\n      console.error(e);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  useEffect(() => {\n    load();\n  }, []);\n\n  const handleRead = async (id: number) => {\n    // 乐观更新\n    setList(prev => prev.map(it => it.id === id ? { ...it, isRead: 1 } : it));\n    try {\n      await notificationApi.markAsRead(id);\n    } catch (e) {\n      console.error(e);\n    }\n  };\n\n  const handleReadAll = async () => {\n    setList(prev => prev.map(it => ({ ...it, isRead: 1 })));\n    try {\n      await notificationApi.markAllAsRead();\n    } catch (e) {\n      console.error(e);\n    }\n  };\n\n  const handleDelete = async (id: number) => {\n    if (window.confirm('この通知を削除してもよろしいですか？')) {\n      try {\n        await notificationApi.deleteNotification(id);\n        // 通知リストを更新\n        setList(prev => prev.filter(it => it.id !== id));\n      } catch (e) {\n        console.error(e);\n        alert('通知の削除に失敗しました');\n      }\n    }\n  };\n\n  return (\n    <div style={{ maxWidth: 800, margin: '20px auto', padding: 20, background: '#fff', borderRadius: 8, boxShadow: '0 2px 8px rgba(0,0,0,0.1)' }}>\n      <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: 20, borderBottom: '1px solid #eee', paddingBottom: 10 }}>\n        <h2 style={{ margin: 0 }}>メッセージ通知</h2>\n        <div style={{ display: 'flex', gap: 10 }}>\n          <button \n            onClick={handleReadAll} \n            style={{ padding: '6px 12px', background: '#fff', border: '1px solid #ddd', borderRadius: 4, cursor: 'pointer' }}\n          >\n            全て既読にする\n          </button>\n          <button \n            onClick={() => navigate(-1)} \n            style={{ padding: '6px 12px', background: '#f5f5f5', border: '1px solid #ddd', borderRadius: 4, cursor: 'pointer' }}\n          >\n            戻る\n          </button>\n        </div>\n      </div>\n\n      {loading ? <div style={{ textAlign: 'center', padding: 20 }}>Loading...</div> : (\n        <div>\n          {list.length === 0 && <div style={{ textAlign: 'center', color: '#999', padding: 40 }}>通知はありません</div>}\n          {list.map(item => (\n            <div \n              key={item.id} \n              onClick={() => item.isRead === 0 && handleRead(item.id)}\n              style={{ \n                padding: '15px', \n                borderBottom: '1px solid #eee', \n                background: item.isRead === 0 ? '#e6f7ff' : '#fff',\n                cursor: item.isRead === 0 ? 'pointer' : 'default',\n                transition: 'background 0.3s',\n                position: 'relative'\n              }}\n            >\n              <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: 6 }}>\n                <div style={{ fontWeight: 'bold', color: '#333' }}>\n                  {item.isRead === 0 && <span style={{ color: '#1890ff', marginRight: 6 }}>●</span>}\n                  {item.title}\n                </div>\n                <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\n                  <div style={{ fontSize: 12, color: '#999' }}>\n                    {new Date(item.createTime).toLocaleString()}\n                  </div>\n                  <button\n                    onClick={(e) => {\n                      e.stopPropagation(); // Prevent triggering the parent click handler\n                      handleDelete(item.id);\n                    }}\n                    style={{\n                      padding: '4px 8px',\n                      background: '#f5f5f5',\n                      border: '1px solid #ddd',\n                      borderRadius: '4px',\n                      cursor: 'pointer',\n                      fontSize: '12px'\n                    }}\n                  >\n                    削除\n                  </button>\n                </div>\n              </div>\n              <div style={{ color: '#666', fontSize: 14, lineHeight: 1.5 }}>\n                {item.content}\n              </div>\n            </div>\n          ))}\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default NotificationPage;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}