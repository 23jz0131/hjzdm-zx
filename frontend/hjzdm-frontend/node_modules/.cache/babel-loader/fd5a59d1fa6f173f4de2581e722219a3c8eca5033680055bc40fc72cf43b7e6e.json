{"ast":null,"code":"import React,{useState,useEffect}from'react';import{Link,useNavigate,useLocation}from'react-router-dom';import'./Header.css';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const Header=()=>{const navigate=useNavigate();const location=useLocation();const[isLoggedIn,setIsLoggedIn]=useState(false);const[username,setUsername]=useState('');const[isAdmin,setIsAdmin]=useState(false);// 检查当前是否在比价页面\nconst isComparePage=location.pathname==='/compare';const isHomePage=location.pathname==='/';const isAdminPage=location.pathname.includes('/admin');const isProfilePage=location.pathname.includes('/profile');const isLoginPage=location.pathname==='/login'||location.pathname==='/register';const isCommunityPage=location.pathname==='/community';const isRegisterPage=location.pathname==='/register';// Also treat register separately for consistency\n// 调试日志\nuseEffect(()=>{// Debug logs removed\n},[location.pathname,isComparePage,isHomePage,isAdminPage,isProfilePage,isLoginPage,isCommunityPage,isRegisterPage]);const syncAuthState=()=>{const token=localStorage.getItem('token');if(!token){setIsLoggedIn(false);setUsername('');setIsAdmin(false);return;}setIsLoggedIn(true);try{const payload=JSON.parse(atob(token.split('.')[1]));const userId=payload===null||payload===void 0?void 0:payload.userId;setUsername(userId?\"\\u30E6\\u30FC\\u30B6\\u30FC\".concat(userId):'ユーザー');const adminStatus=(payload===null||payload===void 0?void 0:payload.userId)===1||(payload===null||payload===void 0?void 0:payload.sub)==='admin'||(payload===null||payload===void 0?void 0:payload.username)==='admin'||(payload===null||payload===void 0?void 0:payload.name)==='admin';setIsAdmin(adminStatus);}catch(_unused){setUsername('ユーザー');setIsAdmin(false);}};useEffect(()=>{syncAuthState();},[location.pathname]);useEffect(()=>{const onStorage=e=>{if(e.key==='token'){syncAuthState();}};window.addEventListener('storage',onStorage);return()=>window.removeEventListener('storage',onStorage);},[]);const handleLogout=()=>{localStorage.removeItem('token');setIsLoggedIn(false);setUsername('');setIsAdmin(false);navigate('/');};const handleSearch=e=>{var _formData$get;e.preventDefault();const formData=new FormData(e.target);const query=(_formData$get=formData.get('query'))===null||_formData$get===void 0?void 0:_formData$get.toString();if(query){// 可以跳转到比价ページ并传递搜索参数\nnavigate(\"/compare?query=\".concat(encodeURIComponent(query)));}};return/*#__PURE__*/_jsxs(\"header\",{className:\"header\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"header-top\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"logo\",children:/*#__PURE__*/_jsx(Link,{to:\"/\",children:\"\\u60E0\\u8CFC\\u4FA1\\u683C\\u6BD4\\u8F03\"})}),/*#__PURE__*/_jsxs(\"nav\",{className:\"nav\",children:[/*#__PURE__*/_jsx(Link,{to:\"/\",children:\"\\u30DB\\u30FC\\u30E0\"}),/*#__PURE__*/_jsx(Link,{to:\"/compare\",children:\"\\u4FA1\\u683C\\u6BD4\\u8F03\"}),/*#__PURE__*/_jsx(Link,{to:\"/community\",children:\"\\u307F\\u3093\\u306A\\u306E\\u6295\\u7A3F\"}),isLoggedIn&&/*#__PURE__*/_jsx(Link,{to:\"/browse-history\",children:\"\\u95B2\\u89A7\\u5C65\\u6B74\"}),isAdmin&&/*#__PURE__*/_jsx(Link,{to:\"/admin/disclosures\",style:{color:'#ff4d4f'},children:\"\\u6295\\u7A3F\\u5BE9\\u67FB\"}),/*#__PURE__*/_jsx(Link,{to:isLoggedIn?'/profile':'/login',children:\"\\u30DE\\u30A4\\u30DA\\u30FC\\u30B8\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"user-actions\",children:isLoggedIn?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"span\",{className:\"user-name\",children:username}),/*#__PURE__*/_jsx(\"button\",{onClick:handleLogout,className:\"logout-button\",children:\"\\u30ED\\u30B0\\u30A2\\u30A6\\u30C8\"})]}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Link,{to:\"/login\",className:\"auth-link auth-primary\",children:\"\\u30ED\\u30B0\\u30A4\\u30F3\"}),/*#__PURE__*/_jsx(Link,{to:\"/register\",className:\"auth-link\",children:\"\\u65B0\\u898F\\u767B\\u9332\"})]})})]}),!isComparePage&&!isHomePage&&!isAdminPage&&!isProfilePage&&!isLoginPage&&!isCommunityPage&&!isRegisterPage&&/*#__PURE__*/_jsx(\"div\",{className:\"header-search\",children:/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSearch,children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"query\",placeholder:\"\\u5546\\u54C1\\u3092\\u691C\\u7D22...\",className:\"search-input\"}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"search-button\",children:\"\\u691C\\u7D22\"})]})})]});};export default Header;","map":{"version":3,"names":["React","useState","useEffect","Link","useNavigate","useLocation","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","Header","navigate","location","isLoggedIn","setIsLoggedIn","username","setUsername","isAdmin","setIsAdmin","isComparePage","pathname","isHomePage","isAdminPage","includes","isProfilePage","isLoginPage","isCommunityPage","isRegisterPage","syncAuthState","token","localStorage","getItem","payload","JSON","parse","atob","split","userId","concat","adminStatus","sub","name","_unused","onStorage","e","key","window","addEventListener","removeEventListener","handleLogout","removeItem","handleSearch","_formData$get","preventDefault","formData","FormData","target","query","get","toString","encodeURIComponent","className","children","to","style","color","onClick","onSubmit","type","placeholder"],"sources":["C:/Users/3jz/Desktop/HJZDM/frontend/hjzdm-frontend/src/components/Header.tsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { Link, useNavigate, useLocation } from 'react-router-dom';\r\nimport './Header.css';\r\n\r\nconst Header: React.FC = () => {\r\n  const navigate = useNavigate();\r\n  const location = useLocation();\r\n  const [isLoggedIn, setIsLoggedIn] = useState(false);\r\n  const [username, setUsername] = useState('');\r\n  const [isAdmin, setIsAdmin] = useState(false);\r\n\r\n  // 检查当前是否在比价页面\r\n  const isComparePage = location.pathname === '/compare';\r\n  const isHomePage = location.pathname === '/';\r\n  const isAdminPage = location.pathname.includes('/admin');\r\n  const isProfilePage = location.pathname.includes('/profile');\r\n  const isLoginPage = location.pathname === '/login' || location.pathname === '/register';\r\n  const isCommunityPage = location.pathname === '/community';\r\n  const isRegisterPage = location.pathname === '/register'; // Also treat register separately for consistency\r\n\r\n  // 调试日志\r\n  useEffect(() => {\r\n    // Debug logs removed\r\n  }, [location.pathname, isComparePage, isHomePage, isAdminPage, isProfilePage, isLoginPage, isCommunityPage, isRegisterPage]);\r\n\r\n  const syncAuthState = () => {\r\n    const token = localStorage.getItem('token');\r\n    if (!token) {\r\n      setIsLoggedIn(false);\r\n      setUsername('');\r\n      setIsAdmin(false);\r\n      return;\r\n    }\r\n\r\n    setIsLoggedIn(true);\r\n\r\n    try {\r\n      const payload = JSON.parse(atob(token.split('.')[1]));\r\n      const userId = payload?.userId;\r\n      setUsername(userId ? `ユーザー${userId}` : 'ユーザー');\r\n\r\n      const adminStatus = payload?.userId === 1 || payload?.sub === 'admin' || payload?.username === 'admin' || payload?.name === 'admin';\r\n      setIsAdmin(adminStatus);\r\n    } catch {\r\n      setUsername('ユーザー');\r\n      setIsAdmin(false);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    syncAuthState();\r\n  }, [location.pathname]);\r\n\r\n  useEffect(() => {\r\n    const onStorage = (e: StorageEvent) => {\r\n      if (e.key === 'token') {\r\n        syncAuthState();\r\n      }\r\n    };\r\n\r\n    window.addEventListener('storage', onStorage);\r\n    return () => window.removeEventListener('storage', onStorage);\r\n  }, []);\r\n\r\n  const handleLogout = () => {\r\n    localStorage.removeItem('token');\r\n    setIsLoggedIn(false);\r\n    setUsername('');\r\n    setIsAdmin(false);\r\n    navigate('/');\r\n  };\r\n\r\n  const handleSearch = (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    const formData = new FormData(e.target as HTMLFormElement);\r\n    const query = formData.get('query')?.toString();\r\n    if (query) {\r\n      // 可以跳转到比价ページ并传递搜索参数\r\n      navigate(`/compare?query=${encodeURIComponent(query)}`);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <header className=\"header\">\r\n      <div className=\"header-top\">\r\n        <div className=\"logo\">\r\n          <Link to=\"/\">惠購価格比較</Link>\r\n        </div>\r\n        <nav className=\"nav\">\r\n          <Link to=\"/\">ホーム</Link>\r\n          <Link to=\"/compare\">価格比較</Link>\r\n          <Link to=\"/community\">みんなの投稿</Link>\r\n          {isLoggedIn && <Link to=\"/browse-history\">閲覧履歴</Link>}\r\n          {isAdmin && <Link to=\"/admin/disclosures\" style={{ color: '#ff4d4f' }}>投稿審査</Link>}\r\n          <Link to={isLoggedIn ? '/profile' : '/login'}>マイページ</Link>\r\n        </nav>\r\n        <div className=\"user-actions\">\r\n          {isLoggedIn ? (\r\n            <>\r\n              <span className=\"user-name\">{username}</span>\r\n              <button onClick={handleLogout} className=\"logout-button\">\r\n                ログアウト\r\n              </button>\r\n            </>\r\n          ) : (\r\n            <>\r\n              <Link to=\"/login\" className=\"auth-link auth-primary\">ログイン</Link>\r\n              <Link to=\"/register\" className=\"auth-link\">新規登録</Link>\r\n            </>\r\n          )}\r\n        </div>\r\n      </div>\r\n      {!isComparePage && !isHomePage && !isAdminPage && !isProfilePage && !isLoginPage && !isCommunityPage && !isRegisterPage && (\r\n        <div className=\"header-search\">\r\n          <form onSubmit={handleSearch}>\r\n            <input \r\n              type=\"text\" \r\n              name=\"query\" \r\n              placeholder=\"商品を検索...\" \r\n              className=\"search-input\"\r\n            />\r\n            <button type=\"submit\" className=\"search-button\">検索</button>\r\n          </form>\r\n        </div>\r\n      )}\r\n    </header>\r\n  );\r\n};\r\n\r\nexport default Header;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}