{"ast":null,"code":"import _objectSpread from\"C:/Users/3jz/Desktop/HJZDM/frontend/hjzdm-frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState}from'react';import{useNavigate,Link}from'react-router-dom';import{userApi}from'../services/api';import'./LoginPage.css';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const apiBaseUrl=process.env.REACT_APP_API_BASE_URL||'http://localhost:9090';const LoginPage=()=>{const[formData,setFormData]=useState({phone:'',password:''});const[error,setError]=useState(null);const[loading,setLoading]=useState(false);const navigate=useNavigate();const handleChange=e=>{const{name,value}=e.target;setFormData(prev=>_objectSpread(_objectSpread({},prev),{},{[name]:value}));// 清除之前的错误信息\nif(error)setError(null);};const handleSubmit=async e=>{var _err$response$data;e.preventDefault();setLoading(true);setError(null);try{// 调用真实API - 使用新的login端点\nconst response=await userApi.login({username:formData.phone,// 使用username字段，但保持变量名不变以兼容现有代码\npassword:formData.password});// 调试日志 removed\nif(response.data&&response.data.code===200){var _response$data$data;// 登录成功，跳转到主页\nconst token=response.data.token||((_response$data$data=response.data.data)===null||_response$data$data===void 0?void 0:_response$data$data.token);if(token){localStorage.setItem('token',token);}navigate('/');}else{var _response$data,_response$data2;// 尝试从响应中获取错误消息\nconst errorMessage=((_response$data=response.data)===null||_response$data===void 0?void 0:_response$data.message)||((_response$data2=response.data)===null||_response$data2===void 0?void 0:_response$data2.msg)||'ログインに失敗しました。再試行してください。';setError(errorMessage);}}catch(err){// 处理不同的错误情况\nif(err.response){// 服务器响应错误\nswitch(err.response.status){case 401:setError('ユーザー名またはパスワードが間違っています。');break;case 404:setError('ユーザーが存在しません。');break;case 500:setError('サーバーエラーが発生しました。後ほど再試行してください。');break;default:setError(((_err$response$data=err.response.data)===null||_err$response$data===void 0?void 0:_err$response$data.message)||'ログインに失敗しました。再試行してください。');}}else if(err.request){// 网络错误\nsetError(\"\\u30CD\\u30C3\\u30C8\\u30EF\\u30FC\\u30AF\\u63A5\\u7D9A\\u306B\\u5931\\u6557\\u3057\\u307E\\u3057\\u305F\\u3002\\u30D0\\u30C3\\u30AF\\u30A8\\u30F3\\u30C9(\".concat(apiBaseUrl,\")\\u304C\\u8D77\\u52D5\\u3057\\u3066\\u3044\\u308B\\u304B\\u78BA\\u8A8D\\u3057\\u3066\\u304F\\u3060\\u3055\\u3044\\u3002\"));}else{// 其他错误\nsetError('ログイン中にエラーが発生しました。再試行してください。');}}finally{setLoading(false);}};return/*#__PURE__*/_jsx(\"div\",{className:\"login-page\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"login-container\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"\\u30ED\\u30B0\\u30A4\\u30F3\"}),error&&/*#__PURE__*/_jsx(\"div\",{className:\"error-message\",children:error}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,className:\"login-form\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"phone\",children:\"\\u30E6\\u30FC\\u30B6\\u30FC\\u540D\\u307E\\u305F\\u306F\\u30E1\\u30FC\\u30EB\\u30A2\\u30C9\\u30EC\\u30B9\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",id:\"phone\",name:\"phone\",value:formData.phone,onChange:handleChange,placeholder:\"\\u30E6\\u30FC\\u30B6\\u30FC\\u540D\\u307E\\u305F\\u306F\\u30E1\\u30FC\\u30EB\\u30A2\\u30C9\\u30EC\\u30B9\\u3092\\u5165\\u529B\",required:true,className:\"form-input\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"password\",children:\"\\u30D1\\u30B9\\u30EF\\u30FC\\u30C9\"}),/*#__PURE__*/_jsx(\"input\",{type:\"password\",id:\"password\",name:\"password\",value:formData.password,onChange:handleChange,placeholder:\"\\u30D1\\u30B9\\u30EF\\u30FC\\u30C9\\u3092\\u5165\\u529B\",required:true,className:\"form-input\"})]}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"login-button\",disabled:loading,children:loading?'ログイン中...':'ログイン'})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"login-footer\",children:[/*#__PURE__*/_jsxs(\"p\",{children:[\"\\u30A2\\u30AB\\u30A6\\u30F3\\u30C8\\u3092\\u304A\\u6301\\u3061\\u3067\\u306A\\u3044\\u3067\\u3059\\u304B\\uFF1F \",/*#__PURE__*/_jsx(Link,{to:\"/register\",className:\"link\",children:\"\\u65B0\\u898F\\u767B\\u9332\"})]}),/*#__PURE__*/_jsx(Link,{to:\"/\",className:\"link\",children:\"\\u30C8\\u30C3\\u30D7\\u30DA\\u30FC\\u30B8\\u3078\\u623B\\u308B\"})]})]})});};export default LoginPage;","map":{"version":3,"names":["React","useState","useNavigate","Link","userApi","jsx","_jsx","jsxs","_jsxs","apiBaseUrl","process","env","REACT_APP_API_BASE_URL","LoginPage","formData","setFormData","phone","password","error","setError","loading","setLoading","navigate","handleChange","e","name","value","target","prev","_objectSpread","handleSubmit","_err$response$data","preventDefault","response","login","username","data","code","_response$data$data","token","localStorage","setItem","_response$data","_response$data2","errorMessage","message","msg","err","status","request","concat","className","children","onSubmit","htmlFor","type","id","onChange","placeholder","required","disabled","to"],"sources":["C:/Users/3jz/Desktop/HJZDM/frontend/hjzdm-frontend/src/pages/LoginPage.tsx"],"sourcesContent":["import React, { useState } from 'react';\r\nimport { useNavigate, Link } from 'react-router-dom';\r\nimport { userApi } from '../services/api';\r\nimport './LoginPage.css';\r\n\r\nconst apiBaseUrl = process.env.REACT_APP_API_BASE_URL || 'http://localhost:9090';\r\n\r\ninterface LoginFormData {\r\n  phone: string; // 使用phone字段兼容后端API\r\n  password: string;\r\n}\r\n\r\nconst LoginPage: React.FC = () => {\r\n  const [formData, setFormData] = useState<LoginFormData>({\r\n    phone: '',\r\n    password: ''\r\n  });\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [loading, setLoading] = useState(false);\r\n  const navigate = useNavigate();\r\n\r\n  const handleChange = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const { name, value } = e.target;\r\n    setFormData(prev => ({\r\n      ...prev,\r\n      [name]: value\r\n    }));\r\n    // 清除之前的错误信息\r\n    if (error) setError(null);\r\n  };\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    setLoading(true);\r\n    setError(null);\r\n\r\n    try {\r\n      // 调用真实API - 使用新的login端点\r\n      const response = await userApi.login({\r\n        username: formData.phone, // 使用username字段，但保持变量名不变以兼容现有代码\r\n        password: formData.password\r\n      });\r\n\r\n      // 调试日志 removed\r\n      \r\n      if (response.data && response.data.code === 200) {\r\n        // 登录成功，跳转到主页\r\n        const token = response.data.token || response.data.data?.token;\r\n        if (token) {\r\n          localStorage.setItem('token', token);\r\n        }\r\n        navigate('/');\r\n      } else {\r\n        // 尝试从响应中获取错误消息\r\n        const errorMessage = response.data?.message || response.data?.msg || 'ログインに失敗しました。再試行してください。';\r\n        setError(errorMessage);\r\n      }\r\n    } catch (err: any) {\r\n      // 处理不同的错误情况\r\n      if (err.response) {\r\n        // 服务器响应错误\r\n        switch (err.response.status) {\r\n          case 401:\r\n            setError('ユーザー名またはパスワードが間違っています。');\r\n            break;\r\n          case 404:\r\n            setError('ユーザーが存在しません。');\r\n            break;\r\n          case 500:\r\n            setError('サーバーエラーが発生しました。後ほど再試行してください。');\r\n            break;\r\n          default:\r\n            setError(err.response.data?.message || 'ログインに失敗しました。再試行してください。');\r\n        }\r\n      } else if (err.request) {\r\n        // 网络错误\r\n        setError(`ネットワーク接続に失敗しました。バックエンド(${apiBaseUrl})が起動しているか確認してください。`);\r\n      } else {\r\n        // 其他错误\r\n        setError('ログイン中にエラーが発生しました。再試行してください。');\r\n      }\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"login-page\">\r\n      <div className=\"login-container\">\r\n        <h2>ログイン</h2>\r\n        {error && <div className=\"error-message\">{error}</div>}\r\n        \r\n        <form onSubmit={handleSubmit} className=\"login-form\">\r\n          <div className=\"form-group\">\r\n            <label htmlFor=\"phone\">ユーザー名またはメールアドレス</label>\r\n            <input\r\n              type=\"text\"\r\n              id=\"phone\"\r\n              name=\"phone\"\r\n              value={formData.phone}\r\n              onChange={handleChange}\r\n              placeholder=\"ユーザー名またはメールアドレスを入力\"\r\n              required\r\n              className=\"form-input\"\r\n            />\r\n          </div>\r\n          \r\n          <div className=\"form-group\">\r\n            <label htmlFor=\"password\">パスワード</label>\r\n            <input\r\n              type=\"password\"\r\n              id=\"password\"\r\n              name=\"password\"\r\n              value={formData.password}\r\n              onChange={handleChange}\r\n              placeholder=\"パスワードを入力\"\r\n              required\r\n              className=\"form-input\"\r\n            />\r\n          </div>\r\n          \r\n          <button \r\n            type=\"submit\" \r\n            className=\"login-button\"\r\n            disabled={loading}\r\n          >\r\n            {loading ? 'ログイン中...' : 'ログイン'}\r\n          </button>\r\n        </form>\r\n        \r\n        <div className=\"login-footer\">\r\n          <p>アカウントをお持ちでないですか？ <Link to=\"/register\" className=\"link\">新規登録</Link></p>\r\n          <Link to=\"/\" className=\"link\">トップページへ戻る</Link>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default LoginPage;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}